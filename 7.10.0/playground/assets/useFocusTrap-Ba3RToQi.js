import{q as k,r as R,l as p,aq as g,ar as A,as as M,s as K,K as w,o as O,at as x,au as q}from"./iframe-CdM-7Hfu.js";import{u as B}from"./useMutationObserver-CoczCU8j.js";function D(e,y){return e.length!==y.length?!1:e.every((t,o)=>t===y[o])}const U=({restoreFocus:e,timeout:y,mount:t,ref:o})=>{const l=R.useRef(e);l.current=e;const[E,f]=R.useState(null),d=O(()=>{const i=typeof l.current=="function"?l.current():l.current;i&&setTimeout(()=>{const m=x(i)&&i||x(E)&&E||null;m&&(m.focus(),f(null))},y)});p(function(){if(!o.current||!l.current||!t){f(null);return}f(g(o.current))},[o,t]),p(function(){return()=>{d()}},[d]),p(function(){t||d()},[t,d])},C=q.join(),H=(e,{mount:y=!0,disabled:t=!1,autoFocus:o=!0,restoreFocus:l=!0,timeout:E=0,onClose:f,captureEscapeKeyboardEvent:d=!0,mutationObserverOptions:i})=>{const{document:m}=k(),n=R.useRef([]),I=a=>{const u=n.current[a];u&&u.focus({preventScroll:!0})};U({restoreFocus:l,mount:y,timeout:E,ref:e});const v=a=>{const u=a.querySelectorAll(C),r=[];u.forEach(s=>{const{display:c,visibility:h}=getComputedStyle(s);c!=="none"&&h!=="hidden"&&r.push(s)}),r.length===0&&r.push(a),n.current=r},N=a=>{const u=[...n.current];if(v(a),!(t||!o||D(u,n.current))&&m){const r=m.activeElement,s=Math.max(m.activeElement?n.current.indexOf(r):-1,0);I(s)}};B(e,()=>e.current&&N(e.current),i),p(()=>{e.current&&v(e.current)},[e]),p(function(){if(!e.current||!o||t)return;const r=setTimeout(()=>{if(!e.current||!n.current.length)return;const s=g(e.current);A(e.current,s)||(o==="root"?e.current?.focus():n.current[0].focus())},E);return()=>{clearTimeout(r)}},[o,E,t]),p(function(){if(!e.current)return;const u=c=>{if(t)return;switch(K(c)){case w.TAB:{if(!n.current.length)return!1;const L=n.current.length-1,T=n.current.findIndex(F=>F===c.target),S=T===-1||T===L&&!c.shiftKey;if(S||T===0&&c.shiftKey){c.preventDefault();const F=n.current[S?0:L];return F!==g(F)&&F.focus(),!1}break}}return!0},r=c=>t?void 0:(K(c)===w.ESCAPE&&f&&(c.preventDefault(),f()),!0),s=M(e.current).document;return s.addEventListener("keydown",u,{capture:!0}),s.addEventListener("keydown",r,{capture:d}),()=>{s.removeEventListener("keydown",u,!0),s.removeEventListener("keydown",r,d)}},[f,e,t])};export{H as u};
