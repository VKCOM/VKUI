import{r as o,b2 as w,q as M,a5 as B,j as t,h as F,o as E,b3 as k}from"./iframe-CdM-7Hfu.js";import{t as R}from"./throttle-CuRfLcRJ.js";import{u as q}from"./useGlobalEventListener-BRj5_zmB.js";import{S as H}from"./Spinner-CsDvRUz2.js";import{B as Q}from"./Button-Wq0du0BJ.js";import{m as A}from"./index-aEP2Nl5X.js";import{F as T}from"./Flex-gSHu7oDr.js";import{T as G}from"./Title-CJmHdlPE.js";import{G as z}from"./Group-c52jERCh.js";import{S as U}from"./Search-CfxeV0HW.js";import{F as Y}from"./Footer-B9Cd6ur3.js";import{C as J}from"./Counter-CSb5SDmz.js";import{j as P}from"./WithTooltip-SK46ZJ2J-Dj7NxoQg.js";function W(e){if(!/[а-яё]/i.test(e))return e;const n={а:"f",б:",",в:"d",г:"u",д:"l",е:"t",ё:"`",ж:";",з:"p",и:"b",й:"q",к:"r",л:"k",м:"v",н:"y",о:"j",п:"g",р:"h",с:"c",т:"n",у:"e",ф:"a",х:"[",ц:"w",ч:"x",ш:"i",щ:"o",ъ:"]",ы:"s",ь:"m",э:"'",ю:".",я:"z"};return e.split("").map(s=>n[s]||s).join("")}const X=(e,n)=>{const[s,i]=o.useState(""),[a,r]=o.useState(!1),{scrollTo:c}=w(),p=o.useMemo(()=>R(h=>{i(W(h.toLocaleLowerCase())),r(!1)},1e3),[]),C=o.useMemo(()=>(c(0,0),n(e,s)),[e,n,s,c]),S=o.useCallback(h=>{r(!0),p(h.target.value)},[p]);return{loading:a,onUpdateQuery:S,config:C,query:s}},K=24,Z=64,$=(e,n,s)=>{const{window:i,document:a}=M(),[r,c]=o.useState({mountedSections:[],sectionsVisibilityData:{}}),p=o.useRef({}),C=()=>{const u={};Object.entries(n).forEach(([d,l])=>{if(l&&l.current){const f=e.find(m=>m.id===d);f&&(u[d]={data:f,bounds:{height:l.current.offsetHeight,offsetTop:l.current.offsetTop}})}}),p.current=u},S=()=>{if(!i||!a)return;const u=i.pageYOffset;c(d=>{const{mountedSections:l,sectionsVisibilityData:f}=d;if(l.length<e.length){const m=a.documentElement.scrollHeight-i.innerHeight-K-Z;if(u>=m){const g=e[l.length];return{mountedSections:[...l,g.id],sectionsVisibilityData:{...f,[g.id]:g}}}}return d})},h=()=>{const u=p.current;if(!i||!a)return;const d=i.pageYOffset;c(l=>{const{mountedSections:f}=l,m={};return f.forEach(y=>{const g=u[y];if(!g)return;const{bounds:x,data:b}=g;if(x.offsetTop+x.height<=d||x.offsetTop>=d+i.innerHeight){m[y]={...b,minHeight:x.height,hidden:!0};return}m[y]=b}),{mountedSections:f,sectionsVisibilityData:m}}),S()};return o.useEffect(()=>c({mountedSections:[],sectionsVisibilityData:{}}),[e]),o.useEffect(C,[n]),B(s,()=>requestAnimationFrame(S)),q(i,"scroll",h),{remappedSections:o.useMemo(()=>r.mountedSections.map(u=>r.sectionsVisibilityData[u]).filter(Boolean),[r.mountedSections,r.sectionsVisibilityData]),showMoreElement:r.mountedSections.length<e.length&&t.jsx(H,{})}},ee="_header_1q5wd_6",te="_upButton_1q5wd_23",ne="_hidden_1q5wd_33",I={header:ee,upButton:te,hidden:ne},oe=()=>{const[e,n]=o.useState(!1),{scrollTo:s,getScroll:i}=w(),{window:a}=M(),r=o.useMemo(()=>R(()=>n(i().y>=(a?.innerHeight||0)),1e3),[i,a]);return q(a,"scroll",r),t.jsx("div",{className:F(I.upButton,!e&&I.hidden),children:t.jsx(Q,{borderRadiusMode:"inherit",size:"l",after:t.jsx(A,{}),onMouseDown:()=>s(0,0)})})},N=o.createContext({searchedQuery:""}),Se=()=>o.useContext(N),ye=({title:e,config:n,filterConfig:s,remapConfigToSections:i,ItemsContainer:a,renderSectionItem:r,additionalHeaderItem:c})=>{const p=o.useRef(null),[C,S]=o.useState({}),h=E(i),v=E(r),{config:u,loading:d,onUpdateQuery:l,query:f}=X(n,s),m=o.useMemo(()=>h(u),[u,h]),{remappedSections:y,showMoreElement:g}=$(m,C,p),x=o.useCallback((b,V)=>{const j=o.createRef();j.current=b,S(O=>{const D={...O,[V]:j};return k(D,L=>!!L.current)})},[]);return t.jsxs(N.Provider,{value:{searchedQuery:f},children:[t.jsxs(T,{direction:"column",gap:"2xl",align:"start",className:I.header,children:[t.jsx(G,{children:e}),t.jsx(z,{separator:"hide",children:t.jsx(U,{noPadding:!0,onChange:l})}),c]}),t.jsxs(T,{direction:"column",gap:"3xl",children:[d&&t.jsx(H,{}),!d&&m.length===0&&t.jsx(Y,{children:"Ничего не найдено"}),t.jsxs(T,{direction:"column",gap:"3xl",getRootRef:p,children:[y.map(({minHeight:b,hidden:V,...j})=>t.jsx(_,{hidden:V,sectionData:j,onSectionRef:x,style:{minHeight:b},ItemsRenderer:({section:O})=>t.jsx(a,{children:O.items.map(D=>v(D,O))})},j.id)),g]})]}),t.jsx(oe,{})]})},_=o.memo(({style:e,hidden:n,sectionData:s,onSectionRef:i,ItemsRenderer:a})=>{const r=o.useCallback(c=>{i(c,s.id)},[s.id,i]);return t.jsx(T,{direction:"column",gap:"xl",getRootRef:r,style:e,children:n?null:t.jsxs(t.Fragment,{children:[t.jsxs(T,{align:"center",gap:"m",children:[t.jsx(G,{level:"2",children:s.displayTitle}),t.jsx(J,{size:"m",mode:"primary",appearance:"accent-red",children:s.items.length})]}),t.jsx(a,{section:s})]})})},(e,n)=>e.sectionData.id===n.sectionData.id&&e.sectionData.items.length===n.sectionData.items.length&&e.onSectionRef===n.onSectionRef&&e.hidden===n.hidden&&e.style?.minHeight===n.style?.minHeight);_.displayName="Section";Object.defineProperty(_,"name",{value:"Section"});try{_.displayName="Section",_.__docgenInfo={description:"",displayName:"Section",props:{title:{defaultValue:null,description:"",name:"title",required:!0,type:{name:"string"}},config:{defaultValue:null,description:"",name:"config",required:!0,type:{name:"CONFIG"}},filterConfig:{defaultValue:null,description:"",name:"filterConfig",required:!0,type:{name:"(config: CONFIG, query: string) => CONFIG"}},remapConfigToSections:{defaultValue:null,description:"",name:"remapConfigToSections",required:!0,type:{name:"(config: CONFIG) => Section<ITEM>[]"}},ItemsContainer:{defaultValue:null,description:"",name:"ItemsContainer",required:!0,type:{name:"ComponentType<HasChildren>"}},renderSectionItem:{defaultValue:null,description:"",name:"renderSectionItem",required:!0,type:{name:"(item: ITEM, section: Section<ITEM>) => ReactElement<unknown, string | JSXElementConstructor<any>>"}},additionalHeaderItem:{defaultValue:null,description:"",name:"additionalHeaderItem",required:!1,type:{name:"ReactElement<unknown, string | JSXElementConstructor<any>>"}}}}}catch{}const xe=()=>{const n=o.useContext(P)?.store?.userGlobals?.globals;if(n){const{colorScheme:s="light",platform:i="vkcom",direction:a="ltr",hasCustomPanelHeaderAfter:r=!1,hasPointer:c=!1}=n;return{colorScheme:s,platform:i,direction:a,hasCustomPanelHeaderAfter:r,hasPointer:c}}return{colorScheme:"light",platform:"vkcom",direction:"ltr",hasCustomPanelHeaderAfter:!1,hasPointer:!1}};export{ye as O,Se as a,xe as u};
