"use strict";(self.webpackChunk_vkontakte_vkui=self.webpackChunk_vkontakte_vkui||[]).push([[4922],{"./src/components/Gallery/Gallery.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>Gallery});var jsx_runtime=__webpack_require__("../../node_modules/react/jsx-runtime.js"),react=__webpack_require__("../../node_modules/react/index.js"),math=__webpack_require__("./src/helpers/math.ts"),useIsClient=__webpack_require__("./src/hooks/useIsClient.ts"),es6=__webpack_require__("../../node_modules/@vkontakte/vkjs/lib/es6/index.js"),useAdaptivityHasPointer=__webpack_require__("./src/hooks/useAdaptivityHasPointer.ts"),useExternRef=__webpack_require__("./src/hooks/useExternRef.ts"),useGlobalEventListener=__webpack_require__("./src/hooks/useGlobalEventListener.ts"),dom=__webpack_require__("./src/lib/dom.tsx"),useIsomorphicLayoutEffect=__webpack_require__("./src/lib/useIsomorphicLayoutEffect.ts"),RootComponent=__webpack_require__("./src/components/RootComponent/RootComponent.tsx"),ScrollArrow=__webpack_require__("./src/components/ScrollArrow/ScrollArrow.tsx"),Touch=__webpack_require__("./src/components/Touch/Touch.tsx");const calcMin=({containerWidth=0,layerWidth=0,slides=[],viewportOffsetWidth=0,align,isCenterWithCustomWidth})=>{switch(align){case"left":return containerWidth-layerWidth;case"right":return viewportOffsetWidth-layerWidth;case"center":if(isCenterWithCustomWidth&&slides.length){const{coordX,width}=slides[slides.length-1];return viewportOffsetWidth/2-coordX-width/2}return viewportOffsetWidth-(containerWidth-viewportOffsetWidth)/2-layerWidth}},calcMax=({slides=[],viewportOffsetWidth=0,isCenterWithCustomWidth})=>{if(isCenterWithCustomWidth&&slides.length){const{width,coordX}=slides[0];return viewportOffsetWidth/2-coordX-width/2}return 0};var injectStylesIntoStyleTag=__webpack_require__("../../node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js"),injectStylesIntoStyleTag_default=__webpack_require__.n(injectStylesIntoStyleTag),singletonStyleDomAPI=__webpack_require__("../../node_modules/style-loader/dist/runtime/singletonStyleDomAPI.js"),singletonStyleDomAPI_default=__webpack_require__.n(singletonStyleDomAPI),insertBySelector=__webpack_require__("../../node_modules/style-loader/dist/runtime/insertBySelector.js"),insertBySelector_default=__webpack_require__.n(insertBySelector),setAttributesWithAttributesAndNonce=__webpack_require__("../../node_modules/style-loader/dist/runtime/setAttributesWithAttributesAndNonce.js"),setAttributesWithAttributesAndNonce_default=__webpack_require__.n(setAttributesWithAttributesAndNonce),insertStyleElement=__webpack_require__("../../node_modules/style-loader/dist/runtime/insertStyleElement.js"),insertStyleElement_default=__webpack_require__.n(insertStyleElement),BaseGallery_module=__webpack_require__("../../node_modules/css-loader/dist/cjs.js??ruleSet[1].rules[14].use[1]!../../node_modules/postcss-loader/dist/cjs.js??ruleSet[1].rules[14].use[2]!./src/components/BaseGallery/BaseGallery.module.css"),options={attributes:{class:"vkui-style"}};options.setAttributes=setAttributesWithAttributesAndNonce_default(),options.insert=insertBySelector_default().bind(null,"head"),options.domAPI=singletonStyleDomAPI_default(),options.insertStyleElement=insertStyleElement_default();injectStylesIntoStyleTag_default()(BaseGallery_module.A,options);const BaseGallery_BaseGallery_module=BaseGallery_module.A&&BaseGallery_module.A.locals?BaseGallery_module.A.locals:void 0,LAYOUT_DEFAULT_STATE={containerWidth:0,viewportOffsetWidth:0,layerWidth:0,min:0,max:0,slides:[],isFullyVisible:!0},SHIFT_DEFAULT_STATE={animation:void 0,shiftX:0,dragging:!1,deltaX:0,indent:0},stylesBullets={dark:BaseGallery_BaseGallery_module["BaseGallery__bullets--dark"],light:BaseGallery_BaseGallery_module["BaseGallery__bullets--light"]},BaseGallery=({bullets=!1,getRootRef,children,slideWidth="100%",slideIndex=0,dragDisabled=!1,onDragStart,onDragEnd,onChange,onPrevClick,onNextClick,align="left",showArrows,getRef,arrowSize="l",...restProps})=>{const slidesStore=react.useRef({}),layoutState=react.useRef(LAYOUT_DEFAULT_STATE),[shiftState,setShiftState]=react.useState(SHIFT_DEFAULT_STATE),rootRef=(0,useExternRef.Z)(getRootRef),viewportRef=(0,useExternRef.Z)(getRef),{window}=(0,dom.a4)(),hasPointer=(0,useAdaptivityHasPointer.Y)(),isCenterWithCustomWidth="custom"===slideWidth&&"center"===align,validateIndent=value=>{const localMax=layoutState.current.max??0,localMin=layoutState.current.min??0;return value<localMin?localMin:value>localMax?localMax:value},calculateIndent=targetIndex=>{if(layoutState.current.isFullyVisible)return 0;const targetSlide=layoutState.current.slides?.length?layoutState.current.slides[targetIndex]:null;if(targetSlide){const{coordX,width}=targetSlide;if(isCenterWithCustomWidth){return(layoutState.current.viewportOffsetWidth??0)/2-coordX-width/2}return validateIndent(-1*coordX)}return 0},calculateDragIndent=()=>{const localMax=layoutState.current.max??0,localMin=layoutState.current.min??0,indent=shiftState.shiftX+shiftState.deltaX;return indent>localMax?localMax+Number((indent-localMax)/3):indent<localMin?localMin+Number((indent-localMin)/3):indent},initializeSlides=(options={})=>{const localSlides=react.Children.map(children,((_item,i)=>{const elem=slidesStore.current[`slide-${i}`];return{coordX:elem?.offsetLeft??0,width:elem?.offsetWidth??0}}))??[],localContainerWidth=rootRef.current?.offsetWidth??0,localViewportOffsetWidth=viewportRef.current?.offsetWidth??0,localLayerWidth=localSlides.reduce(((val,slide)=>slide.width+val),0),adjustShiftX=localSlides.length<=layoutState.current.slides.length||layoutState.current.slides[slideIndex]?.coordX!==localSlides[slideIndex]?.coordX;layoutState.current={containerWidth:localContainerWidth,viewportOffsetWidth:localViewportOffsetWidth,layerWidth:localLayerWidth,max:calcMax({slides:localSlides,viewportOffsetWidth:localViewportOffsetWidth,isCenterWithCustomWidth}),min:calcMin({containerWidth:localContainerWidth,layerWidth:localLayerWidth,slides:localSlides,viewportOffsetWidth:localViewportOffsetWidth,isCenterWithCustomWidth,align}),slides:localSlides,isFullyVisible:localLayerWidth<=localContainerWidth},setShiftState((prevState=>({...prevState,shiftX:adjustShiftX?calculateIndent(slideIndex):prevState.shiftX,animation:options.animation??prevState.shiftX===validateIndent(prevState.shiftX)})))};(0,useGlobalEventListener.l)(window,"resize",(()=>{void 0!==shiftState.animation&&initializeSlides({animation:!1})})),(0,useIsomorphicLayoutEffect.E)((()=>{initializeSlides({animation:!1})}),[children,align,slideWidth]),(0,useIsomorphicLayoutEffect.E)((()=>{void 0!==shiftState.animation&&setShiftState((prevState=>({...prevState,animation:!0,deltaX:0,shiftX:calculateIndent(slideIndex??0)})))}),[slideIndex]);const isDraggable=!dragDisabled&&!layoutState.current.isFullyVisible,indent=shiftState.dragging?calculateDragIndent():shiftState.shiftX,layerStyle={WebkitTransform:`translateX(${indent}px)`,transform:`translateX(${indent}px)`,WebkitTransition:shiftState.animation?"-webkit-transform 0.24s cubic-bezier(.1, 0, .25, 1)":"none",transition:shiftState.animation?"transform 0.24s cubic-bezier(.1, 0, .25, 1)":"none"},canSlideLeft=!layoutState.current.isFullyVisible&&shiftState.shiftX<0,canSlideRight=!layoutState.current.isFullyVisible&&("left"===align&&layoutState.current.containerWidth-shiftState.shiftX<(layoutState.current.layerWidth??0)||"left"!==align&&slideIndex<layoutState.current.slides.length-1);return(0,jsx_runtime.jsxs)(RootComponent.I,{...restProps,baseClassName:(0,es6.xW)(BaseGallery_BaseGallery_module.BaseGallery,"center"===align&&BaseGallery_BaseGallery_module["BaseGallery--align-center"],"custom"===slideWidth&&BaseGallery_BaseGallery_module["BaseGallery--custom-width"],isDraggable&&BaseGallery_BaseGallery_module["BaseGallery--draggable"]),getRootRef:rootRef,children:[(0,jsx_runtime.jsx)(Touch.U,{className:BaseGallery_BaseGallery_module.BaseGallery__viewport,onStartX:e=>{e.originalEvent.stopPropagation(),isDraggable&&(onDragStart?.(e),setShiftState((prevState=>({...prevState,animation:!1}))))},onMoveX:e=>{isDraggable&&(e.originalEvent.preventDefault(),e.isSlideX&&shiftState.deltaX!==e.shiftX&&setShiftState((prevState=>({...prevState,deltaX:e.shiftX,dragging:e.isSlideX}))))},onEnd:e=>{if(isDraggable){const targetIndex=e.isSlide?(e=>{const expectDeltaX=shiftState.deltaX/e.duration*240*.6,shift=shiftState.shiftX+shiftState.deltaX+expectDeltaX-(layoutState.current.max??0),direction=shiftState.deltaX<0?1:-1;let targetIndex=layoutState.current.slides.reduce(((val,item,index)=>Math.abs(layoutState.current.slides[val].coordX+shift)<Math.abs(item.coordX+shift)?val:index),slideIndex);if(targetIndex===slideIndex){let targetSlide=slideIndex+direction;targetSlide>=0&&targetSlide<layoutState.current.slides.length&&Math.abs(shiftState.deltaX)>.05*layoutState.current.slides[targetSlide].width&&(targetIndex=targetSlide)}return targetIndex})(e):slideIndex??0;onDragEnd?.(e,targetIndex);const nextShiftState={animation:!0,dragging:!1,deltaX:0},shiftXStick=calculateDragIndent();targetIndex!==slideIndex&&(nextShiftState.shiftX=shiftXStick),setShiftState((prevState=>({...prevState,...nextShiftState}))),targetIndex!==slideIndex&&onChange?.(targetIndex)}},style:{width:"custom"===slideWidth?"100%":slideWidth},getRootRef:viewportRef,noSlideClick:!0,children:(0,jsx_runtime.jsx)("div",{className:BaseGallery_BaseGallery_module.BaseGallery__layer,style:layerStyle,children:react.Children.map(children,((item,i)=>(0,jsx_runtime.jsx)("div",{className:BaseGallery_BaseGallery_module.BaseGallery__slide,ref:el=>((slideRef,slideIndex)=>{slidesStore.current[`slide-${slideIndex}`]=slideRef})(el,i),children:item},`slide-${i}`)))})}),bullets&&(0,jsx_runtime.jsx)("div",{"aria-hidden":!0,className:(0,es6.xW)(BaseGallery_BaseGallery_module.BaseGallery__bullets,stylesBullets[bullets]),children:react.Children.map(children,((_item,index)=>(0,jsx_runtime.jsx)("div",{className:(0,es6.xW)(BaseGallery_BaseGallery_module.BaseGallery__bullet,index===slideIndex&&BaseGallery_BaseGallery_module["BaseGallery__bullet--active"])},index)))}),showArrows&&hasPointer&&canSlideLeft&&(0,jsx_runtime.jsx)(ScrollArrow.L,{className:BaseGallery_BaseGallery_module.BaseGallery__arrow,direction:"left",onClick:event=>{onChange?.(slideIndex-1),onPrevClick?.(event)},size:arrowSize}),showArrows&&hasPointer&&canSlideRight&&(0,jsx_runtime.jsx)(ScrollArrow.L,{className:BaseGallery_BaseGallery_module.BaseGallery__arrow,direction:"right",onClick:event=>{onChange?.(slideIndex+1),onNextClick?.(event)},size:arrowSize})]})};try{BaseGallery.displayName="BaseGallery",BaseGallery.__docgenInfo={description:"",displayName:"BaseGallery",props:{slideWidth:{defaultValue:{value:"100%"},description:"",name:"slideWidth",required:!1,type:{name:"string | number"}},slideIndex:{defaultValue:{value:"0"},description:"",name:"slideIndex",required:!1,type:{name:"number"}},onDragStart:{defaultValue:null,description:"",name:"onDragStart",required:!1,type:{name:"TouchEventHandler"}},onDragEnd:{defaultValue:null,description:"",name:"onDragEnd",required:!1,type:{name:"((e: TouchEvent, targetIndex: number) => void)"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!1,type:{name:"((current: number) => void)"}},onPrevClick:{defaultValue:null,description:"Будет вызвано при клике на кнопку-стрелку влево",name:"onPrevClick",required:!1,type:{name:"((event: MouseEvent<Element, MouseEvent>) => void)"}},onNextClick:{defaultValue:null,description:"Будет вызвано при клике на кнопку-стрелку вправо",name:"onNextClick",required:!1,type:{name:"((event: MouseEvent<Element, MouseEvent>) => void)"}},bullets:{defaultValue:{value:"false"},description:"",name:"bullets",required:!1,type:{name:'false | "light" | "dark"'}},dragDisabled:{defaultValue:{value:"false"},description:"Позволяет отключить реагирование на тач-события",name:"dragDisabled",required:!1,type:{name:"boolean"}},showArrows:{defaultValue:null,description:"",name:"showArrows",required:!1,type:{name:"boolean"}},hasPointer:{defaultValue:null,description:"",name:"hasPointer",required:!1,type:{name:"boolean"}},arrowSize:{defaultValue:{value:"l"},description:"",name:"arrowSize",required:!1,type:{name:"enum",value:[{value:'"m"'},{value:'"l"'}]}},arrowPrevLabel:{defaultValue:null,description:"Текст для кнопки-стрелки влево (назад). Делает ее доступной для ассистивных технологий",name:"arrowPrevLabel",required:!1,type:{name:"string"}},arrowNextLabel:{defaultValue:null,description:"Текст для кнопки-стрелки вправо (вперед). Делает ее доступной для ассистивных технологий",name:"arrowNextLabel",required:!1,type:{name:"string"}},getRootRef:{defaultValue:null,description:"",name:"getRootRef",required:!1,type:{name:"Ref<HTMLDivElement>"}},align:{defaultValue:{value:"left"},description:"",name:"align",required:!1,type:{name:"enum",value:[{value:'"center"'},{value:'"right"'},{value:'"left"'}]}},getRef:{defaultValue:null,description:"",name:"getRef",required:!1,type:{name:"Ref<HTMLElement>"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/BaseGallery/BaseGallery.tsx#BaseGallery"]={docgenInfo:BaseGallery.__docgenInfo,name:"BaseGallery",path:"src/components/BaseGallery/BaseGallery.tsx#BaseGallery"})}catch(__react_docgen_typescript_loader_error){}var warnOnce=__webpack_require__("./src/lib/warnOnce.ts");const CONTROL_ELEMENTS_STATE={canSlideLeft:!0,canSlideRight:!0,isDraggable:!0},SLIDES_MANAGER_STATE={viewportOffsetWidth:0,slides:[],isFullyVisible:!0,loopPoints:[],contentSize:0,snaps:[]};function getShiftedIndexes(direction,slides,availableWidth){let gap=availableWidth;const shiftedSlideIndexes=[],startIndex=1===direction?0:slides.length-1,endIndex=1===direction?slides.length-1:0;for(let i=startIndex;(1===direction?i<=endIndex:i>=endIndex)&&gap>0;i+=direction){const slideWidth=slides[i].width;gap>0&&shiftedSlideIndexes.push(i),gap-=slideWidth}return shiftedSlideIndexes}function calculateLoopPoints(indexes,edge,slidesManager,containerWidth){const{contentSize,slides,snaps}=slidesManager,isStartEdge="start"===edge,offset=isStartEdge?-contentSize:contentSize;return indexes.map((index=>{const initial=isStartEdge?0:-contentSize,altered=isStartEdge?contentSize:0,loopPoint=isStartEdge?snaps[index]+containerWidth+offset:snaps[index]-slides[index].width+offset-snaps[0];return{index,target:currentLocation=>currentLocation>=loopPoint?initial:altered}}))}const TIMING_FUNCTION=(0,__webpack_require__("./src/lib/fx.ts").A)(.8,1);function useSlideAnimation(){const animationQueue=react.useRef([]);return{getAnimateFunction:function getAnimateFunction(drawFunction){return()=>{!function animate({duration,timing,draw,animationQueue=[]}){if(!es6.Sw)return;let start;requestAnimationFrame((function animate(time){start||(start=time);let timeFraction=Math.min((time-start)/duration,1);const progress=timing(timeFraction);draw(progress),timeFraction<1?requestAnimationFrame(animate):(animationQueue.shift(),animationQueue.length>0&&animationQueue[0]())}))}({duration:240,timing:TIMING_FUNCTION,animationQueue:animationQueue.current,draw:drawFunction})}},addToAnimationQueue:function addToAnimationQueue(func){animationQueue.current.push(func)},startAnimation:function startAnimation(){1===animationQueue.current.length&&animationQueue.current[0]()}}}const CarouselBase_stylesBullets={dark:BaseGallery_BaseGallery_module["BaseGallery__bullets--dark"],light:BaseGallery_BaseGallery_module["BaseGallery__bullets--light"]},CarouselBase=((0,warnOnce.m)("Gallery"),({bullets=!1,getRootRef,children,slideWidth="100%",slideIndex=0,dragDisabled=!1,onDragStart,onDragEnd,onChange,onPrevClick,onNextClick,align="left",showArrows,getRef,arrowSize="l",...restProps})=>{const slidesStore=react.useRef({}),slidesManager=react.useRef(SLIDES_MANAGER_STATE),rootRef=(0,useExternRef.Z)(getRootRef),viewportRef=(0,useExternRef.Z)(getRef),layerRef=react.useRef(null),animationFrameRef=react.useRef(null),shiftXCurrentRef=react.useRef(0),shiftXDeltaRef=react.useRef(0),initialized=react.useRef(!1),{addToAnimationQueue,getAnimateFunction,startAnimation}=useSlideAnimation(),[controlElementsState,setControlElementsState]=react.useState(CONTROL_ELEMENTS_STATE),{window}=(0,dom.a4)(),hasPointer=(0,useAdaptivityHasPointer.Y)(),isCenterWithCustomWidth="custom"===slideWidth&&"center"===align,transformCssStyles=(shiftX,animation=!1)=>{slidesManager.current.loopPoints.forEach((loopPoint=>{const{target,index}=loopPoint,slide=slidesStore.current[index];slide&&(slide.style.transform=`translate3d(${target(shiftX)}px, 0, 0)`)})),layerRef.current&&(layerRef.current.style.transform=`translate3d(${shiftX}px, 0, 0)`,layerRef.current.style.transition=animation?"transform 240ms cubic-bezier(.1, 0, .25, 1)":"")},requestTransform=(shiftX,animation=!1)=>{const{snaps,contentSize,slides}=slidesManager.current;null!==animationFrameRef.current&&cancelAnimationFrame(animationFrameRef.current),animationFrameRef.current=requestAnimationFrame((()=>{shiftX>snaps[0]&&(shiftXCurrentRef.current=-contentSize+snaps[0],shiftX=shiftXCurrentRef.current+shiftXDeltaRef.current);const lastPoint=slides[slides.length-1].width+slides[slides.length-1].coordX;shiftX<=-lastPoint&&(shiftXCurrentRef.current=Math.abs(shiftXDeltaRef.current)+snaps[0]),transformCssStyles(shiftX,animation)}))},initializeSlides=()=>{if(!rootRef.current||!viewportRef.current)return;let localSlides=react.Children.map(children,((_item,i)=>{const elem=slidesStore.current[i]||{offsetLeft:0,offsetWidth:0};return{coordX:elem.offsetLeft,width:elem.offsetWidth}}))||[];const containerWidth=rootRef.current.offsetWidth,viewportOffsetWidth=viewportRef.current.offsetWidth,layerWidth=localSlides.reduce(((val,slide)=>slide.width+val),0);if("center"===align){const firstSlideShift=(containerWidth-localSlides[0].width)/2;localSlides=localSlides.map((item=>({width:item.width,coordX:item.coordX-firstSlideShift})))}slidesManager.current={...slidesManager.current,viewportOffsetWidth,slides:localSlides,isFullyVisible:layerWidth<=containerWidth};const snaps=localSlides.map(((_,index)=>function calculateIndent(targetIndex,slidesManager,isCenterWithCustomWidth){if(slidesManager.isFullyVisible||!slidesManager.slides.length)return 0;const targetSlide=slidesManager.slides[targetIndex];if(targetSlide){const{coordX,width}=targetSlide;return isCenterWithCustomWidth?slidesManager.viewportOffsetWidth/2-coordX-width/2:-1*coordX}return 0}(index,slidesManager.current,isCenterWithCustomWidth)));let contentSize=-snaps[snaps.length-1]+localSlides[localSlides.length-1].width;"center"===align&&(contentSize+=snaps[0]),slidesManager.current.snaps=snaps,slidesManager.current.contentSize=contentSize,slidesManager.current.loopPoints=function getLoopPoints(slidesManager,containerWidth){const{slides,snaps}=slidesManager,startShiftedIndexes=getShiftedIndexes(-1,slides,snaps[0]);return[...calculateLoopPoints(getShiftedIndexes(1,slides,containerWidth-snaps[0]),"start",slidesManager,containerWidth),...calculateLoopPoints(startShiftedIndexes,"end",slidesManager,containerWidth)]}(slidesManager.current,containerWidth),setControlElementsState({canSlideLeft:!slidesManager.current.isFullyVisible,canSlideRight:!slidesManager.current.isFullyVisible,isDraggable:!(dragDisabled||slidesManager.current.isFullyVisible)}),shiftXCurrentRef.current=snaps[slideIndex],initialized.current=!0,requestTransform(shiftXCurrentRef.current)};(0,useGlobalEventListener.l)(window,"resize",(()=>{initialized.current&&initializeSlides()})),(0,useIsomorphicLayoutEffect.E)((function performSlideChange(){if(!initialized.current)return;const{snaps,slides}=slidesManager.current,indent=snaps[slideIndex];let startPoint=shiftXCurrentRef.current;if(indent===snaps[0]&&shiftXCurrentRef.current<=snaps[snaps.length-1]){const distance=Math.abs(snaps[snaps.length-1])+slides[slides.length-1].width+startPoint;addToAnimationQueue(getAnimateFunction((progress=>{const shiftX=startPoint+progress*distance*-1;transformCssStyles(shiftX),shiftX<=snaps[snaps.length-1]-slides[slides.length-1].width&&requestAnimationFrame((()=>{shiftXCurrentRef.current=indent,transformCssStyles(snaps[0])}))})))}else indent===snaps[snaps.length-1]&&shiftXCurrentRef.current===snaps[0]?(startPoint=indent-slides[slides.length-1].width,addToAnimationQueue((()=>{requestAnimationFrame((()=>{const shiftX=indent-slides[slides.length-1].width;transformCssStyles(shiftX),getAnimateFunction((progress=>{transformCssStyles(startPoint+progress*slides[slides.length-1].width)}))()}))}))):addToAnimationQueue((()=>{const distance=Math.abs(indent-startPoint);let direction=startPoint<=indent?1:-1;getAnimateFunction((progress=>{transformCssStyles(startPoint+progress*distance*direction)}))()}));startAnimation(),shiftXCurrentRef.current=indent}),[slideIndex]),(0,useIsomorphicLayoutEffect.E)((()=>{initializeSlides()}),[children,align,slideWidth]);const{canSlideLeft,canSlideRight,isDraggable}=controlElementsState;return(0,jsx_runtime.jsxs)(RootComponent.I,{...restProps,baseClassName:(0,es6.xW)(BaseGallery_BaseGallery_module.BaseGallery,"custom"===slideWidth&&BaseGallery_BaseGallery_module["BaseGallery--custom-width"],isDraggable&&BaseGallery_BaseGallery_module["BaseGallery--draggable"]),getRootRef:rootRef,children:[(0,jsx_runtime.jsx)(Touch.U,{className:BaseGallery_BaseGallery_module.BaseGallery__viewport,onStartX:e=>{e.originalEvent.stopPropagation(),controlElementsState.isDraggable&&(onDragStart?.(e),shiftXCurrentRef.current=slidesManager.current.snaps[slideIndex],shiftXDeltaRef.current=0)},onMoveX:e=>{controlElementsState.isDraggable&&(e.originalEvent.preventDefault(),e.isSlideX&&shiftXDeltaRef.current!==e.shiftX&&(shiftXDeltaRef.current=e.shiftX,requestTransform(shiftXCurrentRef.current+shiftXDeltaRef.current)))},onEnd:e=>{if(controlElementsState.isDraggable){let targetIndex=slideIndex;if(e.isSlide&&(targetIndex=function getTargetIndex(slides,slideIndex,currentShiftX,currentShiftXDelta){const shift=currentShiftX+currentShiftXDelta,direction=currentShiftXDelta<0?1:-1;let targetIndex=slides.reduce(((val,item,index)=>Math.abs(slides[val].coordX+shift)<Math.abs(item.coordX+shift)?val:index),slideIndex);if(targetIndex===slideIndex){let targetSlide=slideIndex+direction;return targetSlide>=0&&targetSlide<slides.length?Math.abs(currentShiftXDelta)>.05*slides[targetSlide].width?targetSlide:targetIndex:direction<0?(targetSlide+slides.length)%slides.length:targetSlide%slides.length}return targetIndex}(slidesManager.current.slides,slideIndex,shiftXCurrentRef.current,shiftXDeltaRef.current)),onDragEnd?.(e,targetIndex),targetIndex!==slideIndex)shiftXCurrentRef.current=shiftXCurrentRef.current+shiftXDeltaRef.current,onChange?.(targetIndex);else{const initialShiftX=slidesManager.current.snaps[targetIndex];requestTransform(initialShiftX,!0)}}},style:{width:"custom"===slideWidth?"100%":slideWidth},getRootRef:viewportRef,noSlideClick:!0,children:(0,jsx_runtime.jsx)("div",{className:BaseGallery_BaseGallery_module.BaseGallery__layer,ref:layerRef,children:react.Children.map(children,((item,i)=>(0,jsx_runtime.jsx)("div",{className:BaseGallery_BaseGallery_module.BaseGallery__slide,ref:el=>((slideRef,slideIndex)=>{slidesStore.current[slideIndex]=slideRef})(el,i),children:item},`slide-${i}`)))})}),bullets&&(0,jsx_runtime.jsx)("div",{"aria-hidden":!0,className:(0,es6.xW)(BaseGallery_BaseGallery_module.BaseGallery__bullets,CarouselBase_stylesBullets[bullets]),children:react.Children.map(children,((_item,index)=>(0,jsx_runtime.jsx)("div",{className:(0,es6.xW)(BaseGallery_BaseGallery_module.BaseGallery__bullet,index===slideIndex&&BaseGallery_BaseGallery_module["BaseGallery__bullet--active"])},index)))}),showArrows&&hasPointer&&canSlideLeft&&(0,jsx_runtime.jsx)(ScrollArrow.L,{className:BaseGallery_BaseGallery_module.BaseGallery__arrow,direction:"left",onClick:event=>{onChange?.((slideIndex-1+slidesManager.current.slides.length)%slidesManager.current.slides.length),onPrevClick?.(event)},size:arrowSize}),showArrows&&hasPointer&&canSlideRight&&(0,jsx_runtime.jsx)(ScrollArrow.L,{className:BaseGallery_BaseGallery_module.BaseGallery__arrow,direction:"right",onClick:event=>{onChange?.((slideIndex+1)%slidesManager.current.slides.length),onNextClick?.(event)},size:arrowSize})]})});try{CarouselBase.displayName="CarouselBase",CarouselBase.__docgenInfo={description:"",displayName:"CarouselBase",props:{slideWidth:{defaultValue:{value:"100%"},description:"",name:"slideWidth",required:!1,type:{name:"string | number"}},slideIndex:{defaultValue:{value:"0"},description:"",name:"slideIndex",required:!1,type:{name:"number"}},onDragStart:{defaultValue:null,description:"",name:"onDragStart",required:!1,type:{name:"TouchEventHandler"}},onDragEnd:{defaultValue:null,description:"",name:"onDragEnd",required:!1,type:{name:"((e: TouchEvent, targetIndex: number) => void)"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!1,type:{name:"((current: number) => void)"}},onPrevClick:{defaultValue:null,description:"Будет вызвано при клике на кнопку-стрелку влево",name:"onPrevClick",required:!1,type:{name:"((event: MouseEvent<Element, MouseEvent>) => void)"}},onNextClick:{defaultValue:null,description:"Будет вызвано при клике на кнопку-стрелку вправо",name:"onNextClick",required:!1,type:{name:"((event: MouseEvent<Element, MouseEvent>) => void)"}},bullets:{defaultValue:{value:"false"},description:"",name:"bullets",required:!1,type:{name:'false | "light" | "dark"'}},dragDisabled:{defaultValue:{value:"false"},description:"Позволяет отключить реагирование на тач-события",name:"dragDisabled",required:!1,type:{name:"boolean"}},showArrows:{defaultValue:null,description:"",name:"showArrows",required:!1,type:{name:"boolean"}},hasPointer:{defaultValue:null,description:"",name:"hasPointer",required:!1,type:{name:"boolean"}},arrowSize:{defaultValue:{value:"l"},description:"",name:"arrowSize",required:!1,type:{name:"enum",value:[{value:'"m"'},{value:'"l"'}]}},arrowPrevLabel:{defaultValue:null,description:"Текст для кнопки-стрелки влево (назад). Делает ее доступной для ассистивных технологий",name:"arrowPrevLabel",required:!1,type:{name:"string"}},arrowNextLabel:{defaultValue:null,description:"Текст для кнопки-стрелки вправо (вперед). Делает ее доступной для ассистивных технологий",name:"arrowNextLabel",required:!1,type:{name:"string"}},getRootRef:{defaultValue:null,description:"",name:"getRootRef",required:!1,type:{name:"Ref<HTMLDivElement>"}},align:{defaultValue:{value:"left"},description:"",name:"align",required:!1,type:{name:"enum",value:[{value:'"center"'},{value:'"right"'},{value:'"left"'}]}},getRef:{defaultValue:null,description:"",name:"getRef",required:!1,type:{name:"Ref<HTMLElement>"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/BaseGallery/CarouselBase/CarouselBase.tsx#CarouselBase"]={docgenInfo:CarouselBase.__docgenInfo,name:"CarouselBase",path:"src/components/BaseGallery/CarouselBase/CarouselBase.tsx#CarouselBase"})}catch(__react_docgen_typescript_loader_error){}var useStableCallback=__webpack_require__("./src/hooks/useStableCallback.ts");const Gallery=({initialSlideIndex=0,children,timeout=0,onChange,bullets,looped,...props})=>{const[localSlideIndex,setSlideIndex]=react.useState(initialSlideIndex),isControlled="number"==typeof props.slideIndex,slideIndex=isControlled?props.slideIndex??0:localSlideIndex,slides=react.useMemo((()=>react.Children.toArray(children).filter((item=>Boolean(item)))),[children]),childCount=slides.length,isClient=(0,useIsClient.D)(),handleChange=react.useCallback((current=>{current!==slideIndex&&(!isControlled&&setSlideIndex(current),onChange&&onChange(current))}),[isControlled,onChange,slideIndex]);!function useAutoPlay(timeout,slideIndex,callbackFnProp){const{document}=(0,dom.a4)(),callbackFn=(0,useStableCallback.K)(callbackFnProp);react.useEffect((function initializeAutoPlay(){if(!document||!timeout)return;let timeoutId=null;const stop=()=>{timeoutId&&(clearTimeout(timeoutId),timeoutId=null)},start=()=>{switch(document.visibilityState){case"visible":stop(),timeoutId=setTimeout(callbackFn,timeout);break;case"hidden":stop()}};return start(),document.addEventListener("visibilitychange",start),()=>{stop(),document.removeEventListener("visibilitychange",start)}}),[document,timeout,slideIndex,callbackFn])}(timeout,slideIndex,(()=>handleChange((slideIndex+1)%childCount)));const safeSlideIndex=childCount>0?(0,math.qE)(slideIndex,0,childCount-1):slideIndex;if(react.useEffect((()=>{onChange&&safeSlideIndex!==slideIndex&&onChange(safeSlideIndex),setSlideIndex(safeSlideIndex)}),[onChange,safeSlideIndex,slideIndex]),!isClient)return null;const Component=looped?CarouselBase:BaseGallery;return(0,jsx_runtime.jsx)(Component,{dragDisabled:isControlled&&!onChange,...props,bullets:childCount>0&&bullets,slideIndex:safeSlideIndex,onChange:handleChange,children:slides})};try{Gallery.displayName="Gallery",Gallery.__docgenInfo={description:"",displayName:"Gallery",props:{initialSlideIndex:{defaultValue:{value:"0"},description:"",name:"initialSlideIndex",required:!1,type:{name:"number"}},timeout:{defaultValue:{value:"0"},description:"",name:"timeout",required:!1,type:{name:"number"}},looped:{defaultValue:null,description:"",name:"looped",required:!1,type:{name:"boolean"}},slideWidth:{defaultValue:null,description:"",name:"slideWidth",required:!1,type:{name:"string | number"}},slideIndex:{defaultValue:null,description:"",name:"slideIndex",required:!1,type:{name:"number"}},onDragStart:{defaultValue:null,description:"",name:"onDragStart",required:!1,type:{name:"TouchEventHandler"}},onDragEnd:{defaultValue:null,description:"",name:"onDragEnd",required:!1,type:{name:"((e: TouchEvent, targetIndex: number) => void)"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!1,type:{name:"((current: number) => void)"}},onPrevClick:{defaultValue:null,description:"Будет вызвано при клике на кнопку-стрелку влево",name:"onPrevClick",required:!1,type:{name:"((event: MouseEvent<Element, MouseEvent>) => void)"}},onNextClick:{defaultValue:null,description:"Будет вызвано при клике на кнопку-стрелку вправо",name:"onNextClick",required:!1,type:{name:"((event: MouseEvent<Element, MouseEvent>) => void)"}},bullets:{defaultValue:null,description:"",name:"bullets",required:!1,type:{name:'false | "light" | "dark"'}},dragDisabled:{defaultValue:null,description:"Позволяет отключить реагирование на тач-события",name:"dragDisabled",required:!1,type:{name:"boolean"}},showArrows:{defaultValue:null,description:"",name:"showArrows",required:!1,type:{name:"boolean"}},hasPointer:{defaultValue:null,description:"",name:"hasPointer",required:!1,type:{name:"boolean"}},arrowSize:{defaultValue:null,description:"",name:"arrowSize",required:!1,type:{name:"enum",value:[{value:'"m"'},{value:'"l"'}]}},arrowPrevLabel:{defaultValue:null,description:"Текст для кнопки-стрелки влево (назад). Делает ее доступной для ассистивных технологий",name:"arrowPrevLabel",required:!1,type:{name:"string"}},arrowNextLabel:{defaultValue:null,description:"Текст для кнопки-стрелки вправо (вперед). Делает ее доступной для ассистивных технологий",name:"arrowNextLabel",required:!1,type:{name:"string"}},getRootRef:{defaultValue:null,description:"",name:"getRootRef",required:!1,type:{name:"Ref<HTMLDivElement>"}},align:{defaultValue:null,description:"",name:"align",required:!1,type:{name:"enum",value:[{value:'"center"'},{value:'"right"'},{value:'"left"'}]}},getRef:{defaultValue:null,description:"",name:"getRef",required:!1,type:{name:"Ref<HTMLElement>"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/Gallery/Gallery.tsx#Gallery"]={docgenInfo:Gallery.__docgenInfo,name:"Gallery",path:"src/components/Gallery/Gallery.tsx#Gallery"})}catch(__react_docgen_typescript_loader_error){}},"../../node_modules/css-loader/dist/cjs.js??ruleSet[1].rules[14].use[1]!../../node_modules/postcss-loader/dist/cjs.js??ruleSet[1].rules[14].use[2]!./src/components/BaseGallery/BaseGallery.module.css":(module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>__WEBPACK_DEFAULT_EXPORT__});var _node_modules_css_loader_dist_runtime_sourceMaps_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/css-loader/dist/runtime/sourceMaps.js"),_node_modules_css_loader_dist_runtime_sourceMaps_js__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_node_modules_css_loader_dist_runtime_sourceMaps_js__WEBPACK_IMPORTED_MODULE_0__),_node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../../node_modules/css-loader/dist/runtime/api.js"),___CSS_LOADER_EXPORT___=__webpack_require__.n(_node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_1__)()(_node_modules_css_loader_dist_runtime_sourceMaps_js__WEBPACK_IMPORTED_MODULE_0___default());___CSS_LOADER_EXPORT___.push([module.id,".BaseGallery--aehDU{overflow:hidden;position:relative;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.BaseGallery__viewport--I1eNk{block-size:100%;margin:0;position:relative}.BaseGallery--align-center--JQQn4 .BaseGallery__viewport--I1eNk{margin-block:0;margin-inline:auto}.BaseGallery__layer--nJ0KW{align-items:stretch;block-size:100%;display:flex;inline-size:100%;min-block-size:100px}.BaseGallery--draggable--J_egI .BaseGallery__layer--nJ0KW{cursor:-webkit-grab;cursor:grab}.BaseGallery__layer--nJ0KW:empty{min-block-size:0}.BaseGallery__slide--N5num{flex:0 0 auto;inline-size:100%;max-inline-size:100%;overflow:hidden}.BaseGallery--custom-width--Cet7r .BaseGallery__slide--N5num{inline-size:auto}.BaseGallery__slide--N5num>*{inline-size:100%;min-block-size:100%}.BaseGallery__bullets--acbMd{align-items:center;block-size:6px;display:flex;inline-size:100%;inset-block-end:10px;inset-inline-start:0;justify-content:center;position:absolute}.BaseGallery__bullets--dark--T_Veu .BaseGallery__bullet--YYi6w{background-color:var(--vkui--color_icon_primary_invariably)}.BaseGallery__bullets--light--wkxQq .BaseGallery__bullet--YYi6w{background-color:var(--vkui--color_icon_contrast)}.BaseGallery__bullet--YYi6w{block-size:6px;border-radius:50%;inline-size:6px;margin-block:0;margin-inline:3px;opacity:var(--vkui--opacity_disable_accessibility)}.BaseGallery__bullet--active--WpJY6{opacity:1}.BaseGallery__arrow--Z8JoJ{inset-block-start:0;opacity:0;position:absolute}.BaseGallery--aehDU:hover .BaseGallery__arrow--Z8JoJ{opacity:var(--vkui--opacity_disable_accessibility)}.BaseGallery--aehDU .BaseGallery__arrow--Z8JoJ:hover{opacity:1}","",{version:3,sources:["webpack://./src/components/BaseGallery/BaseGallery.module.css"],names:[],mappings:"AAAA,oBAEE,eAAgB,CADhB,iBAAkB,CAElB,wBAAiB,CAAjB,qBAAiB,CAAjB,oBAAiB,CAAjB,gBACF,CAEA,8BAEE,eAAgB,CADhB,QAAS,CAET,iBACF,CAEA,gEACE,cAAe,CACf,kBACF,CAEA,2BAKE,mBAAoB,CAFpB,eAAgB,CAFhB,YAAa,CACb,gBAAiB,CAEjB,oBAEF,CAEA,0DACE,mBAAY,CAAZ,WACF,CAEA,iCACE,gBACF,CAEA,2BAEE,aAAc,CADd,gBAAiB,CAEjB,oBAAqB,CACrB,eACF,CAEA,6DACE,gBACF,CAGA,6BACE,gBAAiB,CACjB,mBACF,CAEA,6BAOE,kBAAmB,CAJnB,cAAe,CAGf,YAAa,CAFb,gBAAiB,CAFjB,oBAAqB,CAGrB,oBAAqB,CAGrB,sBAAuB,CAPvB,iBAQF,CAEA,+DACE,2DACF,CAEA,gEACE,iDACF,CAEA,4BACE,cAAe,CAEf,iBAAkB,CADlB,eAAgB,CAEhB,cAAe,CACf,iBAAkB,CAClB,kDACF,CAEA,oCACE,SACF,CAEA,2BAEE,mBAAoB,CACpB,SAAU,CAFV,iBAGF,CAEA,qDACE,kDACF,CAEA,qDACE,SACF",sourcesContent:[".BaseGallery {\n  position: relative;\n  overflow: hidden;\n  user-select: none;\n}\n\n.BaseGallery__viewport {\n  margin: 0;\n  block-size: 100%;\n  position: relative;\n}\n\n.BaseGallery--align-center .BaseGallery__viewport {\n  margin-block: 0;\n  margin-inline: auto;\n}\n\n.BaseGallery__layer {\n  display: flex;\n  inline-size: 100%;\n  block-size: 100%;\n  min-block-size: 100px;\n  align-items: stretch;\n}\n\n.BaseGallery--draggable .BaseGallery__layer {\n  cursor: grab;\n}\n\n.BaseGallery__layer:empty {\n  min-block-size: 0;\n}\n\n.BaseGallery__slide {\n  inline-size: 100%;\n  flex: 0 0 auto;\n  max-inline-size: 100%;\n  overflow: hidden;\n}\n\n.BaseGallery--custom-width .BaseGallery__slide {\n  inline-size: auto;\n}\n\n/* stylelint-disable-next-line selector-max-universal */\n.BaseGallery__slide > * {\n  inline-size: 100%;\n  min-block-size: 100%;\n}\n\n.BaseGallery__bullets {\n  position: absolute;\n  inset-block-end: 10px;\n  block-size: 6px;\n  inline-size: 100%;\n  inset-inline-start: 0;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n\n.BaseGallery__bullets--dark .BaseGallery__bullet {\n  background-color: var(--vkui--color_icon_primary_invariably);\n}\n\n.BaseGallery__bullets--light .BaseGallery__bullet {\n  background-color: var(--vkui--color_icon_contrast);\n}\n\n.BaseGallery__bullet {\n  block-size: 6px;\n  inline-size: 6px;\n  border-radius: 50%;\n  margin-block: 0;\n  margin-inline: 3px;\n  opacity: var(--vkui--opacity_disable_accessibility);\n}\n\n.BaseGallery__bullet--active {\n  opacity: 1;\n}\n\n.BaseGallery__arrow {\n  position: absolute;\n  inset-block-start: 0;\n  opacity: 0;\n}\n\n.BaseGallery:hover .BaseGallery__arrow {\n  opacity: var(--vkui--opacity_disable_accessibility);\n}\n\n.BaseGallery .BaseGallery__arrow:hover {\n  opacity: 1;\n}\n"],sourceRoot:""}]),___CSS_LOADER_EXPORT___.locals={BaseGallery:"BaseGallery--aehDU",BaseGallery__viewport:"BaseGallery__viewport--I1eNk","BaseGallery--align-center":"BaseGallery--align-center--JQQn4",BaseGallery__layer:"BaseGallery__layer--nJ0KW","BaseGallery--draggable":"BaseGallery--draggable--J_egI",BaseGallery__slide:"BaseGallery__slide--N5num","BaseGallery--custom-width":"BaseGallery--custom-width--Cet7r",BaseGallery__bullets:"BaseGallery__bullets--acbMd","BaseGallery__bullets--dark":"BaseGallery__bullets--dark--T_Veu",BaseGallery__bullet:"BaseGallery__bullet--YYi6w","BaseGallery__bullets--light":"BaseGallery__bullets--light--wkxQq","BaseGallery__bullet--active":"BaseGallery__bullet--active--WpJY6",BaseGallery__arrow:"BaseGallery__arrow--Z8JoJ"};const __WEBPACK_DEFAULT_EXPORT__=___CSS_LOADER_EXPORT___}}]);