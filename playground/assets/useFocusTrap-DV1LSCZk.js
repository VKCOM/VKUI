import{o as A,r as v,q as y,ap as F,aq as M,ar as O,s as K,K as w,m as q,as as x,at as I}from"./iframe-CGSrC79H.js";import{u as B}from"./useMutationObserver-DQTeLLG8.js";function D(e,i){return e.length!==i.length?!1:e.every((n,r)=>n===i[r])}function U(e){return I.some(i=>e.matches(i))}const b=({restoreFocus:e,timeout:i,mount:n,ref:r})=>{const f=v.useRef(e);y(()=>{f.current=e},[e]);const[p,d]=v.useState(null),m=q(()=>{const a=typeof f.current=="function"?f.current():f.current;if(!a)return;const E=F(r.current);E&&!r.current?.contains(E)&&U(E)||setTimeout(()=>{const t=x(a)&&a||x(p)&&p||null;t&&(t.focus(),d(null))},i)});y(function(){if(!r.current||!f.current||!n){d(null);return}d(F(r.current))},[r,n]),y(function(){return()=>{m()}},[m]),y(function(){n||m()},[n,m])},C=I.join(),P=(e,{mount:i=!0,disabled:n=!1,autoFocus:r=!0,restoreFocus:f=!0,timeout:p=0,onClose:d,captureEscapeKeyboardEvent:m=!0,mutationObserverOptions:a})=>{const{document:E}=A(),t=v.useRef([]),N=l=>{const u=t.current[l];u&&u.focus({preventScroll:!0})};b({restoreFocus:f,mount:i,timeout:p,ref:e});const g=l=>{const u=l.querySelectorAll(C),s=[];u.forEach(o=>{const{display:c,visibility:T}=getComputedStyle(o);c!=="none"&&T!=="hidden"&&s.push(o)}),s.length===0&&s.push(l),t.current=s},k=l=>{const u=[...t.current];if(g(l),!(n||!r||D(u,t.current))&&E){const s=E.activeElement,o=Math.max(E.activeElement?t.current.indexOf(s):-1,0);N(o)}};B(e,()=>e.current&&k(e.current),a),y(()=>{e.current&&g(e.current)},[e]),y(function(){if(!e.current||!r||n)return;const s=setTimeout(()=>{if(!e.current||!t.current.length)return;const o=F(e.current);M(e.current,o)||(r==="root"?e.current?.focus():t.current[0].focus())},p);return()=>{clearTimeout(s)}},[r,p,n]),y(function(){if(!e.current)return;const u=c=>{if(n)return;switch(K(c)){case w.TAB:{if(!t.current.length)return!1;const L=t.current.length-1,R=t.current.findIndex(h=>h===c.target),S=R===-1||R===L&&!c.shiftKey;if(S||R===0&&c.shiftKey){c.preventDefault();const h=t.current[S?0:L];return h!==F(h)&&h.focus(),!1}break}}return!0},s=c=>n?void 0:(K(c)===w.ESCAPE&&d&&(c.preventDefault(),d()),!0),o=O(e.current).document;return o.addEventListener("keydown",u,{capture:!0}),o.addEventListener("keydown",s,{capture:m}),()=>{o.removeEventListener("keydown",u,!0),o.removeEventListener("keydown",s,m)}},[d,e,n])};export{P as u};
