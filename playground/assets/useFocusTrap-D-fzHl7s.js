import{q as k,r as R,l as p,al as g,am as A,an as M,s as K,K as w,o as O,ao as x,ap as B}from"./iframe-BdXaAE5r.js";import{u as D}from"./useMutationObserver-epbeXk19.js";function U(e,m){return e.length!==m.length?!1:e.every((t,o)=>t===m[o])}const q=({restoreFocus:e,timeout:m,mount:t,ref:o})=>{const a=R.useRef(e);a.current=e;const[y,f]=R.useState(null),d=O(()=>{const i=typeof a.current=="function"?a.current():a.current;i&&setTimeout(()=>{const E=x(i)&&i||x(y)&&y||null;E&&(E.focus(),f(null))},m)});p(function(){if(!o.current||!a.current||!t){f(null);return}f(g(o.current))},[o,t]),p(function(){return()=>{d()}},[d]),p(function(){t||d()},[t,d])},C=B.join(),H=(e,{mount:m=!0,disabled:t=!1,autoFocus:o=!0,restoreFocus:a=!0,timeout:y=0,onClose:f,captureEscapeKeyboardEvent:d=!0,mutationObserverOptions:i})=>{const{document:E}=k(),n=R.useRef([]),I=l=>{const u=n.current[l];u&&u.focus({preventScroll:!0})};q({restoreFocus:a,mount:m,timeout:y,ref:e});const v=l=>{const u=l.querySelectorAll(C),r=[];u.forEach(s=>{const{display:c,visibility:h}=getComputedStyle(s);c!=="none"&&h!=="hidden"&&r.push(s)}),r.length===0&&r.push(l),n.current=r},N=l=>{const u=[...n.current];if(v(l),!(t||!o||U(u,n.current))&&E){const r=E.activeElement,s=Math.max(E.activeElement?n.current.indexOf(r):-1,0);I(s)}};D(e,()=>e.current&&N(e.current),i),p(()=>{e.current&&v(e.current)},[e]),p(function(){if(!e.current||!o||t)return;const r=setTimeout(()=>{if(!e.current||!n.current.length)return;const s=g(e.current);A(e.current,s)||(o==="root"?e.current?.focus():n.current[0].focus())},y);return()=>{clearTimeout(r)}},[o,y,t]),p(function(){if(!e.current)return;const u=c=>{if(t)return;switch(K(c)){case w.TAB:{if(!n.current.length)return!1;const L=n.current.length-1,T=n.current.findIndex(F=>F===c.target),S=T===-1||T===L&&!c.shiftKey;if(S||T===0&&c.shiftKey){c.preventDefault();const F=n.current[S?0:L];return F!==g(F)&&F.focus(),!1}break}}return!0},r=c=>t?void 0:(K(c)===w.ESCAPE&&f&&(c.preventDefault(),f()),!0),s=M(e.current).document;return s.addEventListener("keydown",u,{capture:!0}),s.addEventListener("keydown",r,{capture:d}),()=>{s.removeEventListener("keydown",u,!0),s.removeEventListener("keydown",r,d)}},[f,e,t])};export{H as u};
