import{r as i,aD as v,p as M,X as F,j as o,i as L,o as R}from"./iframe-BW2_2Sqh.js";import{t as H}from"./throttle-CuRfLcRJ.js";import{u as q}from"./useGlobalEventListener-DBCEN9bj.js";import{S as G}from"./Spinner-Ck410QJW.js";import{B as k}from"./Button-B8UDwXDh.js";import{m as Q}from"./index-7moDvk2l.js";import{F as O}from"./Flex-DFbImX0X.js";import{T as N}from"./Title-BsNL9OHU.js";import{G as A}from"./Group-CUaPdFZ2.js";import{S as U}from"./Search-CF1b5vV0.js";import{F as Y}from"./Footer-BgMLO1jW.js";import{C as z}from"./Counter-BX62W5qJ.js";import{f as X}from"./blocks-DLFUs-pV.js";function J(e,s){return Object.entries(e).reduce((n,[t,r])=>(s(r,t)&&Object.assign(n,{[t]:r}),n),{})}const P=(e,s)=>{const[n,t]=i.useState(""),[r,a]=i.useState(!1),{scrollTo:c}=v(),m=i.useMemo(()=>H(h=>{t(h),a(!1)},1e3),[]),S=i.useMemo(()=>(c(0,0),s(e,n)),[e,s,n,c]),y=i.useCallback(h=>{a(!0),m(h.target.value)},[m]);return{loading:r,onUpdateQuery:y,config:S,query:n}},W=24,K=64,Z=(e,s,n)=>{const{window:t,document:r}=M(),[a,c]=i.useState({mountedSections:[],sectionsVisibilityData:{}}),m=i.useRef({}),S=()=>{const u={};Object.entries(s).forEach(([d,l])=>{if(l&&l.current){const p=e.find(f=>f.id===d);p&&(u[d]={data:p,bounds:{height:l.current.offsetHeight,offsetTop:l.current.offsetTop}})}}),m.current=u},y=()=>{if(!t||!r)return;const u=t.pageYOffset;c(d=>{const{mountedSections:l,sectionsVisibilityData:p}=d;if(l.length<e.length){const f=r.documentElement.scrollHeight-t.innerHeight-W-K;if(u>=f){const g=e[l.length];return{mountedSections:[...l,g.id],sectionsVisibilityData:{...p,[g.id]:g}}}}return d})},h=()=>{const u=m.current;if(!t||!r)return;const d=t.pageYOffset;c(l=>{const{mountedSections:p}=l,f={};return p.forEach(x=>{const g=u[x];if(!g)return;const{bounds:b,data:C}=g;if(b.offsetTop+b.height<=d||b.offsetTop>=d+t.innerHeight){f[x]={...C,minHeight:b.height,hidden:!0};return}f[x]=C}),{mountedSections:p,sectionsVisibilityData:f}}),y()};return i.useEffect(()=>c({mountedSections:[],sectionsVisibilityData:{}}),[e]),i.useEffect(S,[s]),F(n,()=>requestAnimationFrame(y)),q(t,"scroll",h),{remappedSections:i.useMemo(()=>a.mountedSections.map(u=>a.sectionsVisibilityData[u]).filter(Boolean),[a.mountedSections,a.sectionsVisibilityData]),showMoreElement:a.mountedSections.length<e.length&&o.jsx(G,{})}},$="_header_1q5wd_6",ee="_upButton_1q5wd_23",te="_hidden_1q5wd_33",I={header:$,upButton:ee,hidden:te},ne=()=>{const[e,s]=i.useState(!1),{scrollTo:n,getScroll:t}=v(),{window:r}=M(),a=i.useMemo(()=>H(()=>s(t().y>=((r==null?void 0:r.innerHeight)||0)),1e3),[t,r]);return q(r,"scroll",a),o.jsx("div",{className:L(I.upButton,!e&&I.hidden),children:o.jsx(k,{borderRadiusMode:"inherit",size:"l",after:o.jsx(Q,{}),onMouseDown:()=>n(0,0)})})},w=i.createContext({searchedQuery:""}),ge=()=>i.useContext(w),Se=({title:e,config:s,filterConfig:n,remapConfigToSections:t,ItemsContainer:r,renderSectionItem:a,additionalHeaderItem:c})=>{const m=i.useRef(null),[S,y]=i.useState({}),h=R(t),E=R(a),{config:u,loading:d,onUpdateQuery:l,query:p}=P(s,n),f=i.useMemo(()=>h(u),[u,h]),{remappedSections:x,showMoreElement:g}=Z(f,S,m),b=i.useCallback((C,T)=>{const j=i.createRef();j.current=C,y(D=>{const V={...D,[T]:j};return J(V,B=>!!B.current)})},[]);return o.jsxs(w.Provider,{value:{searchedQuery:p},children:[o.jsxs(O,{direction:"column",gap:"2xl",align:"start",className:I.header,children:[o.jsx(N,{children:e}),o.jsx(A,{separator:"hide",children:o.jsx(U,{noPadding:!0,onChange:l})}),c]}),o.jsxs(O,{direction:"column",gap:"3xl",children:[d&&o.jsx(G,{}),!d&&f.length===0&&o.jsx(Y,{children:"Ничего не найдено"}),o.jsxs(O,{direction:"column",gap:"3xl",getRootRef:m,children:[x.map(({minHeight:C,hidden:T,...j})=>o.jsx(_,{hidden:T,sectionData:j,onSectionRef:b,style:{minHeight:C},ItemsRenderer:({section:D})=>o.jsx(r,{children:D.items.map(V=>E(V,D))})},j.id)),g]})]}),o.jsx(ne,{})]})},_=i.memo(({style:e,hidden:s,sectionData:n,onSectionRef:t,ItemsRenderer:r})=>{const a=i.useCallback(c=>{t(c,n.id)},[n.id,t]);return o.jsx(O,{direction:"column",gap:"xl",getRootRef:a,style:e,children:s?null:o.jsxs(o.Fragment,{children:[o.jsxs(O,{align:"center",gap:"m",children:[o.jsx(N,{level:"2",children:n.title}),o.jsx(z,{size:"m",mode:"primary",appearance:"accent-red",children:n.items.length})]}),o.jsx(r,{section:n})]})})},(e,s)=>{var n,t;return e.sectionData.id===s.sectionData.id&&e.sectionData.items.length===s.sectionData.items.length&&e.onSectionRef===s.onSectionRef&&e.hidden===s.hidden&&((n=e.style)==null?void 0:n.minHeight)===((t=s.style)==null?void 0:t.minHeight)});_.displayName="Section";Object.defineProperty(_,"name",{value:"Section"});try{_.displayName="Section",_.__docgenInfo={description:"",displayName:"Section",props:{title:{defaultValue:null,description:"",name:"title",required:!0,type:{name:"string"}},config:{defaultValue:null,description:"",name:"config",required:!0,type:{name:"CONFIG"}},filterConfig:{defaultValue:null,description:"",name:"filterConfig",required:!0,type:{name:"(config: CONFIG, query: string) => CONFIG"}},remapConfigToSections:{defaultValue:null,description:"",name:"remapConfigToSections",required:!0,type:{name:"(config: CONFIG) => Section<ITEM>[]"}},ItemsContainer:{defaultValue:null,description:"",name:"ItemsContainer",required:!0,type:{name:"ComponentType<HasChildren>"}},renderSectionItem:{defaultValue:null,description:"",name:"renderSectionItem",required:!0,type:{name:"(item: ITEM, section: Section<ITEM>) => ReactElement<unknown, string | JSXElementConstructor<any>>"}},additionalHeaderItem:{defaultValue:null,description:"",name:"additionalHeaderItem",required:!1,type:{name:"ReactElement<unknown, string | JSXElementConstructor<any>>"}}}}}catch{}const ye=()=>{var n,t;const e=i.useContext(X),s=(t=(n=e==null?void 0:e.store)==null?void 0:n.userGlobals)==null?void 0:t.globals;if(s){const{colorScheme:r="light",platform:a="vkcom",direction:c="ltr",hasCustomPanelHeaderAfter:m=!1,hasPointer:S=!1}=s;return{colorScheme:r,platform:a,direction:c,hasCustomPanelHeaderAfter:m,hasPointer:S}}return{colorScheme:"light",platform:"vkcom",direction:"ltr",hasCustomPanelHeaderAfter:!1,hasPointer:!1}};export{Se as O,ge as a,ye as u};
