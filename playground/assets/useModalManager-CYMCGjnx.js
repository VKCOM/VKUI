import{r as s,j as A}from"./iframe-BJ9555aC.js";import{A as h}from"./AppRootPortal-Du-f4Doj.js";import{M as R,f as S,c as w}from"./ModalOutlet-DOohz1vI.js";import{M as x}from"./ModalCard-BM3t_U71.js";import{a as k}from"./ModalPageHeader-Bl6EAlAB.js";import{v as V}from"./v4-EwEgHOG0.js";const D=({activeModal:u,children:e,modalOverlayTestId:l,noFocusToDialog:a,disableModalOverlay:n,usePortal:o,onOpen:d,onOpened:r,onClose:E,onClosed:f,onOverlayClosed:M,onOverlayShowed:t,disableCloseAnimation:p,disableOpenAnimation:i})=>{const m=s.useMemo(()=>({isInsideModal:!0,activeModal:u,modalOverlayTestId:l,noFocusToDialog:a,disableModalOverlay:n,disableCloseAnimation:p,disableOpenAnimation:i,onOpen:d,onOpened:r,onClose:E,onClosed:f}),[u,p,n,i,l,a,E,f,d,r]),c=s.useRef(null);return A.jsx(h,{usePortal:o,children:A.jsx(R.Provider,{value:m,children:A.jsxs(S.Provider,{value:c,children:[!n&&A.jsx(w,{position:"fixed",visible:typeof u=="string",getRootRef:c,onShowed:t,onClosed:M,disableCloseAnimation:p,disableOpenAnimation:i}),e]})})})};try{D.displayName="ModalRoot",D.__docgenInfo={description:"",displayName:"ModalRoot",props:{onOverlayClosed:{defaultValue:null,description:"",name:"onOverlayClosed",required:!1,type:{name:"(() => void)"}},onOverlayShowed:{defaultValue:null,description:"",name:"onOverlayShowed",required:!1,type:{name:"(() => void)"}},activeModal:{defaultValue:null,description:"Открывает модальное окно с переданным id.",name:"activeModal",required:!1,type:{name:"ModalRootActiveModal"}},modalOverlayTestId:{defaultValue:null,description:"`data-testid` для маски.",name:"modalOverlayTestId",required:!1,type:{name:"string"}},noFocusToDialog:{defaultValue:null,description:"Отключает фокус на контейнер диалогового окна при открытии.\n\n> Важно установить фокус после открытия в любое место модалки используя событие `onOpened`, иначе не будет работать закрытие по нажатию `Esc`.",name:"noFocusToDialog",required:!1,type:{name:"boolean"}},usePortal:{defaultValue:null,description:"",name:"usePortal",required:!1,type:{name:"boolean | HTMLElement | RefObject<HTMLElement | null> | null"}},onOpen:{defaultValue:null,description:"Будет вызвано при начале открытия активной модалки с её id.",name:"onOpen",required:!1,type:{name:"ModalRootCallbackFunction"}},onOpened:{defaultValue:null,description:"Будет вызвано при окончательном открытии активной модалки с её id.",name:"onOpened",required:!1,type:{name:"ModalRootCallbackFunction"}},onClose:{defaultValue:null,description:"Будет вызвано при начале закрытия активной модалки с её id.",name:"onClose",required:!1,type:{name:"ModalRootCallbackFunction"}},onClosed:{defaultValue:null,description:"Будет вызвано при окончательном закрытии активной модалки с её id.",name:"onClosed",required:!1,type:{name:"ModalRootCallbackFunction"}},disableModalOverlay:{defaultValue:null,description:"Отключает отображение и взаимодействие с фоном модалки.",name:"disableModalOverlay",required:!1,type:{name:"boolean"}},disableOpenAnimation:{defaultValue:null,description:"Отключает анимацию появления .",name:"disableOpenAnimation",required:!1,type:{name:"boolean"}},disableCloseAnimation:{defaultValue:null,description:"Отключает анимацию закрытия модалки.",name:"disableCloseAnimation",required:!1,type:{name:"boolean"}}}}}catch{}const I=(u,e)=>u.overlayShowed===e?u:{...u,overlayShowed:e},_=(u,e)=>{const{modals:l}=u,a=l.filter(({id:n})=>e!==n);return{...u,modals:a}},b=(u,e,l)=>{const{modals:a,activeModal:n}=u;let o=n;l.add(e);const d=a.findIndex(({id:r})=>e===r);return n===e&&d===a.length-1&&(a.length===1?o=null:o=a[d-1].id||null),{...u,activeModal:o,modals:a}},T=(u,e,l)=>{const{modals:a}=u,n={...l};"id"in n&&delete n.id;const o=a.findIndex(E=>E.id===e);if(o===-1)return u;const d=a[o],r=(()=>{switch(d.type){case"page":case"card":return{...d,modalProps:{...d.modalProps,...n}}}})();return{...u,modals:[...a.slice(0,o),r,...a.slice(o+1)]}},j=(u,e)=>{const{modals:l,activeModal:a}=u,n=l.filter(({id:o})=>a===o);return a&&e.add(a),{...u,modals:n,activeModal:null}},H=(u,e,l)=>{const{activeModal:a}=u;return a?a===e?b(u,a,l):_(u,e):u},N=(u,e)=>u.modals.find(l=>l.id===e.id)?u:{...u,modals:[...u.modals,e],activeModal:e.id||null},v=(u,e)=>{if(!u.activeModal)return;const l=u.modals.find(a=>a.id===u.activeModal);if(l)return e(l)},L=u=>s.useMemo(()=>({disableModalOverlay:v(u,e=>e.modalProps?.disableModalOverlay)??!1,disableOpenAnimation:v(u,e=>e.modalProps?.disableOpenAnimation)??!1,disableCloseAnimation:v(u,e=>e.modalProps?.disableCloseAnimation)??!1}),[u]);function F({store:u,onOverlayClosed:e,onOverlayShowed:l,disableModalOverlay:a,disableOpenAnimation:n,disableCloseAnimation:o,...d}){const r=s.useSyncExternalStore(u.subscribe,u.getState,u.getState),E=L(r),f=a||E.disableModalOverlay,M=n||E.disableOpenAnimation,t=o||E.disableCloseAnimation,p=s.useCallback(()=>{u.setOverlayShowed(!1),e?.()},[u,e]),i=s.useCallback(()=>{u.setOverlayShowed(!0),l?.()},[u,l]);return r.modals.length>0||!f&&r.overlayShowed?A.jsx(D,{...d,activeModal:r.activeModal,disableModalOverlay:f,disableOpenAnimation:M,disableCloseAnimation:t,onOverlayClosed:p,onOverlayShowed:i,children:r.modals.map(c=>{switch(c.type){case"page":case"card":const C=c.component;return A.jsx(C,{id:c.id,modalProps:c.modalProps,...c.additionalProps,update:c.update,close:c.close},c.id)}})}):null}try{F.displayName="ContextHolder",F.__docgenInfo={description:"",displayName:"ContextHolder",props:{usePortal:{defaultValue:null,description:"",name:"usePortal",required:!1,type:{name:"boolean | HTMLElement | RefObject<HTMLElement | null> | null"}},onClose:{defaultValue:null,description:"Будет вызвано при начале закрытия активной модалки с её id.",name:"onClose",required:!1,type:{name:"ModalRootCallbackFunction"}},onClosed:{defaultValue:null,description:"Будет вызвано при окончательном закрытии активной модалки с её id.",name:"onClosed",required:!1,type:{name:"ModalRootCallbackFunction"}},onOpen:{defaultValue:null,description:"Будет вызвано при начале открытия активной модалки с её id.",name:"onOpen",required:!1,type:{name:"ModalRootCallbackFunction"}},modalOverlayTestId:{defaultValue:null,description:"`data-testid` для маски.",name:"modalOverlayTestId",required:!1,type:{name:"string"}},noFocusToDialog:{defaultValue:null,description:"Отключает фокус на контейнер диалогового окна при открытии.\n\n> Важно установить фокус после открытия в любое место модалки используя событие `onOpened`, иначе не будет работать закрытие по нажатию `Esc`.",name:"noFocusToDialog",required:!1,type:{name:"boolean"}},onOpened:{defaultValue:null,description:"Будет вызвано при окончательном открытии активной модалки с её id.",name:"onOpened",required:!1,type:{name:"ModalRootCallbackFunction"}},disableModalOverlay:{defaultValue:null,description:"Отключает отображение и взаимодействие с фоном модалки.",name:"disableModalOverlay",required:!1,type:{name:"boolean"}},disableOpenAnimation:{defaultValue:null,description:"Отключает анимацию появления .",name:"disableOpenAnimation",required:!1,type:{name:"boolean"}},disableCloseAnimation:{defaultValue:null,description:"Отключает анимацию закрытия модалки.",name:"disableCloseAnimation",required:!1,type:{name:"boolean"}},onOverlayClosed:{defaultValue:null,description:"",name:"onOverlayClosed",required:!1,type:{name:"(() => void)"}},onOverlayShowed:{defaultValue:null,description:"",name:"onOverlayShowed",required:!1,type:{name:"(() => void)"}},store:{defaultValue:null,description:"",name:"store",required:!0,type:{name:"ModalStore"}}}}}catch{}const W=()=>{let u={activeModal:null,modals:[],overlayShowed:!1};const e=new Set,l=new Set,a=()=>{e.forEach(o=>o())},n=o=>{const d=o(u);d!==u&&(u=d,a())};return{getState:()=>u,subscribe:o=>(e.add(o),()=>e.delete(o)),needCloseModals:l,addModal:o=>{n(d=>N(d,o))},removeModal:o=>{n(d=>_(d,o))},updateModalProps:(o,d)=>{n(r=>T(r,o,d))},closeModal:o=>{n(d=>H(d,o,l))},closeAll:()=>{n(o=>j(o,l))},setPrevActive:o=>{n(d=>b(d,o,l))},closePrevActiveIfNoHistory:()=>{n(o=>o.activeModal?b(o,o.activeModal,l):o)},setOverlayShowed:o=>{n(d=>I(d,o))}}},O=({modalProps:u})=>A.jsx(x,{...u});try{O.displayName="ModalCardWrapper",O.__docgenInfo={description:"",displayName:"ModalCardWrapper",props:{close:{defaultValue:null,description:"",name:"close",required:!0,type:{name:"() => void"}},update:{defaultValue:null,description:"",name:"update",required:!0,type:{name:'(props: Omit<OpenModalCardProps, "id">) => void'}},modalProps:{defaultValue:null,description:"",name:"modalProps",required:!0,type:{name:"OpenModalCardProps"}}}}}catch{}const P=({modalProps:u})=>A.jsx(k,{...u});try{P.displayName="ModalPageWrapper",P.__docgenInfo={description:"",displayName:"ModalPageWrapper",props:{close:{defaultValue:null,description:"",name:"close",required:!0,type:{name:"() => void"}},update:{defaultValue:null,description:"",name:"update",required:!0,type:{name:'(props: Omit<OpenModalPageProps, "id">) => void'}},modalProps:{defaultValue:null,description:"",name:"modalProps",required:!0,type:{name:"OpenModalPageProps"}}}}}catch{}const z=(u,e,l,a)=>({onClose:(d,r)=>{l.setPrevActive(u),e.onClose?.(d,r)},onClosed:()=>{l.needCloseModals.has(u)&&(l.removeModal(u),l.needCloseModals.delete(u),a()),e.onClosed?.()}}),G=(u,e,l)=>{const{onClose:a,onClosed:n}=l;switch(u.type){case"card":return{...u,id:e,modalProps:{...u.modalProps,id:e,onClose:a,onClosed:n}};case"page":return{...u,id:e,modalProps:{...u.modalProps,id:e,onClose:a,onClosed:n}}}},g=u=>"component"in u?u:{component:u},J=({store:u,saveHistory:e})=>{const l=s.useRef(e);s.useEffect(()=>{l.current=e},[e]);const a=s.useCallback(t=>{const p=t.modalProps||{},i=t.id;let m;const c=new Promise(B=>{m=B}),C=z(i,p,u,m),y=G(t,i,C);return l.current||u.closePrevActiveIfNoHistory(),u.addModal(y),{id:i,close:()=>u.closeModal(i),onClose:B=>c.then(B),update:t.update}},[u]),n=s.useCallback((...t)=>{const[p,i,m]=t;u.updateModalProps(p,m)},[u]),o=s.useCallback(t=>{u.closeModal(t)},[u]),d=s.useCallback(t=>{const{id:p,component:i,baseProps:m,additionalProps:c}=g(t),C=p||V();return a({type:"card",id:C,component:i,additionalProps:c,modalProps:m,close:()=>o(C),update:y=>n(C,"card",y)})},[o,a,n]),r=s.useCallback(t=>{const{id:p,component:i,baseProps:m,additionalProps:c}=g(t),C=p||V();return a({type:"page",id:C,component:i,additionalProps:c,modalProps:m,close:()=>o(C),update:y=>n(C,"page",y)})},[o,a,n]),E=s.useCallback(t=>r({id:t.id,component:P,baseProps:t}),[r]),f=s.useCallback(t=>d({id:t.id,component:O,baseProps:t}),[d]),M=s.useCallback(()=>{u.closeAll()},[u]);return{openModalPage:E,openModalCard:f,openCustomModalCard:d,openCustomModalPage:r,close:o,update:n,closeAll:M}},q=({saveHistory:u=!0,...e}={})=>{const[l]=s.useState(W),[a,n]=s.useState(u);s.useEffect(()=>{n(u)},[u]);const{openModalPage:o,openModalCard:d,openCustomModalCard:r,openCustomModalPage:E,close:f,update:M,closeAll:t}=J({store:l,saveHistory:a}),p=s.useMemo(()=>({openModalPage:o,openModalCard:d,openCustomModalCard:r,openCustomModalPage:E,close:f,update:M,closeAll:t,setSaveHistory:n}),[f,t,r,E,d,o,M]),i=s.useMemo(()=>A.jsx(F,{...e,store:l}),[e,l]);return[p,i]};try{q.displayName="useModalManager",q.__docgenInfo={description:"",displayName:"useModalManager",props:{usePortal:{defaultValue:null,description:"",name:"usePortal",required:!1,type:{name:"boolean | HTMLElement | RefObject<HTMLElement | null> | null"}},onClose:{defaultValue:null,description:"Будет вызвано при начале закрытия активной модалки с её id.",name:"onClose",required:!1,type:{name:"ModalRootCallbackFunction"}},onClosed:{defaultValue:null,description:"Будет вызвано при окончательном закрытии активной модалки с её id.",name:"onClosed",required:!1,type:{name:"ModalRootCallbackFunction"}},onOpen:{defaultValue:null,description:"Будет вызвано при начале открытия активной модалки с её id.",name:"onOpen",required:!1,type:{name:"ModalRootCallbackFunction"}},modalOverlayTestId:{defaultValue:null,description:"`data-testid` для маски.",name:"modalOverlayTestId",required:!1,type:{name:"string"}},noFocusToDialog:{defaultValue:null,description:"Отключает фокус на контейнер диалогового окна при открытии.\n\n> Важно установить фокус после открытия в любое место модалки используя событие `onOpened`, иначе не будет работать закрытие по нажатию `Esc`.",name:"noFocusToDialog",required:!1,type:{name:"boolean"}},onOpened:{defaultValue:null,description:"Будет вызвано при окончательном открытии активной модалки с её id.",name:"onOpened",required:!1,type:{name:"ModalRootCallbackFunction"}},disableModalOverlay:{defaultValue:null,description:"Отключает отображение и взаимодействие с фоном модалки.",name:"disableModalOverlay",required:!1,type:{name:"boolean"}},disableOpenAnimation:{defaultValue:null,description:"Отключает анимацию появления .",name:"disableOpenAnimation",required:!1,type:{name:"boolean"}},disableCloseAnimation:{defaultValue:null,description:"Отключает анимацию закрытия модалки.",name:"disableCloseAnimation",required:!1,type:{name:"boolean"}},onOverlayClosed:{defaultValue:null,description:"",name:"onOverlayClosed",required:!1,type:{name:"(() => void)"}},onOverlayShowed:{defaultValue:null,description:"",name:"onOverlayShowed",required:!1,type:{name:"(() => void)"}},saveHistory:{defaultValue:{value:"true"},description:"",name:"saveHistory",required:!1,type:{name:"boolean"}}}}}catch{}export{D as M,q as u};
