import{j as p,Z as ie,k as Ae,t as ce,r as o,i as Ne,h as ke,T as Te,at as pe,K as m,ar as I,b4 as Le,aq as de}from"./iframe-DhuutAfC.js";import{c as me}from"./callMultiple-ChqatQlo.js";import{F as je}from"./FormField-a8bHx8UE.js";import{I as Me}from"./IconButton-CS1h91J8.js";import{I as Pe}from"./cancel_16-B_c_nEwm.js";import{u as He,a as we}from"./useEnsuredControl-BpH5tC17.js";import{u as ze}from"./useNativeFormResetListener-BYpumOEf.js";import{C as Se}from"./Chip-OkFiCIon.js";function ye(e){return e?e.replace(/([.*+?^${}()|[\]\/\\])/g,"\\$1"):""}const X=({className:e,onClick:t,...l})=>p.jsx(Me,{Component:"button",label:"Очистить поле",onKeyDown:ie,type:"button",activeMode:"opacity",hoverMode:"opacity",...l,className:e,onClick:a=>{ie(a),a.preventDefault(),t()},children:p.jsx(Pe,{})});try{X.displayName="FormFieldClearButton",X.__docgenInfo={description:"",displayName:"FormFieldClearButton",props:{className:{defaultValue:null,description:"`className` для компонента.",name:"className",required:!1,type:{name:"string"}},onClick:{defaultValue:null,description:"Обработчик нажатия на кнопку.",name:"onClick",required:!0,type:{name:"() => void"}},disabled:{defaultValue:null,description:"Блокировка взаимодействия с компонентом.",name:"disabled",required:!1,type:{name:"boolean"}}}}}catch{}const Z=[],w="";function J(e){return e.value}function Q(e){return e.label}function Ye(e,t){return{value:e,label:t}}function ee(e){const{label:t,...l}=e;return p.jsx(Se,{removable:!e.disabled,...l,children:t})}try{J.displayName="getOptionValueDefault",J.__docgenInfo={description:"",displayName:"getOptionValueDefault",props:{value:{defaultValue:null,description:"Значение опции.",name:"value",required:!0,type:{name:"ChipOptionValue"}},label:{defaultValue:null,description:"Отображаемый текст опции.",name:"label",required:!0,type:{name:"ChipOptionLabel"}},disabled:{defaultValue:null,description:"Блокировка взаимодействия с оцией.",name:"disabled",required:!1,type:{name:"boolean"}}}}}catch{}try{Q.displayName="getOptionLabelDefault",Q.__docgenInfo={description:"",displayName:"getOptionLabelDefault",props:{value:{defaultValue:null,description:"Значение опции.",name:"value",required:!0,type:{name:"ChipOptionValue"}},label:{defaultValue:null,description:"Отображаемый текст опции.",name:"label",required:!0,type:{name:"ChipOptionLabel"}},disabled:{defaultValue:null,description:"Блокировка взаимодействия с оцией.",name:"disabled",required:!1,type:{name:"boolean"}}}}}catch{}try{ee.displayName="renderChipDefault",ee.__docgenInfo={description:"",displayName:"renderChipDefault",props:{label:{defaultValue:null,description:"Отображаемый текст чипа.",name:"label",required:!0,type:{name:"ChipOptionLabel"}},mode:{defaultValue:null,description:"Режим отображения компонента.",name:"mode",required:!1,type:{name:"enum",value:[{value:'"primary"'},{value:'"secondary"'}]}},value:{defaultValue:null,description:"Значение чипа.",name:"value",required:!1,type:{name:"ChipOptionValue"}},removable:{defaultValue:null,description:"Можно ли удалить чип.",name:"removable",required:!1,type:{name:"boolean"}},disabled:{defaultValue:null,description:"Блокировка взаимодействия с чипом.",name:"disabled",required:!1,type:{name:"boolean"}},readOnly:{defaultValue:null,description:"Режим только для чтения.",name:"readOnly",required:!1,type:{name:"boolean"}},removeLabel:{defaultValue:null,description:"Текст для кнопки удаления.",name:"removeLabel",required:!1,type:{name:"string"}},before:{defaultValue:null,description:"Контент перед основным содержимым.",name:"before",required:!1,type:{name:"ReactNode"}},after:{defaultValue:null,description:"Контент после основного содержимого.",name:"after",required:!1,type:{name:"ReactNode"}},onRemove:{defaultValue:null,description:"Обработчик удаления чипа.",name:"onRemove",required:!1,type:{name:"((event: MouseEvent<Element, MouseEvent>, value: ChipOptionValue) => void)"}},Component:{defaultValue:null,description:"",name:"Component",required:!1,type:{name:"ElementType<any, keyof IntrinsicElements>"}},getRootRef:{defaultValue:null,description:"",name:"getRootRef",required:!1,type:{name:"Ref<HTMLElement>"}}}}}catch{}const he=e=>typeof e=="object"&&"value"in e,fe=e=>e?e.value===w:!0,Ke=(e,t)=>{const l=he(e)?e.value:e;return t.findIndex(a=>a.value===l)},G=e=>{const t=e&&e.dataset.index;return typeof t=="string"?Number(t):-1},$e=e=>{const t=e&&e.dataset.value;return(e&&e.dataset.valueType)==="number"?Number(t):typeof t=="string"?t:-1},Ue=(e,t,l)=>{const a=l-1;switch(t){case"prev":const i=e-1;return i<0?a:i;case"next":const C=e+1;return C>a?0:C;case"last":return a;case"first":return 0;default:return-1}},We="_host_j893j_1",Ge="_listBox_j893j_16",Xe="_chip_j893j_25",Ze="_el_j893j_30",Je="_hasPlaceholder_j893j_44",Qe="_hasInputValue_j893j_45",eu="_sizeYCompact_j893j_79",uu="_sizeYNone_j893j_84",g={host:We,listBox:Ge,chip:Xe,el:Ze,hasPlaceholder:Je,hasInputValue:Qe,sizeYCompact:eu,sizeYNone:uu},tu={none:g.sizeYNone,compact:g.sizeYCompact},ve=({getRootRef:e,style:t,className:l,before:a,after:i,status:C,mode:z,maxHeight:S,value:B=Z,onAddChipOption:O,onRemoveChipOption:x,renderChip:Y=ee,getRef:y,inputValue:R=w,addOnBlur:K,onInputChange:q,ClearButton:f=X,clearButtonShown:h,clearButtonTestId:_,onClear:A,chipsListLabel:$="Выбранные элементы","aria-label":j="",slotProps:M,...U})=>{const{sizeY:P="none"}=Ae(),{className:s,style:E,getRootRef:D,onClick:v,onMouseDown:N,...F}=ce({getRootRef:e,style:t,className:l},M?.root),{getRootRef:c,onBlur:k,placeholder:T,readOnly:L,disabled:b,id:Ee,value:ue=w,...be}=ce({getRootRef:y,className:g.el,value:R,onChange:q,...U},M?.input),ge=o.useId(),r=Ne(c),Re=o.useRef(null),d=o.useRef(null),V=B.length,te=V===0,[Ve,ne]=o.useState(0),ae=u=>{ne(0),u.focus()},H=(u,n,qe)=>{const oe=Ue(u,n,V),se=qe.querySelector(`[data-index="${oe}"]`);se&&(ne(oe),se.focus())},le=(u,n)=>{!r.current||!d.current||(V>1?n===V-1?H(n,"prev",d.current):H(n,"next",d.current):ae(r.current),x(u))},_e=u=>{const n=u.target;if(!(u.defaultPrevented||!d.current||!pe(n)))switch(u.key){case m.ENTER:{!L&&I(n,r.current)&&r.current&&!fe(r.current)&&(u.preventDefault(),O(r.current.value));break}case m.DELETE:case m.BACKSPACE:{!L&&V>0&&(I(n,r.current)?u.key===m.BACKSPACE&&fe(r.current)&&(u.preventDefault(),H(G(n),"last",d.current)):(u.preventDefault(),le($e(n),G(n))));break}case m.HOME:case m.END:case m.ARROW_UP:case m.ARROW_LEFT:case m.ARROW_DOWN:case m.ARROW_RIGHT:{V!==0&&!I(n,r.current)&&(u.preventDefault(),H(G(n),Le(u.key),d.current));break}}},De=u=>{k&&k(u),K&&!u.defaultPrevented&&r.current&&O(r.current.value)},Fe=(u,n)=>{u.preventDefault(),u.stopPropagation(),le(n,Ke(n,B))},Ie=u=>{const n=de(u.currentTarget);u.defaultPrevented||I(u.currentTarget,n)||r.current&&r.current.focus()},re=o.useCallback(()=>{r.current&&ae(r.current),A()},[r,A]),W=o.useMemo(()=>{if(h)return p.jsx(f,{onClick:re,disabled:b,"data-testid":_})},[f,h,_,b,re]),Be=o.useMemo(()=>{if(W||i)return p.jsxs(p.Fragment,{children:[W,i]})},[i,W]),Oe=Ee||`chips-input-base-generated-id-${ge}`,xe=u=>{if(pe(u.target)&&I(d.current,u.target)&&d.current!==u.target)return;const n=de(u.currentTarget);I(d.current,n)||u.target!==r.current&&u.preventDefault()};return p.jsx(je,{Component:"div",getRootRef:D,role:"group","aria-label":j,style:E,disabled:b,before:a,after:Be,status:C,mode:z,className:s,maxHeight:S,onClick:b?v:me(Ie,v),onMouseDown:me(xe,N),...F,children:p.jsxs("div",{className:ke(g.host,P!=="regular"&&tu[P],te&&g.hasPlaceholder,ue&&g.hasInputValue),ref:Re,onKeyDown:b?void 0:_e,children:[p.jsx("div",{className:g.listBox,ref:d,role:"listbox","aria-orientation":"horizontal","aria-disabled":b,"aria-readonly":L,"aria-label":$,children:B.map((u,n)=>p.jsx(o.Fragment,{children:Y({Component:"div",value:u.value,label:u.label,disabled:u.disabled||b,readOnly:u.readOnly||L,className:g.chip,onRemove:Fe,"data-index":n,"data-value":u.value,"data-value-type":typeof u.value,tabIndex:Ve===n?0:-1,role:"option","aria-selected":!0,"aria-posinset":n+1,"aria-setsize":V,"aria-description":"Для удаления используйте Backspace или Delete"},u)},`${typeof u.value}-${u.value}`))}),p.jsx(Te,{autoCapitalize:"none",autoComplete:"off",autoCorrect:"off",spellCheck:!1,"aria-label":j,Component:"input",type:"text",id:Oe,getRootRef:r,disabled:b,readOnly:L,value:ue,placeholder:te?T:void 0,onBlur:De,...be})]})})};try{ve.displayName="ChipsInputBase",ve.__docgenInfo={description:"",displayName:"ChipsInputBase",props:{onClear:{defaultValue:null,description:"Обработчик очистки всех выбранных опций.",name:"onClear",required:!0,type:{name:"() => void"}},onAddChipOption:{defaultValue:null,description:"Обработчик добавления новой опции чипа.",name:"onAddChipOption",required:!0,type:{name:"(value: string) => void"}},onRemoveChipOption:{defaultValue:null,description:"Обработчик удаления опции чипа.",name:"onRemoveChipOption",required:!0,type:{name:"(value: ChipOptionValue | O) => void"}},getRef:{defaultValue:null,description:"@deprecated Since 7.9.0. Вместо этого используйте `slotProps={ input: { getRootRef: ... } }`.",name:"getRef",required:!1,type:{name:"Ref<HTMLInputElement>"}},slotProps:{defaultValue:null,description:"Свойства, которые можно прокинуть внутрь компонента:\n- `root`: свойства для прокидывания в корень компонента;\n- `input`: свойства для прокидывания в поле ввода.",name:"slotProps",required:!1,type:{name:"{ root?: (HTMLAttributes<HTMLDivElement> & HasRootRef<HTMLDivElement> & HasDataAttribute); input?: (InputHTMLAttributes<...> & ... 1 more ... & HasDataAttribute); } | undefined"}},addOnBlur:{defaultValue:null,description:"Добавляет значение в список на событие `onBlur`.",name:"addOnBlur",required:!1,type:{name:"boolean"}},renderChip:{defaultValue:{value:"Используется [Chip](#/Chip)"},description:"Render prop функция для возврата своего компонента.",name:"renderChip",required:!1,type:{name:"RenderChip<O>"}},clearButtonShown:{defaultValue:null,description:"Показывать ли кнопку для очистки значения.",name:"clearButtonShown",required:!1,type:{name:"boolean"}},clearButtonTestId:{defaultValue:null,description:"(e2e) testId кнопки очистки.",name:"clearButtonTestId",required:!1,type:{name:"string"}},ClearButton:{defaultValue:{value:`({
  className,
  onClick,
  ...restProps
}: FormFieldClearButtonProps): React.ReactNode => {
  return (
    <IconButton
      Component="button"
      label="Очистить поле"
      onKeyDown={stopPropagation}
      type="button"
      activeMode="opacity"
      hoverMode="opacity"
      {...restProps}
      className={className}
      onClick={(e) => {
        stopPropagation(e);
        e.preventDefault();
        onClick();
      }}
    >
      <Icon16Cancel />
    </IconButton>
  );
}`},description:"Кастомная кнопка для очистки значения.\nДолжна принимать обязательное свойство `onClick`.",name:"ClearButton",required:!1,type:{name:"ComponentType<FormFieldClearButtonProps>"}},chipsListLabel:{defaultValue:{value:"Выбранные элементы"},description:"`aria-label` для списка выбранных опций.",name:"chipsListLabel",required:!1,type:{name:"string"}},disabled:{defaultValue:null,description:"Блокировка взаимодействия с компонентом.",name:"disabled",required:!1,type:{name:"boolean"}},value:{defaultValue:{value:"[]"},description:"Выбранные опции.",name:"value",required:!1,type:{name:"O[]"}},delimiter:{defaultValue:null,description:`Символ или строка, которая будет использоваться как разделитель для автоматического создания опций из текста, введенного в поле ввода.
Принимает:
- \`string\` - простая строка
- \`RegExp\` - регулярное выражение
- \`string[]\` - массив строк, по которым нужно разелять ввод.

Работает в двух сценариях:
1. При вводе разделителя - текст до разделителя автоматически преобразуется в новую опцию.
   Например, при \`delimiter=","\` ввод "опция1," создаст опцию "опция1".

2. При вставке из буфера обмена - если вставляемый текст содержит разделители,
   он будет автоматически разбит на несколько опций.
   Например, при \`delimiter=","\` вставка "опция1,опция2,опция3" создаст
   три отдельные опции: "опция1", "опция2" и "опция3".`,name:"delimiter",required:!1,type:{name:"string | RegExp | string[]"}},inputValue:{defaultValue:{value:""},description:"Значение поля ввода.",name:"inputValue",required:!1,type:{name:"string"}},onInputChange:{defaultValue:null,description:"Обработчик изменения значения в поле ввода.",name:"onInputChange",required:!1,type:{name:"OnInputChange"}},getRootRef:{defaultValue:null,description:"",name:"getRootRef",required:!1,type:{name:"Ref<HTMLDivElement>"}},align:{defaultValue:null,description:"",name:"align",required:!1,type:{name:"enum",value:[{value:'"center"'},{value:'"right"'},{value:'"left"'}]}},mode:{defaultValue:null,description:"Режим отображения.\n\n- `default` — показывает фон, обводку и, при наличии, текст-подсказку.\n- `plain` — показывает только текст-подсказку.",name:"mode",required:!1,type:{name:"enum",value:[{value:'"plain"'},{value:'"default"'}]}},status:{defaultValue:null,description:"Статус отображения поля в форме.",name:"status",required:!1,type:{name:"enum",value:[{value:'"default"'},{value:'"error"'},{value:'"valid"'}]}},after:{defaultValue:null,description:"Добавляет иконку справа.\n\nРекомендации:\n\n- Используйте следующие размеры иконок `12` | `16` | `20` | `24` | `28`.\n- Используйте [IconButton](https://vkui.io/components/icon-button), если вам нужна иконка, реагируюущая на нажатие.",name:"after",required:!1,type:{name:"ReactNode"}},before:{defaultValue:null,description:"Добавляет иконку слева.\n\nРекомендации:\n\n- Используйте следующие размеры иконок `12` | `16` | `20` | `24` | `28`.\n- Используйте [IconButton](https://vkui.io/components/icon-button), если вам нужна иконка, реагирующая на нажатие.",name:"before",required:!1,type:{name:"ReactNode"}},maxHeight:{defaultValue:null,description:"Максимальная высота поля.",name:"maxHeight",required:!1,type:{name:"number"}}}}}catch{}const nu=(e,t="")=>{try{const l=e.value;e.value=t;const a=e._valueTracker;a&&a.setValue(l);const i=new Event("input",{bubbles:!0});e.dispatchEvent(i)}catch{}},Ce=(e,t,l)=>e.map(a=>({...a,label:l(a),value:t(a)}));function au(e){const t=e.filter(a=>a.length>0);if(t.length===0)return null;const l=t.map(a=>ye(a));return new RegExp(`(?:${l.join("|")})`)}function lu(e){return e instanceof RegExp?e:typeof e=="string"?new RegExp(ye(e)):au(e)}const fu=({value:e,defaultValue:t=Z,onChange:l,getOptionLabel:a=Q,getOptionValue:i=J,getNewOptionData:C=Ye,inputValue:z,defaultInputValue:S=w,onInputChange:B,disabled:O,delimiter:x})=>{const[Y,y]=He({disabled:O,value:e?Ce(e,i,a):void 0,defaultValue:Ce(t,i,a),onChange:l}),R=o.useRef(null),[K,q]=we({disabled:O,value:z,defaultValue:S,onChange:B}),f=o.useCallback((s,E)=>{y(D=>{const v=new Set,N=s.map(c=>{const k=he(c),T=k?C(c.value,c.label):C(c,typeof c=="string"?c:"");return v.add(T.value),k?{...c,...T}:T}),F=D.filter(c=>!v.has(c.value));return E&&F.push(...N),F})},[y,C]),h=o.useCallback(()=>{R.current&&nu(R.current,"")},[R]),_=o.useCallback(s=>f([s],!0),[f]),A=o.useCallback(s=>f(s,!0),[f]),$=o.useCallback(s=>f([s],!1),[f]),j=o.useCallback(s=>{const E=s.trim();E&&(_(E),h())},[_,h]),M=o.useCallback(()=>{y(t)},[t,y]),U=o.useCallback(()=>{y(Z),h()},[h,y]),P=o.useCallback((s,E=!0)=>{const D=s.target.value,v=x?lu(x):null;if(!v||!v.test(D)||!E){q(s);return}const N=D.trim().split(v).map(F=>F.trim()).filter(Boolean);s.target.value="",s.currentTarget.value="",q(s),A(N)},[A,x,q]);return ze(R,M),{value:Y,addOption:_,addOptionFromInput:j,removeOption:$,inputRef:R,inputValue:K,onInputChange:P,clearInput:h,clearOptions:U}};export{ve as C,Z as D,J as a,Ye as b,w as c,Q as g,ee as r,Ce as t,fu as u};
