import{p as A,r as v,l as p,aq as h,ar as M,as as O,q as K,K as w,o as q,at as x,au as I}from"./iframe-DIYy3-CH.js";import{u as B}from"./useMutationObserver-CRE9L4FZ.js";function D(e,i){return e.length!==i.length?!1:e.every((n,r)=>n===i[r])}function U(e){return I.some(i=>e.matches(i))}const b=({restoreFocus:e,timeout:i,mount:n,ref:r})=>{const f=v.useRef(e);f.current=e;const[y,d]=v.useState(null),m=q(()=>{const a=typeof f.current=="function"?f.current():f.current;if(!a)return;const E=h(r.current);E&&!r.current?.contains(E)&&U(E)||setTimeout(()=>{const t=x(a)&&a||x(y)&&y||null;t&&(t.focus(),d(null))},i)});p(function(){if(!r.current||!f.current||!n){d(null);return}d(h(r.current))},[r,n]),p(function(){return()=>{m()}},[m]),p(function(){n||m()},[n,m])},C=I.join(),P=(e,{mount:i=!0,disabled:n=!1,autoFocus:r=!0,restoreFocus:f=!0,timeout:y=0,onClose:d,captureEscapeKeyboardEvent:m=!0,mutationObserverOptions:a})=>{const{document:E}=A(),t=v.useRef([]),N=l=>{const u=t.current[l];u&&u.focus({preventScroll:!0})};b({restoreFocus:f,mount:i,timeout:y,ref:e});const g=l=>{const u=l.querySelectorAll(C),s=[];u.forEach(o=>{const{display:c,visibility:T}=getComputedStyle(o);c!=="none"&&T!=="hidden"&&s.push(o)}),s.length===0&&s.push(l),t.current=s},k=l=>{const u=[...t.current];if(g(l),!(n||!r||D(u,t.current))&&E){const s=E.activeElement,o=Math.max(E.activeElement?t.current.indexOf(s):-1,0);N(o)}};B(e,()=>e.current&&k(e.current),a),p(()=>{e.current&&g(e.current)},[e]),p(function(){if(!e.current||!r||n)return;const s=setTimeout(()=>{if(!e.current||!t.current.length)return;const o=h(e.current);M(e.current,o)||(r==="root"?e.current?.focus():t.current[0].focus())},y);return()=>{clearTimeout(s)}},[r,y,n]),p(function(){if(!e.current)return;const u=c=>{if(n)return;switch(K(c)){case w.TAB:{if(!t.current.length)return!1;const L=t.current.length-1,R=t.current.findIndex(F=>F===c.target),S=R===-1||R===L&&!c.shiftKey;if(S||R===0&&c.shiftKey){c.preventDefault();const F=t.current[S?0:L];return F!==h(F)&&F.focus(),!1}break}}return!0},s=c=>n?void 0:(K(c)===w.ESCAPE&&d&&(c.preventDefault(),d()),!0),o=O(e.current).document;return o.addEventListener("keydown",u,{capture:!0}),o.addEventListener("keydown",s,{capture:m}),()=>{o.removeEventListener("keydown",u,!0),o.removeEventListener("keydown",s,m)}},[d,e,n])};export{P as u};
