import{p as k,r as R,l as p,a8 as g,a9 as A,aa as M,q as K,K as w,o as O,ab as x,ac as B}from"./iframe-DvsMcRqO.js";import{u as D}from"./useMutationObserver-CyH_Q3fo.js";function U(e,y){return e.length!==y.length?!1:e.every((t,u)=>t===y[u])}const b=({restoreFocus:e,timeout:y,mount:t,ref:u})=>{const l=R.useRef(e);l.current=e;const[E,f]=R.useState(null),d=O(()=>{const i=typeof l.current=="function"?l.current():l.current;i&&setTimeout(()=>{const m=x(i)&&i||x(E)&&E||null;m&&(m.focus(),f(null))},y)});p(function(){if(!u.current||!l.current||!t){f(null);return}f(g(u.current))},[u,t]),p(function(){return()=>{d()}},[d]),p(function(){t||d()},[t,d])},q=B.join(),H=(e,{mount:y=!0,disabled:t=!1,autoFocus:u=!0,restoreFocus:l=!0,timeout:E=0,onClose:f,captureEscapeKeyboardEvent:d=!0,mutationObserverOptions:i})=>{const{document:m}=k(),r=R.useRef([]),I=a=>{const c=r.current[a];c&&c.focus({preventScroll:!0})};b({restoreFocus:l,mount:y,timeout:E,ref:e});const v=a=>{const c=a.querySelectorAll(q),s=[];c.forEach(o=>{const{display:n,visibility:h}=getComputedStyle(o);n!=="none"&&h!=="hidden"&&s.push(o)}),s.length===0&&s.push(a),r.current=s},N=a=>{const c=[...r.current];if(v(a),!(t||!u||U(c,r.current))&&m){const s=m.activeElement,o=Math.max(m.activeElement?r.current.indexOf(s):-1,0);I(o)}};D(e,()=>e.current&&N(e.current),i),p(()=>{e.current&&v(e.current)},[e]),p(function(){if(!e.current||!u||t)return;const s=setTimeout(()=>{var n;if(!e.current||!r.current.length)return;const o=g(e.current);A(e.current,o)||(u==="root"?(n=e.current)==null||n.focus():r.current[0].focus())},E);return()=>{clearTimeout(s)}},[u,E,t]),p(function(){if(!e.current)return;const c=n=>{if(t)return;switch(K(n)){case w.TAB:{if(!r.current.length)return!1;const L=r.current.length-1,T=r.current.findIndex(F=>F===n.target),S=T===-1||T===L&&!n.shiftKey;if(S||T===0&&n.shiftKey){n.preventDefault();const F=r.current[S?0:L];return F!==g(F)&&F.focus(),!1}break}}return!0},s=n=>t?void 0:(K(n)===w.ESCAPE&&f&&(n.preventDefault(),f()),!0),o=M(e.current).document;return o.addEventListener("keydown",c,{capture:!0}),o.addEventListener("keydown",s,{capture:d}),()=>{o.removeEventListener("keydown",c,!0),o.removeEventListener("keydown",s,d)}},[f,e,t])};export{H as u};
