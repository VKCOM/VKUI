import{r as i,aV as w,q as M,$ as B,j as o,h as F,o as v}from"./iframe-DdZr-4mP.js";import{t as R}from"./throttle-CuRfLcRJ.js";import{u as q}from"./useGlobalEventListener-VexK5DUQ.js";import{S as H}from"./Spinner-BjrDa5Np.js";import{B as k}from"./Button-BfB_yFLJ.js";import{m as Q}from"./index-CdfzA2u9.js";import{F as T}from"./Flex-C8Z68iwv.js";import{T as G}from"./Title-D3itgTrb.js";import{G as A}from"./Group-DlK5kh75.js";import{S as z}from"./Search-COAPXGuU.js";import{F as U}from"./Footer-BfEMhyuC.js";import{C as Y}from"./Counter-D6IcbntQ.js";import{f as J}from"./blocks-BNUcgzxs.js";function P(e,t){return Object.entries(e).reduce((n,[s,r])=>(t(r,s)&&Object.assign(n,{[s]:r}),n),{})}function W(e){if(!/[а-яё]/i.test(e))return e;const t={а:"f",б:",",в:"d",г:"u",д:"l",е:"t",ё:"`",ж:";",з:"p",и:"b",й:"q",к:"r",л:"k",м:"v",н:"y",о:"j",п:"g",р:"h",с:"c",т:"n",у:"e",ф:"a",х:"[",ц:"w",ч:"x",ш:"i",щ:"o",ъ:"]",ы:"s",ь:"m",э:"'",ю:".",я:"z"};return e.split("").map(n=>t[n]||n).join("")}const X=(e,t)=>{const[n,s]=i.useState(""),[r,a]=i.useState(!1),{scrollTo:c}=w(),p=i.useMemo(()=>R(h=>{s(W(h.toLocaleLowerCase())),a(!1)},1e3),[]),C=i.useMemo(()=>(c(0,0),t(e,n)),[e,t,n,c]),S=i.useCallback(h=>{a(!0),p(h.target.value)},[p]);return{loading:r,onUpdateQuery:S,config:C,query:n}},$=24,K=64,Z=(e,t,n)=>{const{window:s,document:r}=M(),[a,c]=i.useState({mountedSections:[],sectionsVisibilityData:{}}),p=i.useRef({}),C=()=>{const u={};Object.entries(t).forEach(([d,l])=>{if(l&&l.current){const f=e.find(m=>m.id===d);f&&(u[d]={data:f,bounds:{height:l.current.offsetHeight,offsetTop:l.current.offsetTop}})}}),p.current=u},S=()=>{if(!s||!r)return;const u=s.pageYOffset;c(d=>{const{mountedSections:l,sectionsVisibilityData:f}=d;if(l.length<e.length){const m=r.documentElement.scrollHeight-s.innerHeight-$-K;if(u>=m){const g=e[l.length];return{mountedSections:[...l,g.id],sectionsVisibilityData:{...f,[g.id]:g}}}}return d})},h=()=>{const u=p.current;if(!s||!r)return;const d=s.pageYOffset;c(l=>{const{mountedSections:f}=l,m={};return f.forEach(y=>{const g=u[y];if(!g)return;const{bounds:x,data:b}=g;if(x.offsetTop+x.height<=d||x.offsetTop>=d+s.innerHeight){m[y]={...b,minHeight:x.height,hidden:!0};return}m[y]=b}),{mountedSections:f,sectionsVisibilityData:m}}),S()};return i.useEffect(()=>c({mountedSections:[],sectionsVisibilityData:{}}),[e]),i.useEffect(C,[t]),B(n,()=>requestAnimationFrame(S)),q(s,"scroll",h),{remappedSections:i.useMemo(()=>a.mountedSections.map(u=>a.sectionsVisibilityData[u]).filter(Boolean),[a.mountedSections,a.sectionsVisibilityData]),showMoreElement:a.mountedSections.length<e.length&&o.jsx(H,{})}},ee="_header_1q5wd_6",te="_upButton_1q5wd_23",ne="_hidden_1q5wd_33",I={header:ee,upButton:te,hidden:ne},oe=()=>{const[e,t]=i.useState(!1),{scrollTo:n,getScroll:s}=w(),{window:r}=M(),a=i.useMemo(()=>R(()=>t(s().y>=(r?.innerHeight||0)),1e3),[s,r]);return q(r,"scroll",a),o.jsx("div",{className:F(I.upButton,!e&&I.hidden),children:o.jsx(k,{borderRadiusMode:"inherit",size:"l",after:o.jsx(Q,{}),onMouseDown:()=>n(0,0)})})},N=i.createContext({searchedQuery:""}),Se=()=>i.useContext(N),ye=({title:e,config:t,filterConfig:n,remapConfigToSections:s,ItemsContainer:r,renderSectionItem:a,additionalHeaderItem:c})=>{const p=i.useRef(null),[C,S]=i.useState({}),h=v(s),E=v(a),{config:u,loading:d,onUpdateQuery:l,query:f}=X(t,n),m=i.useMemo(()=>h(u),[u,h]),{remappedSections:y,showMoreElement:g}=Z(m,C,p),x=i.useCallback((b,_)=>{const j=i.createRef();j.current=b,S(V=>{const D={...V,[_]:j};return P(D,L=>!!L.current)})},[]);return o.jsxs(N.Provider,{value:{searchedQuery:f},children:[o.jsxs(T,{direction:"column",gap:"2xl",align:"start",className:I.header,children:[o.jsx(G,{children:e}),o.jsx(A,{separator:"hide",children:o.jsx(z,{noPadding:!0,onChange:l})}),c]}),o.jsxs(T,{direction:"column",gap:"3xl",children:[d&&o.jsx(H,{}),!d&&m.length===0&&o.jsx(U,{children:"Ничего не найдено"}),o.jsxs(T,{direction:"column",gap:"3xl",getRootRef:p,children:[y.map(({minHeight:b,hidden:_,...j})=>o.jsx(O,{hidden:_,sectionData:j,onSectionRef:x,style:{minHeight:b},ItemsRenderer:({section:V})=>o.jsx(r,{children:V.items.map(D=>E(D,V))})},j.id)),g]})]}),o.jsx(oe,{})]})},O=i.memo(({style:e,hidden:t,sectionData:n,onSectionRef:s,ItemsRenderer:r})=>{const a=i.useCallback(c=>{s(c,n.id)},[n.id,s]);return o.jsx(T,{direction:"column",gap:"xl",getRootRef:a,style:e,children:t?null:o.jsxs(o.Fragment,{children:[o.jsxs(T,{align:"center",gap:"m",children:[o.jsx(G,{level:"2",children:n.displayTitle}),o.jsx(Y,{size:"m",mode:"primary",appearance:"accent-red",children:n.items.length})]}),o.jsx(r,{section:n})]})})},(e,t)=>e.sectionData.id===t.sectionData.id&&e.sectionData.items.length===t.sectionData.items.length&&e.onSectionRef===t.onSectionRef&&e.hidden===t.hidden&&e.style?.minHeight===t.style?.minHeight);O.displayName="Section";Object.defineProperty(O,"name",{value:"Section"});try{O.displayName="Section",O.__docgenInfo={description:"",displayName:"Section",props:{title:{defaultValue:null,description:"",name:"title",required:!0,type:{name:"string"}},config:{defaultValue:null,description:"",name:"config",required:!0,type:{name:"CONFIG"}},filterConfig:{defaultValue:null,description:"",name:"filterConfig",required:!0,type:{name:"(config: CONFIG, query: string) => CONFIG"}},remapConfigToSections:{defaultValue:null,description:"",name:"remapConfigToSections",required:!0,type:{name:"(config: CONFIG) => Section<ITEM>[]"}},ItemsContainer:{defaultValue:null,description:"",name:"ItemsContainer",required:!0,type:{name:"ComponentType<HasChildren>"}},renderSectionItem:{defaultValue:null,description:"",name:"renderSectionItem",required:!0,type:{name:"(item: ITEM, section: Section<ITEM>) => ReactElement<unknown, string | JSXElementConstructor<any>>"}},additionalHeaderItem:{defaultValue:null,description:"",name:"additionalHeaderItem",required:!1,type:{name:"ReactElement<unknown, string | JSXElementConstructor<any>>"}}}}}catch{}const xe=()=>{const t=i.useContext(J)?.store?.userGlobals?.globals;if(t){const{colorScheme:n="light",platform:s="vkcom",direction:r="ltr",hasCustomPanelHeaderAfter:a=!1,hasPointer:c=!1}=t;return{colorScheme:n,platform:s,direction:r,hasCustomPanelHeaderAfter:a,hasPointer:c}}return{colorScheme:"light",platform:"vkcom",direction:"ltr",hasCustomPanelHeaderAfter:!1,hasPointer:!1}};export{ye as O,Se as a,xe as u};
