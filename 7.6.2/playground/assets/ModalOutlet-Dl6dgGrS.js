var $=Object.defineProperty;var K=(i,e,t)=>e in i?$(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var l=(i,e,t)=>K(i,typeof e!="symbol"?e+"":e,t);import{i as j,j as L,h as q,r as c,n as S,bA as W,ae as Y,by as X,o as F,l as x,bB as J,ax as Q,p as Z,bC as ee,bD as H}from"./iframe-WscSQxk_.js";import{U as te,r as ne}from"./rubberbandIfOutOfBounds-CpUvlc2N.js";import{w as ie}from"./warnOnce-BsOPdcXO.js";import{u as se}from"./useCSSTransition-BS6jtW1c.js";import{d as oe}from"./debounce-2Cr6Hz2O.js";import{t as ae}from"./throttle-CuRfLcRJ.js";const re="_host_10iyl_1",le="_nonInteractive_10iyl_10",ue="_hostPositionAbsolute_10iyl_15",ce="_hostPositionFixed_10iyl_19",de="_hostStateEnter_10iyl_24",pe="_hostStateEntering_10iyl_29",he="_hostStateEntered_10iyl_33",fe="_hostStateExit_10iyl_37",Ee="_hostStateExiting_10iyl_42",ye="_hostStateExited_10iyl_46",f={host:re,nonInteractive:le,hostPositionAbsolute:ue,hostPositionFixed:ce,hostStateEnter:de,hostStateEntering:pe,hostStateEntered:he,hostStateExit:fe,hostStateExiting:Ee,hostStateExited:ye},me={absolute:f.hostPositionAbsolute,fixed:f.hostPositionFixed},Se={appear:f.hostStateEnter,appearing:f.hostStateEntering,appeared:f.hostStateEntered,enter:f.hostStateEnter,entering:f.hostStateEntering,entered:f.hostStateEntered,exit:f.hostStateExit,exiting:f.hostStateExiting,exited:f.hostStateExited},V=({visible:i=!1,position:e="absolute",getRootRef:t,onClick:n,...o})=>{const[a,{ref:u,onTransitionEnd:d}]=se(i,{enableAppear:!0}),m=j(t,u);return L.jsx("div",{...o,ref:m,"aria-hidden":"true",hidden:a==="exited",className:q(f.host,n===void 0&&f.nonInteractive,me[e],Se[a]),onClick:n,onTransitionEnd:d})};try{V.displayName="ModalOverlay",V.__docgenInfo={description:"",displayName:"ModalOverlay",props:{visible:{defaultValue:{value:"false"},description:"",name:"visible",required:!1,type:{name:"boolean"}},position:{defaultValue:{value:"absolute"},description:"",name:"position",required:!1,type:{name:"enum",value:[{value:'"fixed"'},{value:'"absolute"'}]}},onClick:{defaultValue:null,description:"",name:"onClick",required:!1,type:{name:"((event: MouseEvent<HTMLDivElement, MouseEvent>) => void)"}},getRootRef:{defaultValue:null,description:"",name:"getRootRef",required:!1,type:{name:"Ref<HTMLDivElement>"}}}}}catch{}const A=c.createContext({current:null}),N=c.createContext({updateModalHeight:S,registerModal:S,isInsideModal:!1});try{A.displayName="ModalRootOverlayContext",A.__docgenInfo={description:"Сохраняем `ref` компонента `ModalOverlay` из `ModalRoot` в контекст, чтобы можно было пробросить\nего до `ModalPage` и `ModalCard`.",displayName:"ModalRootOverlayContext",props:{}}}catch{}try{N.displayName="ModalRootContext",N.__docgenInfo={description:"",displayName:"ModalRootContext",props:{}}}catch{}const U="data-vkui-block-sheet-behavior",Ve={[U]:!0},k={DISTANCE_FOR_MOVING_START:12,VELOCITY:500},Ae={LOWER:25,HIGHEST:90},T={MIN:0,LARGE:100},D={IDLE_POINT_VALUE:0,COMPUTED_INDEX:1};class M{constructor(e,{sheetScrollEl:t,sheetTransitionController:n,backdropTransitionController:o,onSnapPointChange:a,onDismiss:u}){l(this,"sheetEl");l(this,"isInitialized",!1);l(this,"panState","idle");l(this,"pannedEl",null);l(this,"sheetHeight",0);l(this,"rafId",null);l(this,"currentSnapPoint",0);l(this,"nextSnapPoint",0);l(this,"snapPointDetents",[0,0]);l(this,"unit","%");l(this,"disableVerticalScrollBouncingDispose",S);l(this,"sheetScrollEl");l(this,"sheetTransitionController");l(this,"backdropTransitionController");l(this,"panGestureRecognizer");l(this,"onSnapPointChange");l(this,"onDismiss");this.sheetEl=e,this.onSnapPointChange=a,this.onDismiss=u,this.panGestureRecognizer=new te,this.sheetScrollEl=t,this.sheetTransitionController=n,this.backdropTransitionController=o}init(e){this.isInitialized=!0,e==="auto"?(this.unit="px",this.currentSnapPoint=D.IDLE_POINT_VALUE,this.snapPointDetents=[T.MIN,D.IDLE_POINT_VALUE]):(this.unit="%",this.currentSnapPoint=e.initial,this.snapPointDetents=e.detents)}destroy(){var e;this.isInitialized=!1,this.pannedEl=null,this.sheetTransitionController.cleanup(),(e=this.backdropTransitionController)==null||e.cleanup(),this.disableVerticalScrollBouncingDispose(),this.disableVerticalScrollBouncingDispose=S}panStart(e){!this.isInitialized||this.panState!=="idle"||W(e.target)||(this.panState="start",this.pannedEl=e.target,this.panGestureRecognizer.setStartCoords(e))}panMove(e){switch(this.panState){case"start":if(this.panGestureRecognizer.setInitialTimeOnce(),this.panGestureRecognizer.setEndCoords(e),this.preventUntilPanGestureBecomesExpected())return;if(this.preventImmediatelyIfPannedElIsNotValid()){this.panState="idle";return}if(this.preventUntilVerticalScrollingOnSheetScrollElBecomesExpected())return;if(this.preventImmediatelyIfVerticalScrollingOnPannedElIsScrolled()){this.panState="idle";return}this.panState="moving",this.panGestureRecognizer.setStartCoords(e),this.sheetHeight=this.sheetEl.offsetHeight,this.disableVerticalScrollBouncingDispose=M.disableVerticalScrollBouncingIfNeeded(this.sheetScrollEl,this.pannedEl),this.isDynamicSnapPoint&&(this.currentSnapPoint=this.sheetHeight,this.snapPointDetents[D.COMPUTED_INDEX]=this.sheetHeight);break;case"moving":this.panGestureRecognizer.setEndCoords(e);const{y1:t,y2:n}=this.panGestureRecognizer;this.nextSnapPoint=ne(this.currentSnapPoint-(n-t)/this.sheetHeight*this.currentSnapPoint,T.MIN,this.isDynamicSnapPoint?this.sheetHeight:T.LARGE),this.calculateSnapPoint(this.nextSnapPoint,!0);break}}panEnd(){switch(this.panState){case"moving":const e=this.currentSnapPoint;this.currentSnapPoint=this.getSnapPointTo(this.nextSnapPoint),e!==this.currentSnapPoint&&this.currentSnapPoint>T.MIN&&this.onSnapPointChange(this.currentSnapPoint),this.calculateSnapPoint(this.currentSnapPoint);break}this.panState="idle",this.panGestureRecognizer.reset(),this.disableVerticalScrollBouncingDispose(),this.disableVerticalScrollBouncingDispose=S}get isDynamicSnapPoint(){return this.unit==="px"}calculateSnapPoint(e,t=!1){var o;if(this.rafId!==null&&cancelAnimationFrame(this.rafId),e<=T.MIN){this.sheetTransitionController.enableTransition(),(o=this.backdropTransitionController)==null||o.enableTransition(),this.panState="idle",this.onDismiss();return}const n=Y(this.isDynamicSnapPoint?e/this.sheetHeight:e*2/T.LARGE,0,1);this.rafId=requestAnimationFrame(()=>{var a,u;if(t){(a=this.backdropTransitionController)==null||a.disableTransition().set(n),this.sheetTransitionController.disableTransition().set(`${e}${this.unit}`);return}this.isDynamicSnapPoint&&this.sheetTransitionController.cleanupOnTransitionEnd(),(u=this.backdropTransitionController)==null||u.unset(),this.sheetTransitionController.enableTransition().set(`${this.currentSnapPoint}${this.unit}`)})}getSnapPointTo(e){const t=M.getClosestSnapPoint(this.snapPointDetents,e);if(t!==this.currentSnapPoint)return t;const n=this.panGestureRecognizer.direction();if(n.axis!=="y"||n.direction===null)return this.currentSnapPoint;const o=this.panGestureRecognizer.velocity();return Math.abs(o.y)<k.VELOCITY?this.currentSnapPoint:M.getClosestSnapPointByDirection(this.snapPointDetents,t,n.direction)}preventUntilPanGestureBecomesExpected(){return this.panGestureRecognizer.direction().axis==="x"||this.panGestureRecognizer.distance()<k.DISTANCE_FOR_MOVING_START}preventImmediatelyIfPannedElIsNotValid(){return this.pannedEl===null||this.pannedEl.closest(`[${U}=true]`)!==null||!this.sheetEl.contains(this.pannedEl)}preventUntilVerticalScrollingOnSheetScrollElBecomesExpected(){return this.sheetScrollEl===null||!this.sheetScrollEl.contains(this.pannedEl)||this.sheetScrollEl.scrollHeight<=this.sheetScrollEl.clientHeight?!1:this.sheetScrollEl.scrollTop===0?this.panGestureRecognizer.direction().direction===-1&&M.isLastSnapPointDetents(this.snapPointDetents,this.currentSnapPoint):!0}preventImmediatelyIfVerticalScrollingOnPannedElIsScrolled(){if(this.pannedEl===null||this.pannedEl===this.sheetEl||this.pannedEl===this.sheetScrollEl)return!1;const e=X(this.pannedEl,this.sheetEl);return e===null||this.sheetScrollEl===e||e.scrollHeight<=e.clientHeight?!1:e.scrollTop!==0||this.panGestureRecognizer.direction().direction===-1}static disableVerticalScrollBouncingIfNeeded(e,t){return e!==null&&e.scrollTop<=0&&e.contains(t)&&e.scrollHeight>e.clientHeight?(e.style.setProperty("overflow-y","hidden"),function(){e.style.removeProperty("overflow-y")}):S}static isLastSnapPointDetents(e,t){return t===e[e.length-1]}static getClosestSnapPointByDirection(e,t,n){const o=e.findIndex(a=>a===t);switch(n){case-1:return e[o+1]??e[e.length-1];case 1:return e[o-1]??e[0]}}static getClosestSnapPoint(e,t){let n=e[0],o=Math.abs(e[0]-t);for(let a=1;a<e.length;a+=1){const u=Math.abs(e[a]-t);u<o&&(n=e[a],o=u)}return n}}class w{constructor(e,t){l(this,"el");l(this,"property");l(this,"handleTransitionEnd",()=>(this.cleanup(),this));this.el=e,this.property=t}set(e){return this.el.style.setProperty(this.property,`${e}`),this}unset(){return this.cleanup()}enableTransition(){return this.el.style.removeProperty("transition"),this}disableTransition(){return this.el.style.setProperty("transition","none"),this}cleanup(){return this.el.removeEventListener("transitionend",this.handleTransitionEnd),this.el.style.removeProperty("transition"),this.el.style.removeProperty(this.property),this}cleanupOnTransitionEnd(){return this.el.addEventListener("transitionend",this.handleTransitionEnd,{once:!0}),this}}const Ne=(i,{blocked:e,snapPoint:t,sheetCSSProperty:n,backdropCSSProperty:o,onSnapPointChange:a,onDismiss:u})=>{const[d,m]=c.useState(null),[r,s]=c.useState(null),[E,p]=c.useState(null),y=c.useMemo(()=>i&&t!=="auto"?{[n]:`${t.initial}%`}:void 0,[i,t,n]),v=F(a||S),b=F(u||S),h=c.useMemo(()=>!i||r===null?null:new M(r,{sheetScrollEl:d||null,sheetTransitionController:new w(r,n),backdropTransitionController:E?new w(E,o):null,onSnapPointChange:v,onDismiss:b}),[i,r,n,d,E,o,v,b]),C=function(O){e||h.panStart(O.nativeEvent)},g=function(O){h.panMove(O.nativeEvent)},_=function(){h.panEnd()};return x(function(){h&&h.init(t)},[t,h]),x(()=>function(){h&&h.destroy()},[h]),[{initialStyle:y,setSheetEl:s,setSheetScrollEl:m,setBackdropEl:p},h!==null?{onTouchStart:C,onTouchMove:g,onTouchEnd:_,onTouchCancel:_,onMouseDown:C,onMouseMove:g,onMouseUp:_,onMouseLeave:_}:void 0]},ve="_host_ntc00_1",ge={host:ve},B=({visible:i,position:e,getRootRef:t,...n})=>{const o=c.useContext(A);return L.jsx("div",{...n,"aria-hidden":"true",className:ge.host,ref:function(){J(o.current,t)}})};try{B.displayName="VisuallyHiddenModalOverlay",B.__docgenInfo={description:"`ModalRoot` выставляет общий `ModalOverlay` для всех потомков, и чтобы не нарушить логику\nв `ModalPage` и `ModalCard`, в них прокидывается данный компонент, который визуально не виден,\nно при этом на нём сохраняется возможность взаимодействия.\n\nВ `getRooRef` отдаёт ссылку на DOM общего `ModalOverlay`.",displayName:"VisuallyHiddenModalOverlay",props:{visible:{defaultValue:null,description:"",name:"visible",required:!1,type:{name:"boolean"}},position:{defaultValue:null,description:"",name:"position",required:!1,type:{name:"enum",value:[{value:'"fixed"'},{value:'"absolute"'}]}},onClick:{defaultValue:null,description:"",name:"onClick",required:!1,type:{name:"((event: MouseEvent<HTMLDivElement, MouseEvent>) => void)"}},getRootRef:{defaultValue:null,description:"",name:"getRootRef",required:!1,type:{name:"Ref<HTMLDivElement>"}}}}}catch{}const _e=ie("useModalManager"),G=({id:i,open:e,keepMounted:t,modalOverlayTestId:n,noFocusToDialog:o,disableModalOverlay:a,onOpen:u,onOpened:d,onClose:m,onClosed:r})=>{const s=c.useContext(N),E=c.useId(),p=Q({nav:i},s.isInsideModal?_e:void 0)||E,y=s.isInsideModal?s.activeModal===p:e,v=s.isInsideModal?s.activeModal!==null:!1,[b,h]=c.useState(t?!1:!y);return x(function(){!t&&y&&h(g=>g&&!1)},[y,t]),b?{mounted:!1,shouldPreserveSnapPoint:v,id:p}:{id:p,mounted:!0,open:y,shouldPreserveSnapPoint:v,noFocusToDialog:o||s.noFocusToDialog,modalOverlayTestId:n||s.modalOverlayTestId,disableModalOverlay:a||s.disableModalOverlay,ModalOverlay:s.isInsideModal?B:V,onOpen:u||P(p,s.onOpen),onOpened:d||P(p,s.onOpened),onClose:m||P(p,s.onClose),onClosed:function(...g){var _;t||h(!0),r?r(...g):(_=s.onClosed)==null||_.call(s,p)}}};function P(i,e){return e?()=>e(i):void 0}try{G.displayName="useModalManager",G.__docgenInfo={description:"",displayName:"useModalManager",props:{id:{defaultValue:null,description:"",name:"id",required:!1,type:{name:"string"}},open:{defaultValue:null,description:"",name:"open",required:!0,type:{name:"boolean"}},keepMounted:{defaultValue:null,description:"",name:"keepMounted",required:!0,type:{name:"boolean"}},modalOverlayTestId:{defaultValue:null,description:"",name:"modalOverlayTestId",required:!1,type:{name:"string"}},noFocusToDialog:{defaultValue:null,description:"",name:"noFocusToDialog",required:!1,type:{name:"boolean"}},disableModalOverlay:{defaultValue:null,description:"",name:"disableModalOverlay",required:!1,type:{name:"boolean"}},onOpen:{defaultValue:null,description:"",name:"onOpen",required:!1,type:{name:"AnyFunction"}},onOpened:{defaultValue:null,description:"",name:"onOpened",required:!1,type:{name:"AnyFunction"}},onClose:{defaultValue:null,description:"",name:"onClose",required:!1,type:{name:"AnyFunction"}},onClosed:{defaultValue:null,description:"",name:"onClosed",required:!1,type:{name:"AnyFunction"}}}}}catch{}function Be(i=!0){const{window:e,document:t}=Z(),[n,o]=c.useState(null),[a,u]=c.useState(!1),d=c.useRef(null);return c.useEffect(function(){if(!i||!e||!t)return;const r=E=>{const p=E===!0?t.activeElement:E.target;if(ee(p))switch((E===!0?{type:"focusin"}:E).type){case"focusin":d.current=H(e),o(p);break;case"focusout":d.current=null,u(!1),o(null);break}};r(!0);const s={passive:!0,capture:!1};return t.addEventListener("focusin",r,s),t.addEventListener("focusout",r,s),()=>{d.current=null,t.removeEventListener("focusin",r,s),t.removeEventListener("focusout",r,s)}},[i,e,t]),c.useEffect(function(){if(!n||!e)return;const r=oe(()=>{if(d.current===null)return;const s=H(e),{offsetTop:E,height:p}=d.current,{offsetTop:y,height:v}=s;(E!==y||p!==v)&&(u(!0),d.current=s)},100);return e.visualViewport?e.visualViewport.addEventListener("resize",r):e.addEventListener("resize",r),function(){e.visualViewport?e.visualViewport.removeEventListener("resize",r):e.removeEventListener("resize",r)}},[n,e]),c.useEffect(function(){if(!a||!e)return;const r=ae(()=>{d.current&&e.scrollTo(0,d.current.offsetTop)},100);return e.addEventListener("scroll",r,{passive:!0}),function(){e.removeEventListener("scroll",r)}},[a,e]),{opened:a}}const Te="_host_5fymc_1",Me="_disableModalOverlay_5fymc_9",be="_hostDesktop_5fymc_14",R={host:Te,disableModalOverlay:Me,hostDesktop:be},z=({className:i,hidden:e,isDesktop:t,children:n,getRootRef:o,disableModalOverlay:a,...u})=>L.jsx("div",{ref:o,className:q(i,R.host,t&&R.hostDesktop,a&&R.disableModalOverlay),hidden:e,"aria-hidden":e,...u,children:n});try{z.displayName="ModalOutlet",z.__docgenInfo={description:"",displayName:"ModalOutlet",props:{disableModalOverlay:{defaultValue:null,description:"",name:"disableModalOverlay",required:!1,type:{name:"boolean"}},hidden:{defaultValue:null,description:"",name:"hidden",required:!1,type:{name:"boolean"}},isDesktop:{defaultValue:null,description:"",name:"isDesktop",required:!1,type:{name:"boolean"}},getRootRef:{defaultValue:null,description:"",name:"getRootRef",required:!1,type:{name:"Ref<HTMLDivElement>"}}}}}catch{}export{Ve as B,N as M,T as S,A as a,V as b,Ne as c,z as d,G as e,Ae as f,Be as u};
