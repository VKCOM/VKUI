import{r as p,j as y}from"./iframe-CGSrC79H.js";import{M as V}from"./ModalCard-DdPDF4is.js";import{a as q}from"./ModalPageHeader-utsOxW49.js";import{A as h}from"./AppRootPortal-D8fiuoF8.js";import{M as R,e as S,c as w}from"./ModalOutlet-kdsRlszA.js";import{v as x}from"./v4-BKrj-4V8.js";const D=({activeModal:u,children:e,modalOverlayTestId:n,noFocusToDialog:o,disableModalOverlay:l,usePortal:a,onOpen:t,onOpened:r,onClose:m,onClosed:f,onOverlayClosed:M,onOverlayShowed:d,disableCloseAnimation:s,disableOpenAnimation:i})=>{const C=p.useMemo(()=>({isInsideModal:!0,activeModal:u,modalOverlayTestId:n,noFocusToDialog:o,disableModalOverlay:l,disableCloseAnimation:s,disableOpenAnimation:i,onOpen:t,onOpened:r,onClose:m,onClosed:f}),[u,s,l,i,n,o,m,f,t,r]),c=p.useRef(null);return y.jsx(h,{usePortal:a,children:y.jsx(R.Provider,{value:C,children:y.jsxs(S.Provider,{value:c,children:[!l&&y.jsx(w,{position:"fixed",visible:typeof u=="string",getRootRef:c,onShowed:d,onClosed:M,disableCloseAnimation:s,disableOpenAnimation:i}),e]})})})};try{D.displayName="ModalRoot",D.__docgenInfo={description:"",displayName:"ModalRoot",props:{onOverlayClosed:{defaultValue:null,description:"",name:"onOverlayClosed",required:!1,type:{name:"(() => void)"}},onOverlayShowed:{defaultValue:null,description:"",name:"onOverlayShowed",required:!1,type:{name:"(() => void)"}},activeModal:{defaultValue:null,description:"Открывает модальное окно с переданным id.",name:"activeModal",required:!1,type:{name:"ModalRootActiveModal"}},modalOverlayTestId:{defaultValue:null,description:"`data-testid` для маски.",name:"modalOverlayTestId",required:!1,type:{name:"string"}},noFocusToDialog:{defaultValue:null,description:"Отключает фокус на контейнер диалогового окна при открытии.\n\n> Важно установить фокус после открытия в любое место модалки используя событие `onOpened`, иначе не будет работать закрытие по нажатию `Esc`.",name:"noFocusToDialog",required:!1,type:{name:"boolean"}},usePortal:{defaultValue:null,description:"",name:"usePortal",required:!1,type:{name:"boolean | HTMLElement | RefObject<HTMLElement | null> | null"}},onOpen:{defaultValue:null,description:"Будет вызвано при начале открытия активной модалки с её id.",name:"onOpen",required:!1,type:{name:"ModalRootCallbackFunction"}},onOpened:{defaultValue:null,description:"Будет вызвано при окончательном открытии активной модалки с её id.",name:"onOpened",required:!1,type:{name:"ModalRootCallbackFunction"}},onClose:{defaultValue:null,description:"Будет вызвано при начале закрытия активной модалки с её id.",name:"onClose",required:!1,type:{name:"ModalRootCallbackFunction"}},onClosed:{defaultValue:null,description:"Будет вызвано при окончательном закрытии активной модалки с её id.",name:"onClosed",required:!1,type:{name:"ModalRootCallbackFunction"}},disableModalOverlay:{defaultValue:null,description:"Отключает отображение и взаимодействие с фоном модалки.",name:"disableModalOverlay",required:!1,type:{name:"boolean"}},disableOpenAnimation:{defaultValue:null,description:"Отключает анимацию появления .",name:"disableOpenAnimation",required:!1,type:{name:"boolean"}},disableCloseAnimation:{defaultValue:null,description:"Отключает анимацию закрытия модалки.",name:"disableCloseAnimation",required:!1,type:{name:"boolean"}}}}}catch{}const _=(u,e)=>u.overlayShowed===e?u:{...u,overlayShowed:e},P=(u,e)=>{const{modals:n}=u,o=n.filter(({id:l})=>e!==l);return{...u,modals:o}},b=(u,e,n)=>{const{modals:o,activeModal:l}=u;let a=l;n.add(e);const t=o.findIndex(({id:r})=>e===r);return l===e&&t===o.length-1&&(o.length===1?a=null:a=o[t-1].id||null),{...u,activeModal:a,modals:o}},k=(u,e,n)=>{const{modals:o}=u,l={...n};"id"in l&&delete l.id;const a=o.findIndex(m=>m.id===e);if(a===-1)return u;const t=o[a],r=(()=>{switch(t.type){case"custom-page":case"custom-card":return{...t,modalProps:{...t.modalProps,...l}};case"card":case"page":return{...t,...l}}})();return{...u,modals:[...o.slice(0,a),r,...o.slice(a+1)]}},I=(u,e)=>{const{modals:n,activeModal:o}=u,l=n.filter(({id:a})=>o===a);return o&&e.add(o),{...u,modals:l,activeModal:null}},T=(u,e,n)=>{const{activeModal:o}=u;return o?o===e?b(u,o,n):P(u,e):u},j=(u,e)=>u.modals.find(n=>n.id===e.id)?u:{...u,modals:[...u.modals,e],activeModal:e.id||null},v=(u,e)=>{if(!u.activeModal)return;const n=u.modals.find(o=>o.id===u.activeModal);if(n)return e(n)},H=u=>p.useMemo(()=>({disableModalOverlay:v(u,e=>e.type==="custom-card"||e.type==="custom-page"?e.modalProps?.disableModalOverlay:e.disableModalOverlay)??!1,disableOpenAnimation:v(u,e=>e.type==="custom-card"||e.type==="custom-page"?e.modalProps?.disableOpenAnimation:e.disableOpenAnimation)??!1,disableCloseAnimation:v(u,e=>e.type==="custom-card"||e.type==="custom-page"?e.modalProps?.disableCloseAnimation:e.disableCloseAnimation)??!1}),[u]);function F({store:u,onOverlayClosed:e,onOverlayShowed:n,disableModalOverlay:o,disableOpenAnimation:l,disableCloseAnimation:a,...t}){const r=p.useSyncExternalStore(u.subscribe,u.getState,u.getState),m=H(r),f=o||m.disableModalOverlay,M=l||m.disableOpenAnimation,d=a||m.disableCloseAnimation,s=p.useCallback(()=>{u.setOverlayShowed(!1),e?.()},[u,e]),i=p.useCallback(()=>{u.setOverlayShowed(!0),n?.()},[u,n]);return r.modals.length>0||!f&&r.overlayShowed?y.jsx(D,{...t,activeModal:r.activeModal,disableModalOverlay:f,disableOpenAnimation:M,disableCloseAnimation:d,onOverlayClosed:s,onOverlayShowed:i,children:r.modals.map(c=>{switch(c.type){case"custom-page":case"custom-card":const E=c.component;return y.jsx(E,{id:c.id,modalProps:c.modalProps,...c.additionalProps,update:c.update,close:c.close},c.id);case"card":return y.jsx(V,{...c},c.id);case"page":return y.jsx(q,{...c},c.id)}})}):null}try{F.displayName="ContextHolder",F.__docgenInfo={description:"",displayName:"ContextHolder",props:{onClose:{defaultValue:null,description:"Будет вызвано при начале закрытия активной модалки с её id.",name:"onClose",required:!1,type:{name:"ModalRootCallbackFunction"}},onOpen:{defaultValue:null,description:"Будет вызвано при начале открытия активной модалки с её id.",name:"onOpen",required:!1,type:{name:"ModalRootCallbackFunction"}},usePortal:{defaultValue:null,description:"",name:"usePortal",required:!1,type:{name:"boolean | HTMLElement | RefObject<HTMLElement | null> | null"}},onClosed:{defaultValue:null,description:"Будет вызвано при окончательном закрытии активной модалки с её id.",name:"onClosed",required:!1,type:{name:"ModalRootCallbackFunction"}},noFocusToDialog:{defaultValue:null,description:"Отключает фокус на контейнер диалогового окна при открытии.\n\n> Важно установить фокус после открытия в любое место модалки используя событие `onOpened`, иначе не будет работать закрытие по нажатию `Esc`.",name:"noFocusToDialog",required:!1,type:{name:"boolean"}},modalOverlayTestId:{defaultValue:null,description:"`data-testid` для маски.",name:"modalOverlayTestId",required:!1,type:{name:"string"}},onOpened:{defaultValue:null,description:"Будет вызвано при окончательном открытии активной модалки с её id.",name:"onOpened",required:!1,type:{name:"ModalRootCallbackFunction"}},disableModalOverlay:{defaultValue:null,description:"Отключает отображение и взаимодействие с фоном модалки.",name:"disableModalOverlay",required:!1,type:{name:"boolean"}},disableOpenAnimation:{defaultValue:null,description:"Отключает анимацию появления .",name:"disableOpenAnimation",required:!1,type:{name:"boolean"}},disableCloseAnimation:{defaultValue:null,description:"Отключает анимацию закрытия модалки.",name:"disableCloseAnimation",required:!1,type:{name:"boolean"}},onOverlayClosed:{defaultValue:null,description:"",name:"onOverlayClosed",required:!1,type:{name:"(() => void)"}},onOverlayShowed:{defaultValue:null,description:"",name:"onOverlayShowed",required:!1,type:{name:"(() => void)"}},store:{defaultValue:null,description:"",name:"store",required:!0,type:{name:"ModalStore"}}}}}catch{}const N=()=>{let u={activeModal:null,modals:[],overlayShowed:!1};const e=new Set,n=new Set,o=()=>{e.forEach(a=>a())},l=a=>{const t=a(u);t!==u&&(u=t,o())};return{getState:()=>u,subscribe:a=>(e.add(a),()=>e.delete(a)),needCloseModals:n,addModal:a=>{l(t=>j(t,a))},removeModal:a=>{l(t=>P(t,a))},updateModalProps:(a,t)=>{l(r=>k(r,a,t))},closeModal:a=>{l(t=>T(t,a,n))},closeAll:()=>{l(a=>I(a,n))},setPrevActive:a=>{l(t=>b(t,a,n))},closePrevActiveIfNoHistory:()=>{l(a=>a.activeModal?b(a,a.activeModal,n):a)},setOverlayShowed:a=>{l(t=>_(t,a))}}},L=(u,e,n,o)=>({onClose:(t,r)=>{n.setPrevActive(u),e.onClose?.(t,r)},onClosed:()=>{n.needCloseModals.has(u)&&(n.removeModal(u),n.needCloseModals.delete(u),o()),e.onClosed?.()}}),z=(u,e,n)=>{const{onClose:o,onClosed:l}=n;switch(u.type){case"custom-card":return{...u,id:e,modalProps:{...u.modalProps,id:e,onClose:o,onClosed:l}};case"custom-page":return{...u,id:e,modalProps:{...u.modalProps,id:e,onClose:o,onClosed:l}};case"page":case"card":return{...u,id:e,onClose:o,onClosed:l}}},O=u=>"component"in u?u:{component:u},G=({store:u,saveHistory:e})=>{const n=p.useRef(e);p.useEffect(()=>{n.current=e},[e]);const o=p.useCallback(d=>{const s=(d.type==="custom-card"||d.type==="custom-page"?d.modalProps:d)||{},i=s.id||x();let C;const c=new Promise(B=>{C=B}),E=L(i,s,u,C),A=z(d,i,E);return n.current||u.closePrevActiveIfNoHistory(),u.addModal(A),{id:i,close:()=>u.closeModal(i),onClose:B=>c.then(B)}},[u]),l=p.useCallback((...d)=>{const[s,i,C]=d;u.updateModalProps(s,C)},[u]),a=p.useCallback(d=>{const s=o({...d,type:"card"});return{...s,update:i=>l(s.id,"card",i)}},[o,l]),t=p.useCallback(d=>{const s=o({...d,type:"page"});return{...s,update:i=>l(s.id,"page",i)}},[o,l]),r=p.useCallback(d=>{const{id:s,component:i,baseProps:C,additionalProps:c}=O(d);let E;return E=o({type:"custom-card",id:s,component:i,additionalProps:c,modalProps:C,close:()=>E.close(),update:A=>l(E.id,"card",A)}),{...E,update:A=>l(E.id,"card",A)}},[o,l]),m=p.useCallback(d=>{const{id:s,component:i,baseProps:C,additionalProps:c}=O(d);let E;return E=o({type:"custom-page",id:s,component:i,additionalProps:c,modalProps:C,close:()=>E.close(),update:A=>l(E.id,"page",A)}),{...E,update:A=>l(E.id,"page",A)}},[o,l]),f=p.useCallback(d=>{u.closeModal(d)},[u]),M=p.useCallback(()=>{u.closeAll()},[u]);return{openModalPage:t,openModalCard:a,openCustomModalCard:r,openCustomModalPage:m,close:f,update:l,closeAll:M}},g=({saveHistory:u=!0,...e}={})=>{const[n]=p.useState(N),[o,l]=p.useState(u);p.useEffect(()=>{l(u)},[u]);const{openModalPage:a,openModalCard:t,openCustomModalCard:r,openCustomModalPage:m,close:f,update:M,closeAll:d}=G({store:n,saveHistory:o}),s=p.useMemo(()=>({openModalPage:a,openModalCard:t,openCustomModalCard:r,openCustomModalPage:m,close:f,update:M,closeAll:d,setSaveHistory:l}),[f,d,r,m,t,a,M]),i=p.useMemo(()=>y.jsx(F,{...e,store:n}),[e,n]);return[s,i]};try{g.displayName="useModalManager",g.__docgenInfo={description:"",displayName:"useModalManager",props:{onClose:{defaultValue:null,description:"Будет вызвано при начале закрытия активной модалки с её id.",name:"onClose",required:!1,type:{name:"ModalRootCallbackFunction"}},onOpen:{defaultValue:null,description:"Будет вызвано при начале открытия активной модалки с её id.",name:"onOpen",required:!1,type:{name:"ModalRootCallbackFunction"}},usePortal:{defaultValue:null,description:"",name:"usePortal",required:!1,type:{name:"boolean | HTMLElement | RefObject<HTMLElement | null> | null"}},onClosed:{defaultValue:null,description:"Будет вызвано при окончательном закрытии активной модалки с её id.",name:"onClosed",required:!1,type:{name:"ModalRootCallbackFunction"}},noFocusToDialog:{defaultValue:null,description:"Отключает фокус на контейнер диалогового окна при открытии.\n\n> Важно установить фокус после открытия в любое место модалки используя событие `onOpened`, иначе не будет работать закрытие по нажатию `Esc`.",name:"noFocusToDialog",required:!1,type:{name:"boolean"}},modalOverlayTestId:{defaultValue:null,description:"`data-testid` для маски.",name:"modalOverlayTestId",required:!1,type:{name:"string"}},onOpened:{defaultValue:null,description:"Будет вызвано при окончательном открытии активной модалки с её id.",name:"onOpened",required:!1,type:{name:"ModalRootCallbackFunction"}},disableModalOverlay:{defaultValue:null,description:"Отключает отображение и взаимодействие с фоном модалки.",name:"disableModalOverlay",required:!1,type:{name:"boolean"}},disableOpenAnimation:{defaultValue:null,description:"Отключает анимацию появления .",name:"disableOpenAnimation",required:!1,type:{name:"boolean"}},disableCloseAnimation:{defaultValue:null,description:"Отключает анимацию закрытия модалки.",name:"disableCloseAnimation",required:!1,type:{name:"boolean"}},onOverlayClosed:{defaultValue:null,description:"",name:"onOverlayClosed",required:!1,type:{name:"(() => void)"}},onOverlayShowed:{defaultValue:null,description:"",name:"onOverlayShowed",required:!1,type:{name:"(() => void)"}},saveHistory:{defaultValue:{value:"true"},description:"",name:"saveHistory",required:!1,type:{name:"boolean"}}}}}catch{}export{D as M,g as u};
