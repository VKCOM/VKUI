var $=Object.defineProperty;var K=(s,e,t)=>e in s?$(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var r=(s,e,t)=>K(s,typeof e!="symbol"?e+"":e,t);import{k as j,j as B,i as q,r as l,n as m,bp as W,ad as Y,bo as X,o as L,m as R,bq as J,ap as Q,p as Z,br as ee,bs as F}from"./iframe-BdL7Qu3-.js";import{U as te,r as ne}from"./rubberbandIfOutOfBounds-C1Zyuspy.js";import{w as ie}from"./warnOnce-BsOPdcXO.js";import{u as se}from"./useCSSTransition-BxNiqfS0.js";import{d as oe}from"./debounce-2Cr6Hz2O.js";import{t as ae}from"./throttle-CuRfLcRJ.js";const re="_host_1anoe_1",ue="_nonInteractive_1anoe_10",le="_hostPositionAbsolute_1anoe_15",ce="_hostPositionFixed_1anoe_19",de="_hostStateEnter_1anoe_24",pe="_hostStateEntering_1anoe_29",he="_hostStateEntered_1anoe_33",fe="_hostStateExit_1anoe_37",Ee="_hostStateExiting_1anoe_42",Se="_hostStateExited_1anoe_46",h={host:re,nonInteractive:ue,hostPositionAbsolute:le,hostPositionFixed:ce,hostStateEnter:de,hostStateEntering:pe,hostStateEntered:he,hostStateExit:fe,hostStateExiting:Ee,hostStateExited:Se},me={absolute:h.hostPositionAbsolute,fixed:h.hostPositionFixed},ve={appear:h.hostStateEnter,appearing:h.hostStateEntering,appeared:h.hostStateEntered,enter:h.hostStateEnter,entering:h.hostStateEntering,entered:h.hostStateEntered,exit:h.hostStateExit,exiting:h.hostStateExiting,exited:h.hostStateExited},x=({visible:s=!1,position:e="absolute",getRootRef:t,onClick:i,...o})=>{const[a,{ref:c,onTransitionEnd:d}]=se(s,{enableAppear:!0}),S=j(t,c);return B.jsx("div",{...o,ref:S,"aria-hidden":"true",hidden:a==="exited",className:q(h.host,i===void 0&&h.nonInteractive,me[e],ve[a]),onClick:i,onTransitionEnd:d})};try{x.displayName="ModalOverlay",x.__docgenInfo={description:"",displayName:"ModalOverlay",props:{visible:{defaultValue:{value:"false"},description:"",name:"visible",required:!1,type:{name:"boolean"}},position:{defaultValue:{value:"absolute"},description:"",name:"position",required:!1,type:{name:"enum",value:[{value:'"fixed"'},{value:'"absolute"'}]}},onClick:{defaultValue:null,description:"",name:"onClick",required:!1,type:{name:"((event: MouseEvent<HTMLDivElement, MouseEvent>) => void)"}},getRootRef:{defaultValue:null,description:"",name:"getRootRef",required:!1,type:{name:"Ref<HTMLDivElement>"}}}}}catch{}const V=l.createContext({current:null}),A=l.createContext({updateModalHeight:m,registerModal:m,isInsideModal:!1});try{V.displayName="ModalRootOverlayContext",V.__docgenInfo={description:"Сохраняем `ref` компонента `ModalOverlay` из `ModalRoot` в контекст, чтобы можно было пробросить\nего до `ModalPage` и `ModalCard`.",displayName:"ModalRootOverlayContext",props:{}}}catch{}try{A.displayName="ModalRootContext",A.__docgenInfo={description:"",displayName:"ModalRootContext",props:{}}}catch{}const U="data-vkui-block-sheet-behavior",xe={[U]:!0},H={DISTANCE_FOR_MOVING_START:12,VELOCITY:500},Ve={LOWER:25,HIGHEST:90},_={MIN:0,LARGE:100},P={IDLE_POINT_VALUE:0,COMPUTED_INDEX:1};class T{constructor(e,{sheetScrollEl:t,sheetTransitionController:i,backdropTransitionController:o,onSnapPointChange:a,onDismiss:c}){r(this,"sheetEl");r(this,"isInitialized",!1);r(this,"panState","idle");r(this,"pannedEl",null);r(this,"sheetHeight",0);r(this,"rafId",null);r(this,"currentSnapPoint",0);r(this,"nextSnapPoint",0);r(this,"snapPointDetents",[0,0]);r(this,"unit","%");r(this,"disableVerticalScrollBouncingDispose",m);r(this,"sheetScrollEl");r(this,"sheetTransitionController");r(this,"backdropTransitionController");r(this,"panGestureRecognizer");r(this,"onSnapPointChange");r(this,"onDismiss");this.sheetEl=e,this.onSnapPointChange=a,this.onDismiss=c,this.panGestureRecognizer=new te,this.sheetScrollEl=t,this.sheetTransitionController=i,this.backdropTransitionController=o}init(e){this.isInitialized=!0,e==="auto"?(this.unit="px",this.currentSnapPoint=P.IDLE_POINT_VALUE,this.snapPointDetents=[_.MIN,P.IDLE_POINT_VALUE]):(this.unit="%",this.currentSnapPoint=e.initial,this.snapPointDetents=e.detents)}destroy(){var e;this.isInitialized=!1,this.pannedEl=null,this.sheetTransitionController.cleanup(),(e=this.backdropTransitionController)==null||e.cleanup(),this.disableVerticalScrollBouncingDispose(),this.disableVerticalScrollBouncingDispose=m}panStart(e){!this.isInitialized||this.panState!=="idle"||W(e.target)||(this.panState="start",this.pannedEl=e.target,this.panGestureRecognizer.setStartCoords(e))}panMove(e){switch(this.panState){case"start":if(this.panGestureRecognizer.setInitialTimeOnce(),this.panGestureRecognizer.setEndCoords(e),this.preventUntilPanGestureBecomesExpected())return;if(this.preventImmediatelyIfPannedElIsNotValid()){this.panState="idle";return}if(this.preventUntilVerticalScrollingOnSheetScrollElBecomesExpected())return;if(this.preventImmediatelyIfVerticalScrollingOnPannedElIsScrolled()){this.panState="idle";return}this.panState="moving",this.panGestureRecognizer.setStartCoords(e),this.sheetHeight=this.sheetEl.offsetHeight,this.disableVerticalScrollBouncingDispose=T.disableVerticalScrollBouncingIfNeeded(this.sheetScrollEl,this.pannedEl),this.isDynamicSnapPoint&&(this.currentSnapPoint=this.sheetHeight,this.snapPointDetents[P.COMPUTED_INDEX]=this.sheetHeight);break;case"moving":this.panGestureRecognizer.setEndCoords(e);const{y1:t,y2:i}=this.panGestureRecognizer;this.nextSnapPoint=ne(this.currentSnapPoint-(i-t)/this.sheetHeight*this.currentSnapPoint,_.MIN,this.isDynamicSnapPoint?this.sheetHeight:_.LARGE),this.calculateSnapPoint(this.nextSnapPoint,!0);break}}panEnd(){switch(this.panState){case"moving":const e=this.currentSnapPoint;this.currentSnapPoint=this.getSnapPointTo(this.nextSnapPoint),e!==this.currentSnapPoint&&this.currentSnapPoint>_.MIN&&this.onSnapPointChange(this.currentSnapPoint),this.calculateSnapPoint(this.currentSnapPoint);break}this.panState="idle",this.panGestureRecognizer.reset(),this.disableVerticalScrollBouncingDispose(),this.disableVerticalScrollBouncingDispose=m}get isDynamicSnapPoint(){return this.unit==="px"}calculateSnapPoint(e,t=!1){var o;if(this.rafId!==null&&cancelAnimationFrame(this.rafId),e<=_.MIN){this.sheetTransitionController.enableTransition(),(o=this.backdropTransitionController)==null||o.enableTransition(),this.panState="idle",this.onDismiss();return}const i=Y(this.isDynamicSnapPoint?e/this.sheetHeight:e*2/_.LARGE,0,1);this.rafId=requestAnimationFrame(()=>{var a,c;if(t){(a=this.backdropTransitionController)==null||a.disableTransition().set(i),this.sheetTransitionController.disableTransition().set(`${e}${this.unit}`);return}this.isDynamicSnapPoint&&this.sheetTransitionController.cleanupOnTransitionEnd(),(c=this.backdropTransitionController)==null||c.unset(),this.sheetTransitionController.enableTransition().set(`${this.currentSnapPoint}${this.unit}`)})}getSnapPointTo(e){const t=T.getClosestSnapPoint(this.snapPointDetents,e);if(t!==this.currentSnapPoint)return t;const i=this.panGestureRecognizer.direction();if(i.axis!=="y"||i.direction===null)return this.currentSnapPoint;const o=this.panGestureRecognizer.velocity();return Math.abs(o.y)<H.VELOCITY?this.currentSnapPoint:T.getClosestSnapPointByDirection(this.snapPointDetents,t,i.direction)}preventUntilPanGestureBecomesExpected(){return this.panGestureRecognizer.direction().axis==="x"||this.panGestureRecognizer.distance()<H.DISTANCE_FOR_MOVING_START}preventImmediatelyIfPannedElIsNotValid(){return this.pannedEl===null||this.pannedEl.closest(`[${U}=true]`)!==null||!this.sheetEl.contains(this.pannedEl)}preventUntilVerticalScrollingOnSheetScrollElBecomesExpected(){return this.sheetScrollEl===null||!this.sheetScrollEl.contains(this.pannedEl)||this.sheetScrollEl.scrollHeight<=this.sheetScrollEl.clientHeight?!1:this.sheetScrollEl.scrollTop===0?this.panGestureRecognizer.direction().direction===-1&&T.isLastSnapPointDetents(this.snapPointDetents,this.currentSnapPoint):!0}preventImmediatelyIfVerticalScrollingOnPannedElIsScrolled(){if(this.pannedEl===null||this.pannedEl===this.sheetEl||this.pannedEl===this.sheetScrollEl)return!1;const e=X(this.pannedEl,this.sheetEl);return e===null||this.sheetScrollEl===e||e.scrollHeight<=e.clientHeight?!1:e.scrollTop!==0||this.panGestureRecognizer.direction().direction===-1}static disableVerticalScrollBouncingIfNeeded(e,t){return e!==null&&e.scrollTop<=0&&e.contains(t)&&e.scrollHeight>e.clientHeight?(e.style.setProperty("overflow-y","hidden"),function(){e.style.removeProperty("overflow-y")}):m}static isLastSnapPointDetents(e,t){return t===e[e.length-1]}static getClosestSnapPointByDirection(e,t,i){const o=e.findIndex(a=>a===t);switch(i){case-1:return e[o+1]??e[e.length-1];case 1:return e[o-1]??e[0]}}static getClosestSnapPoint(e,t){let i=e[0],o=Math.abs(e[0]-t);for(let a=1;a<e.length;a+=1){const c=Math.abs(e[a]-t);c<o&&(i=e[a],o=c)}return i}}class k{constructor(e,t){r(this,"el");r(this,"property");r(this,"handleTransitionEnd",()=>(this.cleanup(),this));this.el=e,this.property=t}set(e){return this.el.style.setProperty(this.property,`${e}`),this}unset(){return this.cleanup()}enableTransition(){return this.el.style.removeProperty("transition"),this}disableTransition(){return this.el.style.setProperty("transition","none"),this}cleanup(){return this.el.removeEventListener("transitionend",this.handleTransitionEnd),this.el.style.removeProperty("transition"),this.el.style.removeProperty(this.property),this}cleanupOnTransitionEnd(){return this.el.addEventListener("transitionend",this.handleTransitionEnd,{once:!0}),this}}const Ae=(s,{blocked:e,snapPoint:t,sheetCSSProperty:i,backdropCSSProperty:o,onSnapPointChange:a,onDismiss:c})=>{const[d,S]=l.useState(null),[n,p]=l.useState(null),[u,E]=l.useState(null),v=l.useMemo(()=>s&&t!=="auto"?{[i]:`${t.initial}%`}:void 0,[s,t,i]),y=L(a||m),C=L(c||m),f=l.useMemo(()=>!s||n===null?null:new T(n,{sheetScrollEl:d||null,sheetTransitionController:new k(n,i),backdropTransitionController:u?new k(u,o):null,onSnapPointChange:y,onDismiss:C}),[s,n,i,d,u,o,y,C]),g=function(b){e||f.panStart(b.nativeEvent)},I=function(b){f.panMove(b.nativeEvent)},M=function(){f.panEnd()};return R(function(){f&&f.init(t)},[t,f]),R(()=>function(){f&&f.destroy()},[f]),[{initialStyle:v,setSheetEl:p,setSheetScrollEl:S,setBackdropEl:E},f!==null?{onTouchStart:g,onTouchMove:I,onTouchEnd:M,onTouchCancel:M,onMouseDown:g,onMouseMove:I,onMouseUp:M,onMouseLeave:M}:void 0]},ge="_host_ntc00_1",ye={host:ge},N=({visible:s,position:e,getRootRef:t,...i})=>{const o=l.useContext(V);return B.jsx("div",{...i,"aria-hidden":"true",className:ye.host,ref:function(){J(o.current,t)}})};try{N.displayName="VisuallyHiddenModalOverlay",N.__docgenInfo={description:"`ModalRoot` выставляет общий `ModalOverlay` для всех потомков, и чтобы не нарушить логику\nв `ModalPage` и `ModalCard`, в них прокидывается данный компонент, который визуально не виден,\nно при этом на нём сохраняется возможность взаимодействия.\n\nВ `getRooRef` отдаёт ссылку на DOM общего `ModalOverlay`.",displayName:"VisuallyHiddenModalOverlay",props:{visible:{defaultValue:null,description:"",name:"visible",required:!1,type:{name:"boolean"}},position:{defaultValue:null,description:"",name:"position",required:!1,type:{name:"enum",value:[{value:'"fixed"'},{value:'"absolute"'}]}},onClick:{defaultValue:null,description:"",name:"onClick",required:!1,type:{name:"((event: MouseEvent<HTMLDivElement, MouseEvent>) => void)"}},getRootRef:{defaultValue:null,description:"",name:"getRootRef",required:!1,type:{name:"Ref<HTMLDivElement>"}}}}}catch{}const _e=ie("useModalManager"),w=({id:s,open:e,keepMounted:t,modalOverlayTestId:i,noFocusToDialog:o,onOpen:a,onOpened:c,onClose:d,onClosed:S})=>{const n=l.useContext(A),p=l.useId(),u=Q({nav:s},n.isInsideModal?_e:void 0)||p,E=n.isInsideModal?n.activeModal===u:e,v=n.isInsideModal?n.activeModal!==null:!1,[y,C]=l.useState(t?!1:!E);return R(function(){!t&&E&&C(g=>g&&!1)},[E,t]),y?{mounted:!1,shouldPreserveSnapPoint:v,id:u}:{id:u,mounted:!0,open:E,shouldPreserveSnapPoint:v,noFocusToDialog:o||n.noFocusToDialog,modalOverlayTestId:i||n.modalOverlayTestId,ModalOverlay:n.isInsideModal?N:x,onOpen:a||O(u,n.onOpen),onOpened:c||O(u,n.onOpened),onClose:d||O(u,n.onClose),onClosed:function(...g){var I;t||C(!0),S?S(...g):(I=n.onClosed)==null||I.call(n,u)}}};function O(s,e){return e?()=>e(s):void 0}try{w.displayName="useModalManager",w.__docgenInfo={description:"",displayName:"useModalManager",props:{id:{defaultValue:null,description:"",name:"id",required:!1,type:{name:"string"}},open:{defaultValue:null,description:"",name:"open",required:!0,type:{name:"boolean"}},keepMounted:{defaultValue:null,description:"",name:"keepMounted",required:!0,type:{name:"boolean"}},modalOverlayTestId:{defaultValue:null,description:"",name:"modalOverlayTestId",required:!1,type:{name:"string"}},noFocusToDialog:{defaultValue:null,description:"",name:"noFocusToDialog",required:!1,type:{name:"boolean"}},onOpen:{defaultValue:null,description:"",name:"onOpen",required:!1,type:{name:"AnyFunction"}},onOpened:{defaultValue:null,description:"",name:"onOpened",required:!1,type:{name:"AnyFunction"}},onClose:{defaultValue:null,description:"",name:"onClose",required:!1,type:{name:"AnyFunction"}},onClosed:{defaultValue:null,description:"",name:"onClosed",required:!1,type:{name:"AnyFunction"}}}}}catch{}function Ne(s=!0){const{window:e,document:t}=Z(),[i,o]=l.useState(null),[a,c]=l.useState(!1),d=l.useRef(null);return l.useEffect(function(){if(!s||!e||!t)return;const n=u=>{const E=u===!0?t.activeElement:u.target;if(ee(E))switch((u===!0?{type:"focusin"}:u).type){case"focusin":d.current=F(e),o(E);break;case"focusout":d.current=null,c(!1),o(null);break}};n(!0);const p={passive:!0,capture:!1};return t.addEventListener("focusin",n,p),t.addEventListener("focusout",n,p),()=>{d.current=null,t.removeEventListener("focusin",n,p),t.removeEventListener("focusout",n,p)}},[s,e,t]),l.useEffect(function(){if(!i||!e)return;const n=oe(()=>{if(d.current===null)return;const p=F(e),{offsetTop:u,height:E}=d.current,{offsetTop:v,height:y}=p;(u!==v||E!==y)&&(c(!0),d.current=p)},100);return e.visualViewport?e.visualViewport.addEventListener("resize",n):e.addEventListener("resize",n),function(){e.visualViewport?e.visualViewport.removeEventListener("resize",n):e.removeEventListener("resize",n)}},[i,e]),l.useEffect(function(){if(!a||!e)return;const n=ae(()=>{d.current&&e.scrollTo(0,d.current.offsetTop)},100);return e.addEventListener("scroll",n,{passive:!0}),function(){e.removeEventListener("scroll",n)}},[a,e]),{opened:a}}const Te="_host_bcc38_1",Ce="_hostDesktop_bcc38_10",G={host:Te,hostDesktop:Ce},z=({className:s,hidden:e,isDesktop:t,children:i,getRootRef:o,...a})=>B.jsx("div",{ref:o,className:q(s,G.host,t&&G.hostDesktop),hidden:e,"aria-hidden":e,...a,children:i});try{z.displayName="ModalOutlet",z.__docgenInfo={description:"",displayName:"ModalOutlet",props:{hidden:{defaultValue:null,description:"",name:"hidden",required:!1,type:{name:"boolean"}},isDesktop:{defaultValue:null,description:"",name:"isDesktop",required:!1,type:{name:"boolean"}},getRootRef:{defaultValue:null,description:"",name:"getRootRef",required:!1,type:{name:"Ref<HTMLDivElement>"}}}}}catch{}export{xe as B,A as M,_ as S,V as a,x as b,Ae as c,z as d,w as e,Ve as f,Ne as u};
