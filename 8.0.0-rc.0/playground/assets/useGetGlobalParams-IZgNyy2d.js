import{r as t,a$ as M,o as R,j as n,g as q,m as I,b0 as B}from"./iframe-CWLi0Dwx.js";import{t as w}from"./throttle-CuRfLcRJ.js";import{u as F}from"./useResizeObserver-dudkZJs-.js";import{S as H}from"./Spinner-ClXGWKNH.js";import{B as k}from"./Button-V1CoOSHU.js";import{m as Q}from"./index-Dy_HpQxN.js";import{F as v}from"./Flex-BeuW-JMg.js";import{T as L}from"./Title-B966ALEh.js";import{G as A}from"./Group-vgwGhKNH.js";import{S as z}from"./Search-CfYMAG0E.js";import{F as U}from"./Footer-_Xpr6YxQ.js";import{C as Y}from"./Counter-BkXMSURw.js";import{i as J}from"./blocks-C3FWZJ_D.js";function P(e){if(!/[а-яё]/i.test(e))return e;const o={а:"f",б:",",в:"d",г:"u",д:"l",е:"t",ё:"`",ж:";",з:"p",и:"b",й:"q",к:"r",л:"k",м:"v",н:"y",о:"j",п:"g",р:"h",с:"c",т:"n",у:"e",ф:"a",х:"[",ц:"w",ч:"x",ш:"i",щ:"o",ъ:"]",ы:"s",ь:"m",э:"'",ю:".",я:"z"};return e.split("").map(s=>o[s]||s).join("")}const W=(e,o)=>{const[s,i]=t.useState(""),[a,r]=t.useState(!1),{scrollTo:c}=M(),h=t.useMemo(()=>w(m=>{i(P(m.toLocaleLowerCase())),r(!1)},1e3),[]),C=t.useMemo(()=>(c(0,0),o(e,s)),[e,o,s,c]),S=t.useCallback(m=>{r(!0),h(m.target.value)},[h]);return{loading:a,onUpdateQuery:S,config:C,query:s}},X=24,$=64,K=(e,o,s)=>{const{window:i,document:a}=R(),[r,c]=t.useState({mountedSections:[],sectionsVisibilityData:{}}),h=t.useRef({}),C=()=>{const u={};Object.entries(o).forEach(([d,l])=>{if(l&&l.current){const p=e.find(f=>f.id===d);p&&(u[d]={data:p,bounds:{height:l.current.offsetHeight,offsetTop:l.current.offsetTop}})}}),h.current=u},S=()=>{if(!i||!a)return;const u=i.pageYOffset;c(d=>{const{mountedSections:l,sectionsVisibilityData:p}=d;if(l.length<e.length){const f=a.documentElement.scrollHeight-i.innerHeight-X-$;if(u>=f){const g=e[l.length];return{mountedSections:[...l,g.id],sectionsVisibilityData:{...p,[g.id]:g}}}}return d})},m=()=>{const u=h.current;if(!i||!a)return;const d=i.pageYOffset;c(l=>{const{mountedSections:p}=l,f={};return p.forEach(y=>{const g=u[y];if(!g)return;const{bounds:x,data:b}=g;if(x.offsetTop+x.height<=d||x.offsetTop>=d+i.innerHeight){f[y]={...b,minHeight:x.height,hidden:!0};return}f[y]=b}),{mountedSections:p,sectionsVisibilityData:f}}),S()};return t.useEffect(()=>c({mountedSections:[],sectionsVisibilityData:{}}),[e]),t.useEffect(C,[o]),F(s,()=>requestAnimationFrame(S)),t.useEffect(()=>(i.addEventListener("scroll",m),()=>i.removeEventListener("scroll",m)),[m]),{remappedSections:t.useMemo(()=>r.mountedSections.map(u=>r.sectionsVisibilityData[u]).filter(Boolean),[r.mountedSections,r.sectionsVisibilityData]),showMoreElement:r.mountedSections.length<e.length&&n.jsx(H,{})}},Z="_header_gnj2b_6",ee="_upButton_gnj2b_23",te="_hidden_gnj2b_33",V={header:Z,upButton:ee,hidden:te},ne=()=>{const[e,o]=t.useState(!1),{scrollTo:s,getScroll:i}=M(),{window:a}=R(),r=t.useMemo(()=>w(()=>o(i().y>=(a?.innerHeight||0)),1e3),[i,a]);return t.useEffect(()=>(a.addEventListener("scroll",r),()=>a.removeEventListener("scroll",r)),[r]),n.jsx("div",{className:q(V.upButton,!e&&V.hidden),children:n.jsx(k,{borderRadiusMode:"inherit",size:"l",after:n.jsx(Q,{}),onMouseDown:()=>s(0,0)})})},G=t.createContext({searchedQuery:""}),ge=()=>t.useContext(G),Se=({title:e,config:o,filterConfig:s,remapConfigToSections:i,ItemsContainer:a,renderSectionItem:r,additionalHeaderItem:c})=>{const h=t.useRef(null),[C,S]=t.useState({}),m=I(i),D=I(r),{config:u,loading:d,onUpdateQuery:l,query:p}=W(o,s),f=t.useMemo(()=>m(u),[u,m]),{remappedSections:y,showMoreElement:g}=K(f,C,h),x=t.useCallback((b,_)=>{const j=t.createRef();j.current=b,S(T=>{const O={...T,[_]:j};return B(O,N=>!!N.current)})},[]);return n.jsxs(G.Provider,{value:{searchedQuery:p},children:[n.jsxs(v,{direction:"column",gap:"2xl",align:"start",className:V.header,children:[n.jsx(L,{children:e}),n.jsx(A,{separator:"hide",children:n.jsx(z,{noPadding:!0,onChange:l})}),c]}),n.jsxs(v,{direction:"column",gap:"3xl",children:[d&&n.jsx(H,{}),!d&&f.length===0&&n.jsx(U,{children:"Ничего не найдено"}),n.jsxs(v,{direction:"column",gap:"3xl",getRootRef:h,children:[y.map(({minHeight:b,hidden:_,...j})=>n.jsx(E,{hidden:_,sectionData:j,onSectionRef:x,style:{minHeight:b},ItemsRenderer:({section:T})=>n.jsx(a,{children:T.items.map(O=>D(O,T))})},j.id)),g]})]}),n.jsx(ne,{})]})},E=t.memo(({style:e,hidden:o,sectionData:s,onSectionRef:i,ItemsRenderer:a})=>{const r=t.useCallback(c=>{i(c,s.id)},[s.id,i]);return n.jsx(v,{direction:"column",gap:"xl",getRootRef:r,style:e,children:o?null:n.jsxs(n.Fragment,{children:[n.jsxs(v,{align:"center",gap:"m",children:[n.jsx(L,{level:"2",children:s.displayTitle}),n.jsx(Y,{size:"m",mode:"primary",appearance:"accent-red",children:s.items.length})]}),n.jsx(a,{section:s})]})})},(e,o)=>e.sectionData.id===o.sectionData.id&&e.sectionData.items.length===o.sectionData.items.length&&e.onSectionRef===o.onSectionRef&&e.hidden===o.hidden&&e.style?.minHeight===o.style?.minHeight);E.displayName="Section";Object.defineProperty(E,"name",{value:"Section"});try{E.displayName="Section",E.__docgenInfo={description:"",displayName:"Section",props:{title:{defaultValue:null,description:"",name:"title",required:!0,type:{name:"string"}},config:{defaultValue:null,description:"",name:"config",required:!0,type:{name:"CONFIG"}},filterConfig:{defaultValue:null,description:"",name:"filterConfig",required:!0,type:{name:"(config: CONFIG, query: string) => CONFIG"}},remapConfigToSections:{defaultValue:null,description:"",name:"remapConfigToSections",required:!0,type:{name:"(config: CONFIG) => Section<ITEM>[]"}},ItemsContainer:{defaultValue:null,description:"",name:"ItemsContainer",required:!0,type:{name:"ComponentType<HasChildren>"}},renderSectionItem:{defaultValue:null,description:"",name:"renderSectionItem",required:!0,type:{name:"(item: ITEM, section: Section<ITEM>) => ReactElement<unknown, string | JSXElementConstructor<any>>"}},additionalHeaderItem:{defaultValue:null,description:"",name:"additionalHeaderItem",required:!1,type:{name:"ReactElement<unknown, string | JSXElementConstructor<any>>"}}}}}catch{}const ye=()=>{const o=t.useContext(J)?.store?.userGlobals?.globals;if(o){const{colorScheme:s="light",platform:i="vkcom",direction:a="ltr",hasCustomPanelHeaderAfter:r=!1,hasPointer:c=!1}=o;return{colorScheme:s,platform:i,direction:a,hasCustomPanelHeaderAfter:r,hasPointer:c}}return{colorScheme:"light",platform:"vkcom",direction:"ltr",hasCustomPanelHeaderAfter:!1,hasPointer:!1}};export{Se as O,ge as a,ye as u};
