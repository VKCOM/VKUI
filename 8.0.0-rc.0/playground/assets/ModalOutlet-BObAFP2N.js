import{h as U,j as B,g as G,r as u,n as b,bX as $,as as K,bV as j,m as L,q as V,au as Y,aJ as W,o as X,bY as J,bZ as F}from"./iframe-D-vjmezP.js";import{U as Z,r as Q}from"./rubberbandIfOutOfBounds-CVqKReCD.js";import{w as ee}from"./warnOnce-BsOPdcXO.js";import{u as te}from"./useCSSTransition-DvB-HHcQ.js";import{d as ne}from"./debounce-2Cr6Hz2O.js";import{t as ie}from"./throttle-CuRfLcRJ.js";const oe="_host_10iyl_1",se="_nonInteractive_10iyl_10",ae="_hostPositionAbsolute_10iyl_15",le="_hostPositionFixed_10iyl_19",re="_hostStateEnter_10iyl_24",ue="_hostStateEntering_10iyl_29",de="_hostStateEntered_10iyl_33",ce="_hostStateExit_10iyl_37",pe="_hostStateExiting_10iyl_42",he="_hostStateExited_10iyl_46",f={host:oe,nonInteractive:se,hostPositionAbsolute:ae,hostPositionFixed:le,hostStateEnter:re,hostStateEntering:ue,hostStateEntered:de,hostStateExit:ce,hostStateExiting:pe,hostStateExited:he},fe={absolute:f.hostPositionAbsolute,fixed:f.hostPositionFixed},Ee={appear:f.hostStateEnter,appearing:f.hostStateEntering,appeared:f.hostStateEntered,enter:f.hostStateEnter,entering:f.hostStateEntering,entered:f.hostStateEntered,exit:f.hostStateExit,exiting:f.hostStateExiting,exited:f.hostStateExited},R=({visible:o=!1,position:e="absolute",getRootRef:t,onClick:n,onClosed:a,onShowed:l,disableOpenAnimation:r,disableCloseAnimation:d,...y})=>{const[s,{ref:c,onTransitionEnd:p}]=te(o,{enableAppear:!r,enableEnter:!r,enableExit:!d,onExited:a,onEntered:l}),i=U(t,c);return B.jsx("div",{...y,ref:i,"aria-hidden":"true",hidden:s==="exited",className:G(f.host,n===void 0&&f.nonInteractive,fe[e],Ee[s]),onClick:n,onTransitionEnd:p})};try{R.displayName="ModalOverlay",R.__docgenInfo={description:"",displayName:"ModalOverlay",props:{visible:{defaultValue:{value:"false"},description:"",name:"visible",required:!1,type:{name:"boolean"}},position:{defaultValue:{value:"absolute"},description:"",name:"position",required:!1,type:{name:"enum",value:[{value:'"absolute"'},{value:'"fixed"'}]}},onClick:{defaultValue:null,description:"",name:"onClick",required:!1,type:{name:"((event: MouseEvent<HTMLDivElement, MouseEvent>) => void)"}},onClosed:{defaultValue:null,description:"",name:"onClosed",required:!1,type:{name:"(() => void)"}},onShowed:{defaultValue:null,description:"",name:"onShowed",required:!1,type:{name:"(() => void)"}},disableOpenAnimation:{defaultValue:null,description:"",name:"disableOpenAnimation",required:!1,type:{name:"boolean"}},disableCloseAnimation:{defaultValue:null,description:"",name:"disableCloseAnimation",required:!1,type:{name:"boolean"}},getRootRef:{defaultValue:null,description:"",name:"getRootRef",required:!1,type:{name:"Ref<HTMLDivElement>"}}}}}catch{}const A=u.createContext({current:null}),x=u.createContext({isInsideModal:!1});try{A.displayName="ModalRootOverlayContext",A.__docgenInfo={description:"Сохраняем `ref` компонента `ModalOverlay` из `ModalRoot` в контекст, чтобы можно было пробросить\nего до `ModalPage` и `ModalCard`.",displayName:"ModalRootOverlayContext",props:{}}}catch{}try{x.displayName="ModalRootContext",x.__docgenInfo={description:"",displayName:"ModalRootContext",props:{}}}catch{}const z="data-vkui-block-sheet-behavior",De={[z]:!0},q={DISTANCE_FOR_MOVING_START:12,VELOCITY:500},Pe={LOWER:25,HIGHEST:90},_={MIN:0,LARGE:100},I={IDLE_POINT_VALUE:0,COMPUTED_INDEX:1};class C{sheetEl;constructor(e,{sheetScrollEl:t,sheetTransitionController:n,backdropTransitionController:a,onSnapPointChange:l,onDismiss:r}){this.sheetEl=e,this.onSnapPointChange=l,this.onDismiss=r,this.panGestureRecognizer=new Z,this.sheetScrollEl=t,this.sheetTransitionController=n,this.backdropTransitionController=a}init(e){this.isInitialized=!0,e==="auto"?(this.unit="px",this.currentSnapPoint=I.IDLE_POINT_VALUE,this.snapPointDetents=[_.MIN,I.IDLE_POINT_VALUE]):(this.unit="%",this.currentSnapPoint=e.initial,this.snapPointDetents=e.detents)}destroy(){this.isInitialized=!1,this.pannedEl=null,this.sheetTransitionController.cleanup(),this.backdropTransitionController?.cleanup(),this.disableVerticalScrollBouncingDispose(),this.disableVerticalScrollBouncingDispose=b}panStart(e){!this.isInitialized||this.panState!=="idle"||$(e.target)||(this.panState="start",this.pannedEl=e.target,this.panGestureRecognizer.setStartCoords(e))}panMove(e){switch(this.panState){case"start":if(this.panGestureRecognizer.setInitialTimeOnce(),this.panGestureRecognizer.setEndCoords(e),this.preventUntilPanGestureBecomesExpected())return;if(this.preventImmediatelyIfPannedElIsNotValid()){this.panState="idle";return}if(this.preventUntilVerticalScrollingOnSheetScrollElBecomesExpected())return;if(this.preventImmediatelyIfVerticalScrollingOnPannedElIsScrolled()){this.panState="idle";return}this.panState="moving",this.panGestureRecognizer.setStartCoords(e),this.sheetHeight=this.sheetEl.offsetHeight,this.disableVerticalScrollBouncingDispose=C.disableVerticalScrollBouncingIfNeeded(this.sheetScrollEl,this.pannedEl),this.isDynamicSnapPoint&&(this.currentSnapPoint=this.sheetHeight,this.snapPointDetents[I.COMPUTED_INDEX]=this.sheetHeight);break;case"moving":this.panGestureRecognizer.setEndCoords(e);const{y1:t,y2:n}=this.panGestureRecognizer;this.nextSnapPoint=Q(this.currentSnapPoint-(n-t)/this.sheetHeight*this.currentSnapPoint,_.MIN,this.isDynamicSnapPoint?this.sheetHeight:_.LARGE),this.calculateSnapPoint(this.nextSnapPoint,!0);break}}panEnd(){switch(this.panState){case"moving":const e=this.currentSnapPoint;this.currentSnapPoint=this.getSnapPointTo(this.nextSnapPoint),e!==this.currentSnapPoint&&this.currentSnapPoint>_.MIN&&this.onSnapPointChange(this.currentSnapPoint),this.calculateSnapPoint(this.currentSnapPoint);break}this.panState="idle",this.panGestureRecognizer.reset(),this.disableVerticalScrollBouncingDispose(),this.disableVerticalScrollBouncingDispose=b}isInitialized=!1;panState="idle";pannedEl=null;sheetHeight=0;rafId=null;currentSnapPoint=0;nextSnapPoint=0;snapPointDetents=[0,0];unit="%";get isDynamicSnapPoint(){return this.unit==="px"}disableVerticalScrollBouncingDispose=b;sheetScrollEl;sheetTransitionController;backdropTransitionController;panGestureRecognizer;onSnapPointChange;onDismiss;calculateSnapPoint(e,t=!1){if(this.rafId!==null&&cancelAnimationFrame(this.rafId),e<=_.MIN){this.sheetTransitionController.enableTransition(),this.backdropTransitionController?.enableTransition(),this.panState="idle",this.onDismiss();return}const n=K(this.isDynamicSnapPoint?e/this.sheetHeight:e*2/_.LARGE,0,1);this.rafId=requestAnimationFrame(()=>{if(t){this.backdropTransitionController?.disableTransition().set(n),this.sheetTransitionController.disableTransition().set(`${e}${this.unit}`);return}this.isDynamicSnapPoint&&this.sheetTransitionController.cleanupOnTransitionEnd(),this.backdropTransitionController?.unset(),this.sheetTransitionController.enableTransition().set(`${this.currentSnapPoint}${this.unit}`)})}getSnapPointTo(e){const t=C.getClosestSnapPoint(this.snapPointDetents,e);if(t!==this.currentSnapPoint)return t;const n=this.panGestureRecognizer.direction();if(n.axis!=="y"||n.direction===null)return this.currentSnapPoint;const a=this.panGestureRecognizer.velocity();return Math.abs(a.y)<q.VELOCITY?this.currentSnapPoint:C.getClosestSnapPointByDirection(this.snapPointDetents,t,n.direction)}preventUntilPanGestureBecomesExpected(){return this.panGestureRecognizer.direction().axis==="x"||this.panGestureRecognizer.distance()<q.DISTANCE_FOR_MOVING_START}preventImmediatelyIfPannedElIsNotValid(){return this.pannedEl===null||this.pannedEl.closest(`[${z}=true]`)!==null||!this.sheetEl.contains(this.pannedEl)}preventUntilVerticalScrollingOnSheetScrollElBecomesExpected(){return this.sheetScrollEl===null||!this.sheetScrollEl.contains(this.pannedEl)||this.sheetScrollEl.scrollHeight<=this.sheetScrollEl.clientHeight?!1:this.sheetScrollEl.scrollTop===0?this.panGestureRecognizer.direction().direction===-1&&C.isLastSnapPointDetents(this.snapPointDetents,this.currentSnapPoint):!0}preventImmediatelyIfVerticalScrollingOnPannedElIsScrolled(){if(this.pannedEl===null||this.pannedEl===this.sheetEl||this.pannedEl===this.sheetScrollEl)return!1;const e=j(this.pannedEl,this.sheetEl);return e===null||this.sheetScrollEl===e||e.scrollHeight<=e.clientHeight?!1:e.scrollTop!==0||this.panGestureRecognizer.direction().direction===-1}static disableVerticalScrollBouncingIfNeeded(e,t){return e!==null&&e.scrollTop<=0&&e.contains(t)&&e.scrollHeight>e.clientHeight?(e.style.setProperty("overflow-y","hidden"),function(){e.style.removeProperty("overflow-y")}):b}static isLastSnapPointDetents(e,t){return t===e[e.length-1]}static getClosestSnapPointByDirection(e,t,n){const a=e.indexOf(t);switch(n){case-1:return e[a+1]??e[e.length-1];case 1:return e[a-1]??e[0]}}static getClosestSnapPoint(e,t){let n=e[0],a=Math.abs(e[0]-t);for(let l=1;l<e.length;l+=1){const r=Math.abs(e[l]-t);r<a&&(n=e[l],a=r)}return n}}class H{el;property;constructor(e,t){this.el=e,this.property=t}set(e){return this.el.style.setProperty(this.property,`${e}`),this}unset(){return this.cleanup()}enableTransition(){return this.el.style.removeProperty("transition"),this}disableTransition(){return this.el.style.setProperty("transition","none"),this}cleanup(){return this.el.removeEventListener("transitionend",this.handleTransitionEnd),this.el.style.removeProperty("transition"),this.el.style.removeProperty(this.property),this}cleanupOnTransitionEnd(){return this.el.addEventListener("transitionend",this.handleTransitionEnd,{once:!0}),this}handleTransitionEnd=()=>(this.cleanup(),this)}const Ve=(o,{blocked:e,snapPoint:t,sheetCSSProperty:n,backdropCSSProperty:a,onSnapPointChange:l,onDismiss:r})=>{const[d,y]=u.useState(null),[s,c]=u.useState(null),[p,i]=u.useState(null),v=u.useMemo(()=>o&&t!=="auto"?{[n]:`${t.initial}%`}:void 0,[o,t,n]),E=L(l||b),S=L(r||b),h=u.useMemo(()=>!o||s===null?null:new C(s,{sheetScrollEl:d||null,sheetTransitionController:new H(s,n),backdropTransitionController:p?new H(p,a):null,onSnapPointChange:E,onDismiss:S}),[o,s,n,d,p,a,E,S]),O=function(M){e||h.panStart(M.nativeEvent)},T=function(M){h.panMove(M.nativeEvent)},g=function(){h.panEnd()};return V(function(){h&&h.init(t)},[t,h]),V(()=>function(){h&&h.destroy()},[h]),[{initialStyle:v,setSheetEl:c,setSheetScrollEl:y,setBackdropEl:i},h!==null?{onTouchStart:O,onTouchMove:T,onTouchEnd:g,onTouchCancel:g,onMouseDown:O,onMouseMove:T,onMouseUp:g,onMouseLeave:g}:void 0]},me="_host_ntc00_1",ye={host:me},N=({visible:o,position:e,getRootRef:t,disableOpenAnimation:n,disableCloseAnimation:a,...l})=>{const r=u.useContext(A);return B.jsx("div",{...l,"aria-hidden":"true",className:ye.host,ref:function(){Y(r.current,t)}})};try{N.displayName="VisuallyHiddenModalOverlay",N.__docgenInfo={description:"`ModalRoot` выставляет общий `ModalOverlay` для всех потомков, и чтобы не нарушить логику\nв `ModalPage` и `ModalCard`, в них прокидывается данный компонент, который визуально не виден,\nно при этом на нём сохраняется возможность взаимодействия.\n\nВ `getRooRef` отдаёт ссылку на DOM общего `ModalOverlay`.",displayName:"VisuallyHiddenModalOverlay",props:{visible:{defaultValue:null,description:"",name:"visible",required:!1,type:{name:"boolean"}},position:{defaultValue:null,description:"",name:"position",required:!1,type:{name:"enum",value:[{value:'"absolute"'},{value:'"fixed"'}]}},onClick:{defaultValue:null,description:"",name:"onClick",required:!1,type:{name:"((event: MouseEvent<HTMLDivElement, MouseEvent>) => void)"}},onClosed:{defaultValue:null,description:"",name:"onClosed",required:!1,type:{name:"(() => void)"}},onShowed:{defaultValue:null,description:"",name:"onShowed",required:!1,type:{name:"(() => void)"}},disableOpenAnimation:{defaultValue:null,description:"",name:"disableOpenAnimation",required:!1,type:{name:"boolean"}},disableCloseAnimation:{defaultValue:null,description:"",name:"disableCloseAnimation",required:!1,type:{name:"boolean"}},getRootRef:{defaultValue:null,description:"",name:"getRootRef",required:!1,type:{name:"Ref<HTMLDivElement>"}}}}}catch{}const Se=ee("useModalManager"),w=({id:o,open:e,keepMounted:t,modalOverlayTestId:n,noFocusToDialog:a,disableModalOverlay:l,disableCloseAnimation:r,disableOpenAnimation:d,onOpen:y,onOpened:s,onClose:c,onClosed:p})=>{const i=u.useContext(x),v=u.useId(),E=W({nav:o},i.isInsideModal?Se:void 0)||v,S=i.isInsideModal?i.activeModal===E:e,h=i.isInsideModal?i.activeModal!==null:!1,[O,T]=u.useState(t?!1:!S);return V(function(){!t&&S&&T(m=>m&&!1)},[S,t]),O?{mounted:!1,shouldPreserveSnapPoint:h,id:E}:{id:E,mounted:!0,open:S,shouldPreserveSnapPoint:h,noFocusToDialog:a||i.noFocusToDialog,modalOverlayTestId:n||i.modalOverlayTestId,disableModalOverlay:l||i.disableModalOverlay,disableCloseAnimation:r||i.disableCloseAnimation,disableOpenAnimation:d||i.disableOpenAnimation,ModalOverlay:i.isInsideModal?N:R,onOpen:y||D(E,i.onOpen),onOpened:s||D(E,i.onOpened),onClose:c||D(E,i.onClose),onClosed:function(...m){t||T(!0),p?p(...m):i.onClosed?.(E)}}};function D(o,e){return e?()=>e(o):void 0}try{w.displayName="useModalRootManager",w.__docgenInfo={description:"",displayName:"useModalRootManager",props:{id:{defaultValue:null,description:"",name:"id",required:!1,type:{name:"string"}},open:{defaultValue:null,description:"",name:"open",required:!0,type:{name:"boolean"}},keepMounted:{defaultValue:null,description:"",name:"keepMounted",required:!0,type:{name:"boolean"}},modalOverlayTestId:{defaultValue:null,description:"",name:"modalOverlayTestId",required:!1,type:{name:"string"}},noFocusToDialog:{defaultValue:null,description:"",name:"noFocusToDialog",required:!1,type:{name:"boolean"}},disableModalOverlay:{defaultValue:null,description:"",name:"disableModalOverlay",required:!1,type:{name:"boolean"}},disableCloseAnimation:{defaultValue:null,description:"",name:"disableCloseAnimation",required:!1,type:{name:"boolean"}},disableOpenAnimation:{defaultValue:null,description:"",name:"disableOpenAnimation",required:!1,type:{name:"boolean"}},onOpen:{defaultValue:null,description:"",name:"onOpen",required:!1,type:{name:"AnyFunction"}},onOpened:{defaultValue:null,description:"",name:"onOpened",required:!1,type:{name:"AnyFunction"}},onClose:{defaultValue:null,description:"",name:"onClose",required:!1,type:{name:"AnyFunction"}},onClosed:{defaultValue:null,description:"",name:"onClosed",required:!1,type:{name:"AnyFunction"}}}}}catch{}function Re(o=!0){const{window:e,document:t}=X(),[n,a]=u.useState(null),[l,r]=u.useState(!1),d=u.useRef(null);return u.useEffect(function(){if(!o||!e||!t)return;const s=p=>{const i=p===!0?t.activeElement:p.target;if(J(i))switch((p===!0?{type:"focusin"}:p).type){case"focusin":d.current=F(e),a(i);break;case"focusout":d.current=null,r(!1),a(null);break}};s(!0);const c={passive:!0,capture:!1};return t.addEventListener("focusin",s,c),t.addEventListener("focusout",s,c),()=>{d.current=null,t.removeEventListener("focusin",s,c),t.removeEventListener("focusout",s,c)}},[o,e,t]),u.useEffect(function(){if(!n||!e)return;const s=ne(()=>{if(d.current===null)return;const c=F(e),{offsetTop:p,height:i}=d.current,{offsetTop:v,height:E}=c;(p!==v||i!==E)&&(r(!0),d.current=c)},100);return e.visualViewport?e.visualViewport.addEventListener("resize",s):e.addEventListener("resize",s),function(){e.visualViewport?e.visualViewport.removeEventListener("resize",s):e.removeEventListener("resize",s)}},[n,e]),u.useEffect(function(){if(!l||!e)return;const s=ie(()=>{d.current&&e.scrollTo(0,d.current.offsetTop)},100);return e.addEventListener("scroll",s,{passive:!0}),function(){e.removeEventListener("scroll",s)}},[l,e]),{opened:l}}const ve="_host_120u5_1",ge="_disableModalOverlay_120u5_9",_e="_hostDesktop_120u5_14",P={host:ve,disableModalOverlay:ge,hostDesktop:_e},k=({className:o,hidden:e,isDesktop:t,children:n,getRootRef:a,disableModalOverlay:l,...r})=>B.jsx("div",{ref:a,className:G(o,P.host,t&&P.hostDesktop,l&&P.disableModalOverlay),hidden:e,"aria-hidden":e,...r,children:n});try{k.displayName="ModalOutlet",k.__docgenInfo={description:"",displayName:"ModalOutlet",props:{disableModalOverlay:{defaultValue:null,description:"",name:"disableModalOverlay",required:!1,type:{name:"boolean"}},hidden:{defaultValue:null,description:"",name:"hidden",required:!1,type:{name:"boolean"}},isDesktop:{defaultValue:null,description:"",name:"isDesktop",required:!1,type:{name:"boolean"}},getRootRef:{defaultValue:null,description:"",name:"getRootRef",required:!1,type:{name:"Ref<HTMLDivElement>"}}}}}catch{}export{De as B,x as M,_ as S,Ve as a,k as b,R as c,w as d,Pe as e,A as f,Re as u};
