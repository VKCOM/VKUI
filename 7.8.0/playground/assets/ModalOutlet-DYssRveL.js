import{i as U,j as B,h as G,r as d,n as y,bU as $,am as K,bS as j,o as L,l as R,bV as W,aD as X,q as Y,bW as J,bX as F}from"./iframe-F_0bvJrc.js";import{U as Q,r as Z}from"./rubberbandIfOutOfBounds-t6iKEh6d.js";import{w as ee}from"./warnOnce-BsOPdcXO.js";import{u as te}from"./useCSSTransition--rZWB9Dm.js";import{d as ne}from"./debounce-2Cr6Hz2O.js";import{t as ie}from"./throttle-CuRfLcRJ.js";const se="_host_10iyl_1",oe="_nonInteractive_10iyl_10",ae="_hostPositionAbsolute_10iyl_15",re="_hostPositionFixed_10iyl_19",le="_hostStateEnter_10iyl_24",ue="_hostStateEntering_10iyl_29",de="_hostStateEntered_10iyl_33",ce="_hostStateExit_10iyl_37",pe="_hostStateExiting_10iyl_42",he="_hostStateExited_10iyl_46",h={host:se,nonInteractive:oe,hostPositionAbsolute:ae,hostPositionFixed:re,hostStateEnter:le,hostStateEntering:ue,hostStateEntered:de,hostStateExit:ce,hostStateExiting:pe,hostStateExited:he},fe={absolute:h.hostPositionAbsolute,fixed:h.hostPositionFixed},Ee={appear:h.hostStateEnter,appearing:h.hostStateEntering,appeared:h.hostStateEntered,enter:h.hostStateEnter,entering:h.hostStateEntering,entered:h.hostStateEntered,exit:h.hostStateExit,exiting:h.hostStateExiting,exited:h.hostStateExited},V=({visible:s=!1,position:e="absolute",getRootRef:t,onClick:n,disableOpenAnimation:o,disableCloseAnimation:a,...l})=>{const[u,{ref:m,onTransitionEnd:r}]=te(s,{enableAppear:!o,enableEnter:!o,enableExit:!a}),i=U(t,m);return B.jsx("div",{...l,ref:i,"aria-hidden":"true",hidden:u==="exited",className:G(h.host,n===void 0&&h.nonInteractive,fe[e],Ee[u]),onClick:n,onTransitionEnd:r})};try{V.displayName="ModalOverlay",V.__docgenInfo={description:"",displayName:"ModalOverlay",props:{visible:{defaultValue:{value:"false"},description:"",name:"visible",required:!1,type:{name:"boolean"}},position:{defaultValue:{value:"absolute"},description:"",name:"position",required:!1,type:{name:"enum",value:[{value:'"fixed"'},{value:'"absolute"'}]}},onClick:{defaultValue:null,description:"",name:"onClick",required:!1,type:{name:"((event: MouseEvent<HTMLDivElement, MouseEvent>) => void)"}},disableOpenAnimation:{defaultValue:null,description:"",name:"disableOpenAnimation",required:!1,type:{name:"boolean"}},disableCloseAnimation:{defaultValue:null,description:"",name:"disableCloseAnimation",required:!1,type:{name:"boolean"}},getRootRef:{defaultValue:null,description:"",name:"getRootRef",required:!1,type:{name:"Ref<HTMLDivElement>"}}}}}catch{}const x=d.createContext({current:null}),A=d.createContext({updateModalHeight:y,registerModal:y,isInsideModal:!1});try{x.displayName="ModalRootOverlayContext",x.__docgenInfo={description:"Сохраняем `ref` компонента `ModalOverlay` из `ModalRoot` в контекст, чтобы можно было пробросить\nего до `ModalPage` и `ModalCard`.",displayName:"ModalRootOverlayContext",props:{}}}catch{}try{A.displayName="ModalRootContext",A.__docgenInfo={description:"",displayName:"ModalRootContext",props:{}}}catch{}const z="data-vkui-block-sheet-behavior",De={[z]:!0},H={DISTANCE_FOR_MOVING_START:12,VELOCITY:500},Pe={LOWER:25,HIGHEST:90},g={MIN:0,LARGE:100},I={IDLE_POINT_VALUE:0,COMPUTED_INDEX:1};class _{sheetEl;constructor(e,{sheetScrollEl:t,sheetTransitionController:n,backdropTransitionController:o,onSnapPointChange:a,onDismiss:l}){this.sheetEl=e,this.onSnapPointChange=a,this.onDismiss=l,this.panGestureRecognizer=new Q,this.sheetScrollEl=t,this.sheetTransitionController=n,this.backdropTransitionController=o}init(e){this.isInitialized=!0,e==="auto"?(this.unit="px",this.currentSnapPoint=I.IDLE_POINT_VALUE,this.snapPointDetents=[g.MIN,I.IDLE_POINT_VALUE]):(this.unit="%",this.currentSnapPoint=e.initial,this.snapPointDetents=e.detents)}destroy(){this.isInitialized=!1,this.pannedEl=null,this.sheetTransitionController.cleanup(),this.backdropTransitionController?.cleanup(),this.disableVerticalScrollBouncingDispose(),this.disableVerticalScrollBouncingDispose=y}panStart(e){!this.isInitialized||this.panState!=="idle"||$(e.target)||(this.panState="start",this.pannedEl=e.target,this.panGestureRecognizer.setStartCoords(e))}panMove(e){switch(this.panState){case"start":if(this.panGestureRecognizer.setInitialTimeOnce(),this.panGestureRecognizer.setEndCoords(e),this.preventUntilPanGestureBecomesExpected())return;if(this.preventImmediatelyIfPannedElIsNotValid()){this.panState="idle";return}if(this.preventUntilVerticalScrollingOnSheetScrollElBecomesExpected())return;if(this.preventImmediatelyIfVerticalScrollingOnPannedElIsScrolled()){this.panState="idle";return}this.panState="moving",this.panGestureRecognizer.setStartCoords(e),this.sheetHeight=this.sheetEl.offsetHeight,this.disableVerticalScrollBouncingDispose=_.disableVerticalScrollBouncingIfNeeded(this.sheetScrollEl,this.pannedEl),this.isDynamicSnapPoint&&(this.currentSnapPoint=this.sheetHeight,this.snapPointDetents[I.COMPUTED_INDEX]=this.sheetHeight);break;case"moving":this.panGestureRecognizer.setEndCoords(e);const{y1:t,y2:n}=this.panGestureRecognizer;this.nextSnapPoint=Z(this.currentSnapPoint-(n-t)/this.sheetHeight*this.currentSnapPoint,g.MIN,this.isDynamicSnapPoint?this.sheetHeight:g.LARGE),this.calculateSnapPoint(this.nextSnapPoint,!0);break}}panEnd(){switch(this.panState){case"moving":const e=this.currentSnapPoint;this.currentSnapPoint=this.getSnapPointTo(this.nextSnapPoint),e!==this.currentSnapPoint&&this.currentSnapPoint>g.MIN&&this.onSnapPointChange(this.currentSnapPoint),this.calculateSnapPoint(this.currentSnapPoint);break}this.panState="idle",this.panGestureRecognizer.reset(),this.disableVerticalScrollBouncingDispose(),this.disableVerticalScrollBouncingDispose=y}isInitialized=!1;panState="idle";pannedEl=null;sheetHeight=0;rafId=null;currentSnapPoint=0;nextSnapPoint=0;snapPointDetents=[0,0];unit="%";get isDynamicSnapPoint(){return this.unit==="px"}disableVerticalScrollBouncingDispose=y;sheetScrollEl;sheetTransitionController;backdropTransitionController;panGestureRecognizer;onSnapPointChange;onDismiss;calculateSnapPoint(e,t=!1){if(this.rafId!==null&&cancelAnimationFrame(this.rafId),e<=g.MIN){this.sheetTransitionController.enableTransition(),this.backdropTransitionController?.enableTransition(),this.panState="idle",this.onDismiss();return}const n=K(this.isDynamicSnapPoint?e/this.sheetHeight:e*2/g.LARGE,0,1);this.rafId=requestAnimationFrame(()=>{if(t){this.backdropTransitionController?.disableTransition().set(n),this.sheetTransitionController.disableTransition().set(`${e}${this.unit}`);return}this.isDynamicSnapPoint&&this.sheetTransitionController.cleanupOnTransitionEnd(),this.backdropTransitionController?.unset(),this.sheetTransitionController.enableTransition().set(`${this.currentSnapPoint}${this.unit}`)})}getSnapPointTo(e){const t=_.getClosestSnapPoint(this.snapPointDetents,e);if(t!==this.currentSnapPoint)return t;const n=this.panGestureRecognizer.direction();if(n.axis!=="y"||n.direction===null)return this.currentSnapPoint;const o=this.panGestureRecognizer.velocity();return Math.abs(o.y)<H.VELOCITY?this.currentSnapPoint:_.getClosestSnapPointByDirection(this.snapPointDetents,t,n.direction)}preventUntilPanGestureBecomesExpected(){return this.panGestureRecognizer.direction().axis==="x"||this.panGestureRecognizer.distance()<H.DISTANCE_FOR_MOVING_START}preventImmediatelyIfPannedElIsNotValid(){return this.pannedEl===null||this.pannedEl.closest(`[${z}=true]`)!==null||!this.sheetEl.contains(this.pannedEl)}preventUntilVerticalScrollingOnSheetScrollElBecomesExpected(){return this.sheetScrollEl===null||!this.sheetScrollEl.contains(this.pannedEl)||this.sheetScrollEl.scrollHeight<=this.sheetScrollEl.clientHeight?!1:this.sheetScrollEl.scrollTop===0?this.panGestureRecognizer.direction().direction===-1&&_.isLastSnapPointDetents(this.snapPointDetents,this.currentSnapPoint):!0}preventImmediatelyIfVerticalScrollingOnPannedElIsScrolled(){if(this.pannedEl===null||this.pannedEl===this.sheetEl||this.pannedEl===this.sheetScrollEl)return!1;const e=j(this.pannedEl,this.sheetEl);return e===null||this.sheetScrollEl===e||e.scrollHeight<=e.clientHeight?!1:e.scrollTop!==0||this.panGestureRecognizer.direction().direction===-1}static disableVerticalScrollBouncingIfNeeded(e,t){return e!==null&&e.scrollTop<=0&&e.contains(t)&&e.scrollHeight>e.clientHeight?(e.style.setProperty("overflow-y","hidden"),function(){e.style.removeProperty("overflow-y")}):y}static isLastSnapPointDetents(e,t){return t===e[e.length-1]}static getClosestSnapPointByDirection(e,t,n){const o=e.findIndex(a=>a===t);switch(n){case-1:return e[o+1]??e[e.length-1];case 1:return e[o-1]??e[0]}}static getClosestSnapPoint(e,t){let n=e[0],o=Math.abs(e[0]-t);for(let a=1;a<e.length;a+=1){const l=Math.abs(e[a]-t);l<o&&(n=e[a],o=l)}return n}}class q{el;property;constructor(e,t){this.el=e,this.property=t}set(e){return this.el.style.setProperty(this.property,`${e}`),this}unset(){return this.cleanup()}enableTransition(){return this.el.style.removeProperty("transition"),this}disableTransition(){return this.el.style.setProperty("transition","none"),this}cleanup(){return this.el.removeEventListener("transitionend",this.handleTransitionEnd),this.el.style.removeProperty("transition"),this.el.style.removeProperty(this.property),this}cleanupOnTransitionEnd(){return this.el.addEventListener("transitionend",this.handleTransitionEnd,{once:!0}),this}handleTransitionEnd=()=>(this.cleanup(),this)}const Re=(s,{blocked:e,snapPoint:t,sheetCSSProperty:n,backdropCSSProperty:o,onSnapPointChange:a,onDismiss:l})=>{const[u,m]=d.useState(null),[r,i]=d.useState(null),[f,c]=d.useState(null),E=d.useMemo(()=>s&&t!=="auto"?{[n]:`${t.initial}%`}:void 0,[s,t,n]),S=L(a||y),b=L(l||y),p=d.useMemo(()=>!s||r===null?null:new _(r,{sheetScrollEl:u||null,sheetTransitionController:new q(r,n),backdropTransitionController:f?new q(f,o):null,onSnapPointChange:S,onDismiss:b}),[s,r,n,u,f,o,S,b]),T=function(O){e||p.panStart(O.nativeEvent)},v=function(O){p.panMove(O.nativeEvent)},M=function(){p.panEnd()};return R(function(){p&&p.init(t)},[t,p]),R(()=>function(){p&&p.destroy()},[p]),[{initialStyle:E,setSheetEl:i,setSheetScrollEl:m,setBackdropEl:c},p!==null?{onTouchStart:T,onTouchMove:v,onTouchEnd:M,onTouchCancel:M,onMouseDown:T,onMouseMove:v,onMouseUp:M,onMouseLeave:M}:void 0]},me="_host_ntc00_1",ye={host:me},N=({visible:s,position:e,getRootRef:t,disableOpenAnimation:n,disableCloseAnimation:o,...a})=>{const l=d.useContext(x);return B.jsx("div",{...a,"aria-hidden":"true",className:ye.host,ref:function(){W(l.current,t)}})};try{N.displayName="VisuallyHiddenModalOverlay",N.__docgenInfo={description:"`ModalRoot` выставляет общий `ModalOverlay` для всех потомков, и чтобы не нарушить логику\nв `ModalPage` и `ModalCard`, в них прокидывается данный компонент, который визуально не виден,\nно при этом на нём сохраняется возможность взаимодействия.\n\nВ `getRooRef` отдаёт ссылку на DOM общего `ModalOverlay`.",displayName:"VisuallyHiddenModalOverlay",props:{visible:{defaultValue:null,description:"",name:"visible",required:!1,type:{name:"boolean"}},position:{defaultValue:null,description:"",name:"position",required:!1,type:{name:"enum",value:[{value:'"fixed"'},{value:'"absolute"'}]}},onClick:{defaultValue:null,description:"",name:"onClick",required:!1,type:{name:"((event: MouseEvent<HTMLDivElement, MouseEvent>) => void)"}},disableOpenAnimation:{defaultValue:null,description:"",name:"disableOpenAnimation",required:!1,type:{name:"boolean"}},disableCloseAnimation:{defaultValue:null,description:"",name:"disableCloseAnimation",required:!1,type:{name:"boolean"}},getRootRef:{defaultValue:null,description:"",name:"getRootRef",required:!1,type:{name:"Ref<HTMLDivElement>"}}}}}catch{}const Se=ee("useModalManager"),k=({id:s,open:e,keepMounted:t,modalOverlayTestId:n,noFocusToDialog:o,disableModalOverlay:a,onOpen:l,onOpened:u,onClose:m,onClosed:r})=>{const i=d.useContext(A),f=d.useId(),c=X({nav:s},i.isInsideModal?Se:void 0)||f,E=i.isInsideModal?i.activeModal===c:e,S=i.isInsideModal?i.activeModal!==null:!1,[b,p]=d.useState(t?!1:!E);return R(function(){!t&&E&&p(v=>v&&!1)},[E,t]),b?{mounted:!1,shouldPreserveSnapPoint:S,id:c}:{id:c,mounted:!0,open:E,shouldPreserveSnapPoint:S,noFocusToDialog:o||i.noFocusToDialog,modalOverlayTestId:n||i.modalOverlayTestId,disableModalOverlay:a||i.disableModalOverlay,ModalOverlay:i.isInsideModal?N:V,onOpen:l||D(c,i.onOpen),onOpened:u||D(c,i.onOpened),onClose:m||D(c,i.onClose),onClosed:function(...v){t||p(!0),r?r(...v):i.onClosed?.(c)}}};function D(s,e){return e?()=>e(s):void 0}try{k.displayName="useModalManager",k.__docgenInfo={description:"",displayName:"useModalManager",props:{id:{defaultValue:null,description:"",name:"id",required:!1,type:{name:"string"}},open:{defaultValue:null,description:"",name:"open",required:!0,type:{name:"boolean"}},keepMounted:{defaultValue:null,description:"",name:"keepMounted",required:!0,type:{name:"boolean"}},modalOverlayTestId:{defaultValue:null,description:"",name:"modalOverlayTestId",required:!1,type:{name:"string"}},noFocusToDialog:{defaultValue:null,description:"",name:"noFocusToDialog",required:!1,type:{name:"boolean"}},disableModalOverlay:{defaultValue:null,description:"",name:"disableModalOverlay",required:!1,type:{name:"boolean"}},onOpen:{defaultValue:null,description:"",name:"onOpen",required:!1,type:{name:"AnyFunction"}},onOpened:{defaultValue:null,description:"",name:"onOpened",required:!1,type:{name:"AnyFunction"}},onClose:{defaultValue:null,description:"",name:"onClose",required:!1,type:{name:"AnyFunction"}},onClosed:{defaultValue:null,description:"",name:"onClosed",required:!1,type:{name:"AnyFunction"}}}}}catch{}function Ve(s=!0){const{window:e,document:t}=Y(),[n,o]=d.useState(null),[a,l]=d.useState(!1),u=d.useRef(null);return d.useEffect(function(){if(!s||!e||!t)return;const r=f=>{const c=f===!0?t.activeElement:f.target;if(J(c))switch((f===!0?{type:"focusin"}:f).type){case"focusin":u.current=F(e),o(c);break;case"focusout":u.current=null,l(!1),o(null);break}};r(!0);const i={passive:!0,capture:!1};return t.addEventListener("focusin",r,i),t.addEventListener("focusout",r,i),()=>{u.current=null,t.removeEventListener("focusin",r,i),t.removeEventListener("focusout",r,i)}},[s,e,t]),d.useEffect(function(){if(!n||!e)return;const r=ne(()=>{if(u.current===null)return;const i=F(e),{offsetTop:f,height:c}=u.current,{offsetTop:E,height:S}=i;(f!==E||c!==S)&&(l(!0),u.current=i)},100);return e.visualViewport?e.visualViewport.addEventListener("resize",r):e.addEventListener("resize",r),function(){e.visualViewport?e.visualViewport.removeEventListener("resize",r):e.removeEventListener("resize",r)}},[n,e]),d.useEffect(function(){if(!a||!e)return;const r=ie(()=>{u.current&&e.scrollTo(0,u.current.offsetTop)},100);return e.addEventListener("scroll",r,{passive:!0}),function(){e.removeEventListener("scroll",r)}},[a,e]),{opened:a}}const ve="_host_120u5_1",ge="_disableModalOverlay_120u5_9",_e="_hostDesktop_120u5_14",P={host:ve,disableModalOverlay:ge,hostDesktop:_e},w=({className:s,hidden:e,isDesktop:t,children:n,getRootRef:o,disableModalOverlay:a,...l})=>B.jsx("div",{ref:o,className:G(s,P.host,t&&P.hostDesktop,a&&P.disableModalOverlay),hidden:e,"aria-hidden":e,...l,children:n});try{w.displayName="ModalOutlet",w.__docgenInfo={description:"",displayName:"ModalOutlet",props:{disableModalOverlay:{defaultValue:null,description:"",name:"disableModalOverlay",required:!1,type:{name:"boolean"}},hidden:{defaultValue:null,description:"",name:"hidden",required:!1,type:{name:"boolean"}},isDesktop:{defaultValue:null,description:"",name:"isDesktop",required:!1,type:{name:"boolean"}},getRootRef:{defaultValue:null,description:"",name:"getRootRef",required:!1,type:{name:"Ref<HTMLDivElement>"}}}}}catch{}export{De as B,A as M,g as S,x as a,V as b,Re as c,w as d,k as e,Pe as f,Ve as u};
