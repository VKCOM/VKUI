import{r as i,aV as M,q as R,$ as B,j as s,h as F,o as v}from"./iframe-7s0T-F6L.js";import{t as q}from"./throttle-CuRfLcRJ.js";import{u as H}from"./useGlobalEventListener-D2m4XbLr.js";import{S as w}from"./Spinner-DyPdKfog.js";import{B as k}from"./Button-DBxYkQfv.js";import{m as Q}from"./index-17fw2PtX.js";import{F as T}from"./Flex-D18wWhg9.js";import{T as G}from"./Title-C8ooGZRF.js";import{G as A}from"./Group-CH_sa7ue.js";import{S as z}from"./Search-Fzy6vxZK.js";import{F as U}from"./Footer-Dx0HyxBZ.js";import{C as Y}from"./Counter-CPP2XVjm.js";import{f as J}from"./blocks-DyUqpFNi.js";function P(e,o){return Object.entries(e).reduce((t,[n,r])=>(o(r,n)&&Object.assign(t,{[n]:r}),t),{})}function W(e){if(!/[а-яё]/i.test(e))return e;const o={а:"f",б:",",в:"d",г:"u",д:"l",е:"t",ё:"`",ж:";",з:"p",и:"b",й:"q",к:"r",л:"k",м:"v",н:"y",о:"j",п:"g",р:"h",с:"c",т:"n",у:"e",ф:"a",х:"[",ц:"w",ч:"x",ш:"i",щ:"o",ъ:"]",ы:"s",ь:"m",э:"'",ю:".",я:"z"};return e.split("").map(t=>o[t]||t).join("")}const X=(e,o)=>{const[t,n]=i.useState(""),[r,a]=i.useState(!1),{scrollTo:c}=M(),m=i.useMemo(()=>q(h=>{n(W(h.toLocaleLowerCase())),a(!1)},1e3),[]),S=i.useMemo(()=>(c(0,0),o(e,t)),[e,o,t,c]),y=i.useCallback(h=>{a(!0),m(h.target.value)},[m]);return{loading:r,onUpdateQuery:y,config:S,query:t}},$=24,K=64,Z=(e,o,t)=>{const{window:n,document:r}=R(),[a,c]=i.useState({mountedSections:[],sectionsVisibilityData:{}}),m=i.useRef({}),S=()=>{const u={};Object.entries(o).forEach(([d,l])=>{if(l&&l.current){const p=e.find(f=>f.id===d);p&&(u[d]={data:p,bounds:{height:l.current.offsetHeight,offsetTop:l.current.offsetTop}})}}),m.current=u},y=()=>{if(!n||!r)return;const u=n.pageYOffset;c(d=>{const{mountedSections:l,sectionsVisibilityData:p}=d;if(l.length<e.length){const f=r.documentElement.scrollHeight-n.innerHeight-$-K;if(u>=f){const g=e[l.length];return{mountedSections:[...l,g.id],sectionsVisibilityData:{...p,[g.id]:g}}}}return d})},h=()=>{const u=m.current;if(!n||!r)return;const d=n.pageYOffset;c(l=>{const{mountedSections:p}=l,f={};return p.forEach(x=>{const g=u[x];if(!g)return;const{bounds:b,data:C}=g;if(b.offsetTop+b.height<=d||b.offsetTop>=d+n.innerHeight){f[x]={...C,minHeight:b.height,hidden:!0};return}f[x]=C}),{mountedSections:p,sectionsVisibilityData:f}}),y()};return i.useEffect(()=>c({mountedSections:[],sectionsVisibilityData:{}}),[e]),i.useEffect(S,[o]),B(t,()=>requestAnimationFrame(y)),H(n,"scroll",h),{remappedSections:i.useMemo(()=>a.mountedSections.map(u=>a.sectionsVisibilityData[u]).filter(Boolean),[a.mountedSections,a.sectionsVisibilityData]),showMoreElement:a.mountedSections.length<e.length&&s.jsx(w,{})}},ee="_header_1q5wd_6",te="_upButton_1q5wd_23",ne="_hidden_1q5wd_33",I={header:ee,upButton:te,hidden:ne},oe=()=>{const[e,o]=i.useState(!1),{scrollTo:t,getScroll:n}=M(),{window:r}=R(),a=i.useMemo(()=>q(()=>o(n().y>=((r==null?void 0:r.innerHeight)||0)),1e3),[n,r]);return H(r,"scroll",a),s.jsx("div",{className:F(I.upButton,!e&&I.hidden),children:s.jsx(k,{borderRadiusMode:"inherit",size:"l",after:s.jsx(Q,{}),onMouseDown:()=>t(0,0)})})},N=i.createContext({searchedQuery:""}),Se=()=>i.useContext(N),ye=({title:e,config:o,filterConfig:t,remapConfigToSections:n,ItemsContainer:r,renderSectionItem:a,additionalHeaderItem:c})=>{const m=i.useRef(null),[S,y]=i.useState({}),h=v(n),E=v(a),{config:u,loading:d,onUpdateQuery:l,query:p}=X(o,t),f=i.useMemo(()=>h(u),[u,h]),{remappedSections:x,showMoreElement:g}=Z(f,S,m),b=i.useCallback((C,_)=>{const j=i.createRef();j.current=C,y(V=>{const D={...V,[_]:j};return P(D,L=>!!L.current)})},[]);return s.jsxs(N.Provider,{value:{searchedQuery:p},children:[s.jsxs(T,{direction:"column",gap:"2xl",align:"start",className:I.header,children:[s.jsx(G,{children:e}),s.jsx(A,{separator:"hide",children:s.jsx(z,{noPadding:!0,onChange:l})}),c]}),s.jsxs(T,{direction:"column",gap:"3xl",children:[d&&s.jsx(w,{}),!d&&f.length===0&&s.jsx(U,{children:"Ничего не найдено"}),s.jsxs(T,{direction:"column",gap:"3xl",getRootRef:m,children:[x.map(({minHeight:C,hidden:_,...j})=>s.jsx(O,{hidden:_,sectionData:j,onSectionRef:b,style:{minHeight:C},ItemsRenderer:({section:V})=>s.jsx(r,{children:V.items.map(D=>E(D,V))})},j.id)),g]})]}),s.jsx(oe,{})]})},O=i.memo(({style:e,hidden:o,sectionData:t,onSectionRef:n,ItemsRenderer:r})=>{const a=i.useCallback(c=>{n(c,t.id)},[t.id,n]);return s.jsx(T,{direction:"column",gap:"xl",getRootRef:a,style:e,children:o?null:s.jsxs(s.Fragment,{children:[s.jsxs(T,{align:"center",gap:"m",children:[s.jsx(G,{level:"2",children:t.displayTitle}),s.jsx(Y,{size:"m",mode:"primary",appearance:"accent-red",children:t.items.length})]}),s.jsx(r,{section:t})]})})},(e,o)=>{var t,n;return e.sectionData.id===o.sectionData.id&&e.sectionData.items.length===o.sectionData.items.length&&e.onSectionRef===o.onSectionRef&&e.hidden===o.hidden&&((t=e.style)==null?void 0:t.minHeight)===((n=o.style)==null?void 0:n.minHeight)});O.displayName="Section";Object.defineProperty(O,"name",{value:"Section"});try{O.displayName="Section",O.__docgenInfo={description:"",displayName:"Section",props:{title:{defaultValue:null,description:"",name:"title",required:!0,type:{name:"string"}},config:{defaultValue:null,description:"",name:"config",required:!0,type:{name:"CONFIG"}},filterConfig:{defaultValue:null,description:"",name:"filterConfig",required:!0,type:{name:"(config: CONFIG, query: string) => CONFIG"}},remapConfigToSections:{defaultValue:null,description:"",name:"remapConfigToSections",required:!0,type:{name:"(config: CONFIG) => Section<ITEM>[]"}},ItemsContainer:{defaultValue:null,description:"",name:"ItemsContainer",required:!0,type:{name:"ComponentType<HasChildren>"}},renderSectionItem:{defaultValue:null,description:"",name:"renderSectionItem",required:!0,type:{name:"(item: ITEM, section: Section<ITEM>) => ReactElement<unknown, string | JSXElementConstructor<any>>"}},additionalHeaderItem:{defaultValue:null,description:"",name:"additionalHeaderItem",required:!1,type:{name:"ReactElement<unknown, string | JSXElementConstructor<any>>"}}}}}catch{}const xe=()=>{var t,n;const e=i.useContext(J),o=(n=(t=e==null?void 0:e.store)==null?void 0:t.userGlobals)==null?void 0:n.globals;if(o){const{colorScheme:r="light",platform:a="vkcom",direction:c="ltr",hasCustomPanelHeaderAfter:m=!1,hasPointer:S=!1}=o;return{colorScheme:r,platform:a,direction:c,hasCustomPanelHeaderAfter:m,hasPointer:S}}return{colorScheme:"light",platform:"vkcom",direction:"ltr",hasCustomPanelHeaderAfter:!1,hasPointer:!1}};export{ye as O,Se as a,xe as u};
